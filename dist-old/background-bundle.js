!function(){"use strict";function e(){}const t=e=>e;function n(e,t){for(const n in t)e[n]=t[n];return e}function o(e){return e()}function r(){return Object.create(null)}function a(e){e.forEach(o)}function s(e){return"function"==typeof e}function l(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function c(e,t,n){const o=t.subscribe(n);e.$$.on_destroy.push(o.unsubscribe?()=>o.unsubscribe():o)}const i="undefined"!=typeof window;let u=i?()=>window.performance.now():()=>Date.now(),d=i?requestAnimationFrame:e;const m=new Set;let h,p=!1;function g(){m.forEach(e=>{e[0](u())||(m.delete(e),e[1]())}),(p=m.size>0)&&d(g)}function f(e){let t;return p||(p=!0,d(g)),{promise:new Promise(n=>{m.add(t=[e,n])}),abort(){m.delete(t)}}}function v(e,t){e.appendChild(t)}function b(e,t,n){e.insertBefore(t,n||null)}function y(e){e.parentNode.removeChild(e)}function k(e,t){for(;e.nextSibling&&e.nextSibling!==t;)e.parentNode.removeChild(e.nextSibling)}function w(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function x(e){return document.createElement(e)}function _(e){return document.createTextNode(e)}function N(){return _(" ")}function $(){return _("")}function C(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function T(e){return function(t){return t.preventDefault(),e.call(this,t)}}function P(e){return function(t){return t.stopPropagation(),e.call(this,t)}}function M(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function F(e,t){t=""+t,e.data!==t&&(e.data=t)}function I(e,t,n){e.classList[n?"add":"remove"](t)}let R,S=0,U={};function j(e,t,n,o,r,a,s,l=0){const c=16.666/o;let i="{\n";for(let e=0;e<=1;e+=c){const o=t+(n-t)*a(e);i+=100*e+`%{${s(o,1-o)}}\n`}const u=i+`100% {${s(n,1-n)}}\n}`,d=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${l}`;if(!U[d]){if(!h){const e=x("style");document.head.appendChild(e),h=e.sheet}U[d]=!0,h.insertRule(`@keyframes ${d} ${u}`,h.cssRules.length)}const m=e.style.animation||"";return e.style.animation=`${m?`${m}, `:""}${d} ${o}ms linear ${r}ms 1 both`,S+=1,d}function A(e,t){e.style.animation=(e.style.animation||"").split(", ").filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")).join(", "),t&&!--S&&d(()=>{if(S)return;let e=h.cssRules.length;for(;e--;)h.deleteRule(e);U={}})}function L(e){R=e}function E(){if(!R)throw new Error("Function called outside component initialization");return R}function O(e){E().$$.on_mount.push(e)}function W(){const e=R;return(t,n)=>{const o=e.$$.callbacks[t];if(o){const r=function(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}(t,n);o.slice().forEach(t=>{t.call(e,r)})}}}const B=[],H=Promise.resolve();let q=!1;const D=[],z=[],Y=[];function V(e){z.push(e)}function K(){const e=new Set;do{for(;B.length;){const e=B.shift();L(e),J(e.$$)}for(;D.length;)D.shift()();for(;z.length;){const t=z.pop();e.has(t)||(t(),e.add(t))}}while(B.length);for(;Y.length;)Y.pop()();q=!1}function J(e){e.fragment&&(e.update(e.dirty),a(e.before_render),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_render.forEach(V))}let G,Q;function X(){return G||(G=Promise.resolve()).then(()=>{G=null}),G}function Z(){Q={remaining:0,callbacks:[]}}function ee(){Q.remaining||a(Q.callbacks)}function te(e){Q.callbacks.push(e)}function ne(e,t){const o=t.token={};function r(e,r,a,s){if(t.token!==o)return;t.resolved=a&&{[a]:s};const l=n(n({},t.ctx),t.resolved),c=e&&(t.current=e)(l);t.block&&(t.blocks?t.blocks.forEach((e,n)=>{n!==r&&e&&(Z(),te(()=>{e.d(1),t.blocks[n]=null}),e.o(1),ee())}):t.block.d(1),c.c(),c.i&&c.i(1),c.m(t.mount(),t.anchor),K()),t.block=c,t.blocks&&(t.blocks[r]=c)}if((a=e)&&"function"==typeof a.then){if(e.then(e=>{r(t.then,1,t.value,e)},e=>{r(t.catch,2,t.error,e)}),t.current!==t.pending)return r(t.pending,0),!0}else{if(t.current!==t.then)return r(t.then,1,t.value,e),!0;t.resolved={[t.value]:e}}var a}function oe(e,t){te(()=>{!function(e,t){e.d(1),t.delete(e.key)}(e,t)}),e.o(1)}function re(e,t,n,o,r,a,s,l,c,i,u,d){let m=e.length,h=a.length,p=m;const g={};for(;p--;)g[e[p].key]=p;const f=[],v=new Map,b=new Map;for(p=h;p--;){const e=d(r,a,p),l=n(e);let c=s.get(l);c?o&&c.p(t,e):(c=i(l,e)).c(),v.set(l,f[p]=c),l in g&&b.set(l,Math.abs(p-g[l]))}const y=new Set,k=new Set;function w(e){e.i&&e.i(1),e.m(l,u),s.set(e.key,e),u=e.first,h--}for(;m&&h;){const t=f[h-1],n=e[m-1],o=t.key,r=n.key;t===n?(u=t.first,m--,h--):v.has(r)?!s.has(o)||y.has(o)?w(t):k.has(r)?m--:b.get(o)>b.get(r)?(k.add(o),w(t)):(y.add(r),m--):(c(n,s),m--)}for(;m--;){const t=e[m];v.has(t.key)||c(t,s)}for(;h;)w(f[h-1]);return f}function ae(e,t,n){const{fragment:r,on_mount:l,on_destroy:c,after_render:i}=e.$$;r.m(t,n),V(()=>{const t=l.map(o).filter(s);c?c.push(...t):a(t),e.$$.on_mount=[]}),i.forEach(V)}function se(e,t){e.$$.dirty||(B.push(e),q||(q=!0,H.then(K)),e.$$.dirty=r()),e.$$.dirty[t]=!0}function le(t,n,o,s,l,c){const i=R;L(t);const u=n.props||{},d=t.$$={fragment:null,ctx:null,props:c,update:e,not_equal:l,bound:r(),on_mount:[],on_destroy:[],before_render:[],after_render:[],context:new Map(i?i.$$.context:[]),callbacks:r(),dirty:null};let m=!1;var h;d.ctx=o?o(t,u,(e,n)=>{d.ctx&&l(d.ctx[e],d.ctx[e]=n)&&(d.bound[e]&&d.bound[e](n),m&&se(t,e))}):u,d.update(),m=!0,a(d.before_render),d.fragment=s(d.ctx),n.target&&(n.hydrate?d.fragment.l((h=n.target,Array.from(h.childNodes))):d.fragment.c(),n.intro&&t.$$.fragment.i&&t.$$.fragment.i(),ae(t,n.target,n.anchor),K()),L(i)}class ce{$destroy(){var t,n;n=!0,(t=this).$$&&(a(t.$$.on_destroy),t.$$.fragment.d(n),t.$$.on_destroy=t.$$.fragment=null,t.$$.ctx={}),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}function ie(t,n=e){let o;const r=[];function a(e){if(l(t,e)){if(t=e,!o)return;r.forEach(e=>e[1]()),r.forEach(e=>e[0](t))}}return{set:a,update:function(e){a(e(t))},subscribe:function(s,l=e){const c=[s,l];return r.push(c),1===r.length&&(o=n(a)||e),s(t),()=>{const e=r.indexOf(c);-1!==e&&r.splice(e,1),0===r.length&&o()}}}}function ue(t,n,o){const r=!Array.isArray(t),l=r?[t]:t,c=n.length<2;return{subscribe:ie(o,t=>{let o=!1;const i=[];let u=0,d=e;const m=()=>{if(u)return;d();const o=n(r?i[0]:i,t);c?t(o):d=s(o)?o:e},h=l.map((e,t)=>e.subscribe(e=>{i[t]=e,u&=~(1<<t),o&&m()},()=>{u|=1<<t}));return o=!0,m(),function(){a(h),d()}}).subscribe}}const de=()=>Po("filters",[]),me=e=>{let t=de();t.push(e),Fo("filters",t)},he=e=>{let t=de();Fo("filters",t.filter(t=>t!==e))},pe=e=>{let t=de().filter(e=>"blur"==e.action);if(t.length>0){return!t.map(t=>fe(e,t,"blur")).some(e=>e)}return!1},ge=e=>{let t=de().filter(e=>"hide"==e.action);if(t.length>0){return t.map(t=>fe(e,t,"hide")).some(e=>e)}return!0},fe=(e,t,n)=>{let o=[];if(t.action!==n)return!0;if(t.expires){let e=new Date(t.expires);if(new Date>e)return!0}if(t.feed&&(t.feed==e.value.author?(console.log("filtered due to feed"),o.push(!0)):o.push(!1)),t.channel&&(console.log("filtered due to channel"),e.value.content.channel&&t.channel==e.value.content.channel?o.push(!0):o.push(!1)),t.keywords.length>0&&"post"==e.value.content.type&&e.value.content.text){let n=t.keywords,r=e.value.content.text.toLowerCase(),a=n.map(e=>r.includes(e.toLowerCase())).some(e=>e);a&&console.log("filtered due to keywords"),o.push(a)}return console.log("res",!o.some(e=>1==e)),!o.some(e=>1==e)},ve=hermiebox.modules.pullStream,be=hermiebox.modules.ssbSort;let ye=!1,ke={};class we{log(e,t=""){console.log(`[SSB API] - ${e}`,t)}async connect(e){var t=await hermiebox.api.connect(e);this.log("you are",t.id),this.feed=t.id,ye=t}filterLimit(){let e=Po("limit",10);return ve.take(e)}filterWithUserFilters(){return ve.filter(e=>ge(e))}filterTypes(){let e={post:"showTypePost",about:"showTypeAbout",vote:"showTypeVote",contact:"showTypeContact",pub:"showTypePub",blog:"showTypeBlog",channel:"showTypeChannel"};return Po("showTypeUnknown",!1)?ve.filter(()=>!0):ve.filter(t=>{let n=t.value.content.type;return"string"==typeof n&&e[n]?Po(e[n],!0):Po("showTypeUnknown",!1)})}public(e){return new Promise((t,n)=>{(e=e||{}).reverse=e.reverse||!0,console.log("opts",e),ve(ye.createFeedStream(e),ve.filter(e=>e&&e.value&&e.value.content),this.filterTypes(),this.filterWithUserFilters(),this.filterLimit(),ve.collect((e,o)=>{console.log("msgs",o),e&&n(e),t(o)}))})}thread(e){return new Promise((t,n)=>{ye.get(e,(o,r)=>{if(o)return cb(o);var a={key:e,value:r};ve(ye.backlinks&&ye.backlinks.read?ye.backlinks.read({query:[{$filter:{dest:e,value:{content:{root:e}}}}]}):ve(ye.links({dest:e,values:!0,rel:"root"}),ve.filter(function(t){var n=t&&t.value&&t.value.content;return n&&"post"===n.type&&n.root===e}),ve.unique("key")),this.filterTypes(),this.filterWithUserFilters(),this.filterLimit(),ve.collect((e,o)=>{e&&n(e),t(be([a].concat(o)))}))})})}mentions(e,t){return new Promise((e,n)=>{ve((e=>{var n={$filter:{dest:e}};return t&&(n.$filter.value={timestamp:{$lt:t}}),ye.backlinks.read({query:[n],index:"DTA",reverse:!0})})(ye.id),this.filterTypes(),this.filterWithUserFilters(),this.filterLimit(),ve.collect((t,o)=>{t?n(t):e(o)}))})}async profile(e){try{return await hermiebox.api.profile(e)}catch(e){return console.error(e),!1}}async get(e){return await hermiebox.api.get(e)}async setAvatarCache(e,t){let n={};return n[`avatar-${e}`]=t,browser.storage.local.set(n)}async getCachedAvatar(e){return browser.storage.local.get(`avatar-${e}`)}async avatar(e){if(ke[e])return ke[e];try{let t=await hermiebox.api.avatar(e);return ke[e]=t,t}catch(e){throw e}}async blurbFromMsg(e,t){let n=e;try{let o=await ssb.get(e);return"post"==o.content.type&&(n=this.plainTextFromMarkdown(o.content.text.slice(0,t)+"...")),n}catch(e){return n}}plainTextFromMarkdown(e){let t=this.markdown(e),n=document.createElement("div");return n.innerHTML=t,n.innerText}markdown(e){let t=hermiebox.modules.ssbMarkdown.block(e);return t=t.replace(/<pre>/gi,'<pre class="code">').replace(/<a href="#([^"]*)/gi,function(e,t,n,o){return`<a class="channel-link" href="?channel=${encodeURIComponent(t)}#/channel`}).replace(/<a href="@([^"]*)/gi,function(e,t,n,o){return'<a class="profile-link" href="?feed='+encodeURIComponent(`@${t}`)+"#/profile"}).replace(/target="_blank"/gi,"").replace(/<a href="%([^"]*)/gi,function(e,t,n,o){return`<a class="thread-link" href="?thread=${encodeURIComponent(`%${t}`)}#/thread`}).replace(/<img src="&([^"]*)/gi,function(e,t,n,o){return'<img class="is-image-from-blob" src="http://localhost:8989/blobs/get/&'+encodeURIComponent(t)}).replace(/<a href="&([^"]*)/gi,function(e,t,n,o){return'<a class="image-link" target="_blank" href="http://localhost:8989/blobs/get/&'+encodeURIComponent(t)})}ref(){return hermiebox.modules.ssbRef}getTimestamp(e){const t=e.timestamp,n=e.value.timestamp;return Math.min(t,n)}getRootMsgId(e){if(e&&e.value&&e.value.content){const t=e.value.content.root;if(hermiebox.modules.ssbRef.isMsgId(t))return t}}newPost(e){return new Promise((t,n)=>{let o={type:"post",text:e.text};["root","branch","channel","fork","contentWarning"].forEach(t=>{void 0!==e[t]&&(o[t]=e[t])}),o.mentions=hermiebox.modules.ssbMentions(o.text)||[],o.mentions=o.mentions.filter(e=>e);const r=hermiebox.sbot||!1;console.log("post",o),r?r.publish(o,function(e,o){e?n(e):t(o)}):n("There is no sbot connection")})}follow(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1;o&&o.publish({type:"contact",contact:e,following:!0},(e,o)=>{e?n(e):t(o)})})}getBlob(e){return hermiebox.api.getBlob(e)}votes(e){return new Promise((t,n)=>{let o=hermiebox.modules.pullStream,r=hermiebox.sbot;r&&o(r.links({dest:e,rel:"vote",values:!0}),o.collect((e,o)=>{e?n(e):t(o)}))})}like(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"vote",vote:{link:e,value:1,expression:"Like"}};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}unlike(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"vote",vote:{link:e,value:0,expression:"Unlike"}};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}channels(){return new Promise((e,t)=>{let n=hermiebox.modules.pullStream,o=hermiebox.sbot||!1;o?(console.log("querying channels"),n(o.query.read({query:[{$filter:{value:{content:{channel:{$is:"string"},type:"post"}}}},{$reduce:{channel:["value","content","channel"],count:{$count:!0},timestamp:{$max:["value","timestamp"]}}},{$sort:[["timestamp"],["count"]]}],limit:20}),n.collect(function(n,o){console.log("channels",o),n?t(n):e(o)}))):t("no sbot")})}channel(e,t){return new Promise((n,o)=>{let r=hermiebox.modules.pullStream,a=hermiebox.sbot||!1,s={$filter:{value:{content:{channel:e}}}};t.lt&&(s.$filter.value.timestamp={$lt:t.lt}),a?r(a.query.read({query:[s],reverse:!0}),this.filterTypes(),this.filterWithUserFilters(),this.filterLimit(),r.collect(function(e,t){e?o(e):n(t)})):o("no sbot")})}channelSubscribe(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"channel",channel:e,subscribed:!0};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}channelUnsubscribe(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"channel",channel:e,subscribed:!1};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}channelSubscribed(e,t){return new Promise((n,o)=>{let r=hermiebox.modules.pullStream,a=hermiebox.sbot||!1;if(a){t||(t=a.id);let s={$filter:{value:{author:t,content:{type:"channel",channel:e}}}};r(a.query.read({query:[s],reverse:!0}),r.collect(function(e,t){e?o(e):t.length>0?n(t[0].value.content.subscribed||!1):n(!1)}))}else o("no sbot")})}subscribedChannels(e,t){return new Promise((e,n)=>{let o=hermiebox.modules.pullStream,r=hermiebox.sbot||!1;if(r){t||(t=r.id);let a={$filter:{value:{author:t,content:{type:"channel"}}},$map:{channel:["value","content","channel"],subscribed:["value","content","subscribed"]},$sort:[["value","timestamp"]]};o(r.query.read({query:[a],reverse:!0}),o.collect(function(t,o){t?n(t):e(o)}))}else n("no sbot")})}follow(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"contact",contact:e,following:!0};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}unfollow(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"contact",contact:e,following:!1};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}block(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"contact",contact:e,blocking:!0};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}unblock(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"contact",contact:e,blocking:!1};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}following(e,t){return new Promise((n,o)=>{let r=hermiebox.modules.pullStream,a=hermiebox.sbot||!1;if(a){t||(t=a.id);let s={$filter:{value:{author:t,content:{type:"contact",contact:e,following:{$is:"boolean"}}}}};r(a.query.read({query:[s],reverse:!0}),r.collect(function(e,t){e?o(e):t.length>0?n(t[0].value.content.following||!1):n(!1)}))}else o("no sbot")})}blocking(e,t){return new Promise((n,o)=>{let r=hermiebox.modules.pullStream,a=hermiebox.sbot||!1;if(a){t||(t=a.id);let s={$filter:{value:{author:t,content:{type:"contact",contact:e,blocking:{$is:"boolean"}}}}};r(a.query.read({query:[s],reverse:!0}),r.collect(function(e,t){e?o(e):t.length>0?n(t[0].value.content.blocking||!1):n(!1)}))}else o("no sbot")})}query(e,t,n,o){return new Promise((r,a)=>{if(ye){let s={$filter:e};n&&(s.$map=n),o&&(s.$reduce=o),void 0===t&&(t=!0),ve(ye.query.read({query:[s],reverse:t}),this.filterTypes(),this.filterLimit(),ve.collect((e,t)=>{e?a(e):r(t)}))}else a("no sbot")})}}var xe=e=>encodeURIComponent(e).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),_e=new RegExp("%[a-f0-9]{2}","gi"),Ne=new RegExp("(%[a-f0-9]{2})+","gi");function $e(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var n=e.slice(0,t),o=e.slice(t);return Array.prototype.concat.call([],$e(n),$e(o))}function Ce(e){try{return decodeURIComponent(e)}catch(o){for(var t=e.match(_e),n=1;n<t.length;n++)t=(e=$e(t,n).join("")).match(_e);return e}}var Te=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"ï¿½ï¿½","%FF%FE":"ï¿½ï¿½"},n=Ne.exec(e);n;){try{t[n[0]]=decodeURIComponent(n[0])}catch(e){var o=Ce(n[0]);o!==n[0]&&(t[n[0]]=o)}n=Ne.exec(e)}t["%C2"]="ï¿½";for(var r=Object.keys(t),a=0;a<r.length;a++){var s=r[a];e=e.replace(new RegExp(s,"g"),t[s])}return e}(e)}},Pe=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const n=e.indexOf(t);return-1===n?[e]:[e.slice(0,n),e.slice(n+t.length)]};function Me(e,t){return t.encode?t.strict?xe(e):encodeURIComponent(e):e}function Fe(e,t){return t.decode?Te(e):e}function Ie(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function Re(e){const t=(e=Ie(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function Se(e,t){const n=function(e){let t;switch(e.arrayFormat){case"index":return(e,n,o)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===o[e]&&(o[e]={}),o[e][t[1]]=n):o[e]=n};case"bracket":return(e,n,o)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==o[e]?o[e]=[].concat(o[e],n):o[e]=[n]:o[e]=n};case"comma":return(e,t,n)=>{const o="string"==typeof t&&t.split("").indexOf(",")>-1?t.split(","):t;n[e]=o};default:return(e,t,n)=>{void 0!==n[e]?n[e]=[].concat(n[e],t):n[e]=t}}}(t=Object.assign({decode:!0,arrayFormat:"none"},t)),o=Object.create(null);if("string"!=typeof e)return o;if(!(e=e.trim().replace(/^[?#&]/,"")))return o;for(const r of e.split("&")){let[e,a]=Pe(r.replace(/\+/g," "),"=");a=void 0===a?null:Fe(a,t),n(Fe(e,t),a,o)}return Object.keys(o).sort().reduce((e,t)=>{const n=o[t];return Boolean(n)&&"object"==typeof n&&!Array.isArray(n)?e[t]=function e(t){return Array.isArray(t)?t.sort():"object"==typeof t?e(Object.keys(t)).sort((e,t)=>Number(e)-Number(t)).map(e=>t[e]):t}(n):e[t]=n,e},Object.create(null))}var Ue={extract:Re,parse:Se,stringify:(e,t)=>{if(!e)return"";const n=function(e){switch(e.arrayFormat){case"index":return t=>(n,o)=>{const r=n.length;return void 0===o?n:null===o?[...n,[Me(t,e),"[",r,"]"].join("")]:[...n,[Me(t,e),"[",Me(r,e),"]=",Me(o,e)].join("")]};case"bracket":return t=>(n,o)=>void 0===o?n:null===o?[...n,[Me(t,e),"[]"].join("")]:[...n,[Me(t,e),"[]=",Me(o,e)].join("")];case"comma":return t=>(n,o,r)=>null==o||0===o.length?n:0===r?[[Me(t,e),"=",Me(o,e)].join("")]:[[n,Me(o,e)].join(",")];default:return t=>(n,o)=>void 0===o?n:null===o?[...n,Me(t,e)]:[...n,[Me(t,e),"=",Me(o,e)].join("")]}}(t=Object.assign({encode:!0,strict:!0,arrayFormat:"none"},t)),o=Object.keys(e);return!1!==t.sort&&o.sort(t.sort),o.map(o=>{const r=e[o];return void 0===r?"":null===r?Me(o,t):Array.isArray(r)?r.reduce(n(o),[]).join("&"):Me(o,t)+"="+Me(r,t)}).filter(e=>e.length>0).join("&")},parseUrl:(e,t)=>({url:Ie(e).split("?")[0]||"",query:Se(Re(e),t)})};function je(e){var t,n,o,r=e.hasContentWarning&&Le(e);return{c(){r&&r.c(),t=N(),n=x("noscript"),o=x("noscript")},m(a,s){r&&r.m(a,s),b(a,t,s),b(a,n,s),n.insertAdjacentHTML("afterend",e.content),b(a,o,s)},p(e,n){n.hasContentWarning?r?r.p(e,n):((r=Le(n)).c(),r.m(t.parentNode,t)):r&&(r.d(1),r=null)},d(e){r&&r.d(e),e&&(y(t),k(n,o),y(n),y(o))}}}function Ae(e){var t,n,o,r,a,s=e.msg.value.content.contentWarning;return{c(){t=x("p"),n=_(s),o=N(),(r=x("button")).textContent="Show Message",r.className="btn",a=C(r,"click",e.click_handler)},m(e,a){b(e,t,a),v(t,n),b(e,o,a),b(e,r,a)},p(e,t){e.msg&&s!==(s=t.msg.value.content.contentWarning)&&F(n,s)},d(e){e&&(y(t),y(o),y(r)),a()}}}function Le(e){var t,n,o,r,a,s,l,c,i=e.msg.value.content.contentWarning;return{c(){t=x("div"),n=x("p"),(o=x("b")).textContent="Content Warning:",r=N(),a=_(i),s=N(),(l=x("button")).textContent="Hide Message",l.className="btn btn-sm float-right",t.className="toast toast-warning",c=C(l,"click",e.click_handler_1)},m(e,c){b(e,t,c),v(t,n),v(n,o),v(n,r),v(n,a),v(n,s),v(n,l)},p(e,t){e.msg&&i!==(i=t.msg.value.content.contentWarning)&&F(a,i)},d(e){e&&y(t),c()}}}function Ee(e){var t,n,o,r,a;return{c(){t=x("span"),n=x("a"),o=_("(root)"),n.href=r="?thread="+encodeURIComponent(e.msg.value.content.root)+"#/thread",a=C(n,"click",T(e.goRoot))},m(e,r){b(e,t,r),v(t,n),v(n,o)},p(e,t){e.msg&&r!==(r="?thread="+encodeURIComponent(t.msg.value.content.root)+"#/thread")&&(n.href=r)},d(e){e&&y(t),a()}}}function Oe(e){var t,n,o,r,a;return{c(){t=x("span"),n=x("a"),o=_("(in reply to)"),n.href=r="?thread="+encodeURIComponent(e.msg.value.content.branch)+"#/thread",a=C(n,"click",T(e.goBranch))},m(e,r){b(e,t,r),v(t,n),v(n,o)},p(e,t){e.msg&&r!==(r="?thread="+encodeURIComponent(t.msg.value.content.branch)+"#/thread")&&(n.href=r)},d(e){e&&y(t),a()}}}function We(t){var n,o,r,s,l;return{c(){n=x("div"),(o=x("button")).textContent="Fork",r=N(),(s=x("button")).textContent="Reply",o.className="btn",s.className="btn",n.className="column col-6 text-right",l=[C(o,"click",t.fork),C(s,"click",t.reply)]},m(e,t){b(e,n,t),v(n,o),v(n,r),v(n,s)},p:e,d(e){e&&y(n),a(l)}}}function Be(t){var n,o,r,a,s,l,c,i,u,d,m,h,p,g;function f(e){return e.hasContentWarning&&e.showContentWarning?Ae:je}var k=f(t),w=k(t),$=t.msg.value.content.root&&Ee(t),T=t.msg.value.content.branch&&Oe(t),P=!t.msg.value.private&&We(t);return{c(){n=x("div"),w.c(),o=N(),r=x("div"),a=x("div"),s=x("div"),l=x("label"),c=x("input"),i=N(),u=x("i"),d=_("\r\n        Like"),m=N(),$&&$.c(),h=N(),T&&T.c(),p=N(),P&&P.c(),n.className="card-body svelte-1ftdgav",M(c,"type","checkbox"),c.checked=t.liked,u.className="form-icon",l.className="form-switch d-inline",s.className="column col-6",a.className="columns col-gapless",r.className="card-footer",g=C(c,"change",t.likeChanged)},m(e,t){b(e,n,t),w.m(n,null),b(e,o,t),b(e,r,t),v(r,a),v(a,s),v(s,l),v(l,c),v(l,i),v(l,u),v(l,d),v(s,m),$&&$.m(s,null),v(s,h),T&&T.m(s,null),v(a,p),P&&P.m(a,null)},p(e,t){k===(k=f(t))&&w?w.p(e,t):(w.d(1),(w=k(t))&&(w.c(),w.m(n,null))),e.liked&&(c.checked=t.liked),t.msg.value.content.root?$?$.p(e,t):(($=Ee(t)).c(),$.m(s,h)):$&&($.d(1),$=null),t.msg.value.content.branch?T?T.p(e,t):((T=Oe(t)).c(),T.m(s,null)):T&&(T.d(1),T=null),t.msg.value.private?P&&(P.d(1),P=null):P?P.p(e,t):((P=We(t)).c(),P.m(a,null))},i:e,o:e,d(e){e&&y(n),w.d(),e&&(y(o),y(r)),$&&$.d(),T&&T.d(),P&&P.d(),g()}}}function He(e,t,n){let{msg:o}=t,r=ssb.markdown(o.value.content.text),a=!1,s=o.value.content.contentWarning||!1,l=!0;ssb.votes(o.key).then(e=>{e.forEach(e=>{e.value.author===ssb.feed&&1===e.value.content.vote.value&&n("liked",a=!0)})});return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,content:r,liked:a,hasContentWarning:s,showContentWarning:l,likeChanged:e=>{e.target.checked?ssb.like(o.key).then(()=>console.log("liked",o.key)).catch(()=>{const e=a=!1;return n("liked",a),e}):ssb.unlike(o.key).then(()=>console.log("unliked",o.key)).catch(()=>{const e=a=!0;return n("liked",a),e})},reply:e=>{let t=o.value.content.root||o.key,n=o.value.content.channel,r=o.value.author;$o("/compose",{root:t,branch:o.key,channel:n,replyfeed:r})},fork:e=>{let t=o.value.content.root||o.key,n=o.value.content.channel,r=o.value.author;$o("/compose",{root:o.key,branch:o.key,fork:t,channel:n,replyfeed:r})},goRoot:e=>{let t=o.value.content.root||o.key;$o("/thread",{thread:t})},goBranch:e=>{let t=o.value.content.branch||o.key;$o("/thread",{thread:t})},click_handler:function(){const e=l=!l;return n("showContentWarning",l),e},click_handler_1:function(){const e=l=!l;return n("showContentWarning",l),e}}}class qe extends ce{constructor(e){var t;super(),document.getElementById("svelte-1ftdgav-style")||((t=x("style")).id="svelte-1ftdgav-style",t.textContent=".card-body.svelte-1ftdgav{overflow-wrap:break-word}",v(document.head,t)),le(this,e,He,Be,l,["msg"])}}function De(t){var n,o,r,a;return{c(){n=x("div"),o=x("pre"),r=x("code"),a=_(t.rawContent),o.className="code svelte-mp70wj",n.className="card-body"},m(e,t){b(e,n,t),v(n,o),v(o,r),v(r,a)},p:e,i:e,o:e,d(e){e&&y(n)}}}function ze(e,t,n){let{msg:o}=t,r=JSON.stringify(o,null,2);return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,rawContent:r}}class Ye extends ce{constructor(e){var t;super(),document.getElementById("svelte-mp70wj-style")||((t=x("style")).id="svelte-mp70wj-style",t.textContent="pre.code.svelte-mp70wj{overflow:scroll}",v(document.head,t)),le(this,e,ze,De,l,["msg"])}}function Ve(t){var n,o,r,a,s,l,c,i;return{c(){n=x("div"),o=_(t.person),r=N(),a=_(t.expression),s=N(),l=x("a"),c=_(t.label),l.href="/index.html?thread="+t.encodedid+"#/thread",n.className="card-body",i=C(l,"click",t.goThread)},m(e,t){b(e,n,t),v(n,o),v(n,r),v(n,a),v(n,s),v(n,l),v(l,c)},p(e,t){e.person&&F(o,t.person),e.label&&F(c,t.label)},i:e,o:e,d(e){e&&y(n),i()}}}function Ke(e,t,n){let{msg:o}=t,r=o.value.content.vote.expression,a=o.value.content.vote.link,s=encodeURIComponent(a),l=a,c=o.value.author;ssb.blurbFromMsg(a,100).then(e=>{n("label",l=e)}),ssb.avatar(o.value.author).then(e=>{const t=c=e.name;return n("person",c),t});return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,expression:r,encodedid:s,label:l,person:c,goThread:e=>{e.stopPropagation(),e.preventDefault(),e.ctrlKey?window.open(`?thread=${encodeURIComponent(a)}#/thread`):$o("/thread",{thread:a})}}}class Je extends ce{constructor(e){super(),le(this,e,Ke,Ve,l,["msg"])}}function Ge(t){var n;return{c(){(n=x("div")).innerHTML="<p>ðŸ”’ PRIVATE</p>",n.className="card-body"},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Qe(e,t,n){let{msg:o}=t;return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o}}class Xe extends ce{constructor(e){super(),le(this,e,Qe,Ge,l,["msg"])}}function Ze(t){var n,o,r,a,s,l,c,i;return{c(){n=x("div"),o=_(t.person),r=N(),a=_(t.verb),s=N(),l=x("a"),c=_(t.otherPersonName),l.href="?feed="+t.otherPersonFeed+"#/profile",n.className="card-body",i=C(l,"click",t.goProfile)},m(e,t){b(e,n,t),v(n,o),v(n,r),v(n,a),v(n,s),v(n,l),v(l,c)},p(e,t){e.person&&F(o,t.person),e.verb&&F(a,t.verb),e.otherPersonName&&F(c,t.otherPersonName)},i:e,o:e,d(e){e&&y(n),i()}}}function et(e,t,n){let{msg:o}=t,r=o.value.author,a=encodeURIComponent(o.value.content.contact),s=a,l=o.value.content.following?"followed":"unfollowed";o.value.content.blocking&&n("verb",l="blocked"),ssb.avatar(o.value.author).then(e=>{const t=r=e.name;return n("person",r),t}),ssb.avatar(o.value.content.contact).then(e=>{n("otherPersonName",s=e.name)}).catch(e=>console.log(e));return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,person:r,otherPersonFeed:a,otherPersonName:s,verb:l,goProfile:e=>{e.stopPropagation(),e.preventDefault(),$o("/profile",{feed:o.value.content.contact})}}}class tt extends ce{constructor(e){super(),le(this,e,et,Ze,l,["msg"])}}function nt(t){var n,o,r,a,s,l,c,i,u;return{c(){n=x("div"),o=_(t.person),r=N(),a=_(t.verb),s=N(),l=x("a"),c=_("#"),i=_(t.channel),l.href="?channel="+t.channel+"#/channel",n.className="card-body",u=C(l,"click",t.goChannel)},m(e,t){b(e,n,t),v(n,o),v(n,r),v(n,a),v(n,s),v(n,l),v(l,c),v(l,i)},p(e,t){e.person&&F(o,t.person)},i:e,o:e,d(e){e&&y(n),u()}}}function ot(e,t,n){let{msg:o}=t,r=o.value.author,a=o.value.content.subscribed?"subscribed":"unsubscribed",s=encodeURIComponent(o.value.content.channel);ssb.avatar(o.value.author).then(e=>{const t=r=e.name;return n("person",r),t});return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,person:r,verb:a,channel:s,goChannel:e=>{e.stopPropagation(),e.preventDefault(),$o("/channel",{channel:o.value.content.channel})}}}class rt extends ce{constructor(e){super(),le(this,e,ot,nt,l,["msg"])}}function at(e){var t,n,o;return{c(){t=x("div"),n=_(e.person),o=_(" is doing something related to a gathering but gatherings are not\r\n      supported yet, sorry."),t.className="toast"},m(e,r){b(e,t,r),v(t,n),v(t,o)},p(e,t){e.person&&F(n,t.person)},d(e){e&&y(t)}}}function st(e){var t,n,o,r,a,s,l;function c(e){return e.image?ct:lt}var i=c(e),u=i(e),d=e.msg.value.content.description&&it(e);return{c(){t=_(e.person),n=N(),o=_(e.verb),r=N(),a=x("a"),u.c(),s=N(),d&&d.c(),l=$(),a.href="?feed="+e.otherLink+"#/profile"},m(e,c){b(e,t,c),b(e,n,c),b(e,o,c),b(e,r,c),b(e,a,c),u.m(a,null),b(e,s,c),d&&d.m(e,c),b(e,l,c)},p(e,n){e.person&&F(t,n.person),e.verb&&F(o,n.verb),i===(i=c(n))&&u?u.p(e,n):(u.d(1),(u=i(n))&&(u.c(),u.m(a,null))),n.msg.value.content.description?d?d.p(e,n):((d=it(n)).c(),d.m(l.parentNode,l)):d&&(d.d(1),d=null)},d(e){e&&(y(t),y(n),y(o),y(r),y(a)),u.d(),e&&y(s),d&&d.d(e),e&&y(l)}}}function lt(e){var t,n;return{c(){t=x("span"),n=_(e.otherName),t.className="chip"},m(e,o){b(e,t,o),v(t,n)},p(e,t){e.otherName&&F(n,t.otherName)},d(e){e&&y(t)}}}function ct(e){var t,n,o,r;return{c(){t=x("div"),n=x("img"),o=N(),r=_(e.otherName),n.src=e.image,n.className="avatar avatar-sm",n.alt=e.otherName,t.className="chip"},m(e,a){b(e,t,a),v(t,n),v(t,o),v(t,r)},p(e,t){e.otherName&&(n.alt=t.otherName,F(r,t.otherName))},d(e){e&&y(t)}}}function it(e){var t,n=e.ssb.markdown(e.msg.value.content.description);return{c(){t=x("blockquote")},m(e,o){b(e,t,o),t.innerHTML=n},p(e,o){e.msg&&n!==(n=o.ssb.markdown(o.msg.value.content.description))&&(t.innerHTML=n)},d(e){e&&y(t)}}}function ut(t){var n;function o(e){return e.isThisAboutFeeds?st:at}var r=o(t),a=r(t);return{c(){n=x("div"),a.c(),n.className="card-body"},m(e,t){b(e,n,t),a.m(n,null)},p(e,t){r===(r=o(t))&&a?a.p(e,t):(a.d(1),(a=r(t))&&(a.c(),a.m(n,null)))},i:e,o:e,d(e){e&&y(n),a.d()}}}function dt(e,t,n){let{msg:o}=t,r=o.value.author,a=encodeURIComponent(o.value.content.about),s=o.value.content.name||o.value.content.about,l=!0,c=o.value.content.about===o.value.author?"self-identifies":"identifies";ssb.avatar(o.value.author).then(e=>{const t=r=e.name;return n("person",r),t}),s===o.value.content.about&&ssb.avatar(o.value.content.about).then(e=>{const t=s=e.name;return n("otherName",s),t});let i=!!o.value.content.image&&`http://localhost:8989/blobs/get/${encodeURIComponent(o.value.content.image)}`;return o.value.content.description&&n("verb",c+=" with description"),o.value.content.about.startsWith("%")&&n("isThisAboutFeeds",l=!1),e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,person:r,otherLink:a,otherName:s,isThisAboutFeeds:l,verb:c,image:i,ssb:ssb}}class mt extends ce{constructor(e){super(),le(this,e,dt,ut,l,["msg"])}}function ht(t){var n,o,r,a,s,l,c,i;return{c(){n=x("div"),o=_(t.person),r=_(" announced pub\r\n  "),a=x("a"),s=_(t.host),l=_(":"),c=_(t.port),a.href="/index.html?feed="+t.encodedid+"#/profile",n.className="card-body",i=C(a,"click",t.goProfile)},m(e,t){b(e,n,t),v(n,o),v(n,r),v(n,a),v(a,s),v(a,l),v(a,c)},p(e,t){e.person&&F(o,t.person)},i:e,o:e,d(e){e&&y(n),i()}}}function pt(e,t,n){let{msg:o}=t,r=encodeURIComponent(o.value.content.address.key),a=o.value.author,s=o.value.content.address.host,l=o.value.content.address.port;ssb.avatar(o.value.author).then(e=>{const t=a=e.name;return n("person",a),t});return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,encodedid:r,person:a,host:s,port:l,goProfile:e=>{e.stopPropagation(),e.preventDefault(),$o("/profile",{feed:o.value.content.address.key})}}}class gt extends ce{constructor(e){super(),le(this,e,pt,ht,l,["msg"])}}function ft(t){var n,o;return{c(){n=x("div"),(o=x("img")).src="http://localhost:8989/blobs/get/"+encodeURIComponent(t.thumbnail),o.className="img-responsive",o.alt=t.title,n.className="card-image"},m(e,t){b(e,n,t),v(n,o)},p:e,d(e){e&&y(n)}}}function vt(t){var n,o;return{c(){n=x("h1"),o=_(t.title),n.className="card-title h5"},m(e,t){b(e,n,t),v(n,o)},p:e,d(e){e&&y(n)}}}function bt(e){var t,n,o;return{c(){t=x("div"),n=_("Can't load blogpost: "),o=_(e.toastMsg),t.className="toast toast-error"},m(e,r){b(e,t,r),v(t,n),v(t,o)},p(e,t){e.toastMsg&&F(o,t.toastMsg)},d(e){e&&y(t)}}}function yt(t){var n,o;return{c(){n=x("noscript"),o=x("noscript")},m(e,r){b(e,n,r),n.insertAdjacentHTML("afterend",t.summary),b(e,o,r)},p:e,d(e){e&&(k(n,o),y(n),y(o))}}}function kt(e){var t,n;return{c(){t=x("noscript"),n=x("noscript")},m(o,r){b(o,t,r),t.insertAdjacentHTML("afterend",e.post),b(o,n,r)},p(e,o){e.post&&(k(t,n),t.insertAdjacentHTML("afterend",o.post))},d(e){e&&(k(t,n),y(t),y(n))}}}function wt(e){var t,n,o,r,a;return{c(){t=x("span"),n=x("a"),o=_("(root)"),n.href=r="?thread="+encodeURIComponent(e.msg.value.content.root)+"#/thread",a=C(n,"click",T(e.goRoot))},m(e,r){b(e,t,r),v(t,n),v(n,o)},p(e,t){e.msg&&r!==(r="?thread="+encodeURIComponent(t.msg.value.content.root)+"#/thread")&&(n.href=r)},d(e){e&&y(t),a()}}}function xt(e){var t,n,o,r,a;return{c(){t=x("span"),n=x("a"),o=_("(in reply to)"),n.href=r="?thread="+encodeURIComponent(e.msg.value.content.branch)+"#/thread",a=C(n,"click",T(e.goBranch))},m(e,r){b(e,t,r),v(t,n),v(n,o)},p(e,t){e.msg&&r!==(r="?thread="+encodeURIComponent(t.msg.value.content.branch)+"#/thread")&&(n.href=r)},d(e){e&&y(t),a()}}}function _t(e){var t,n;return{c(){(t=x("button")).textContent="Close Blogpost",t.className="btn btn-primary",I(t,"locating",e.loading),n=C(t,"click",e.click_handler)},m(e,n){b(e,t,n)},p(e,n){e.loading&&I(t,"locating",n.loading)},d(e){e&&y(t),n()}}}function Nt(e){var t,n;return{c(){(t=x("button")).textContent="Read Blogpost",t.className="btn btn-primary",I(t,"locating",e.loading),n=C(t,"click",e.displayBlogPost)},m(e,n){b(e,t,n)},p(e,n){e.loading&&I(t,"locating",n.loading)},d(e){e&&y(t),n()}}}function $t(t){var n,o,r,s,l,c,i,u,d,m,h,p,g,f,k,w,$,T,P,F,I=t.thumbnail&&ft(t),R=t.title&&vt(t),S=t.toast&&bt(t);function U(e){return e.showBlogpost?kt:yt}var j=U(t),A=j(t),L=t.msg.value.content.root&&wt(t),E=t.msg.value.content.branch&&xt(t);function O(e){return e.showBlogpost?_t:Nt}var W=O(t),B=W(t);return{c(){I&&I.c(),n=N(),o=x("div"),R&&R.c(),r=N(),S&&S.c(),s=N(),A.c(),l=N(),c=x("div"),i=x("div"),u=x("div"),d=x("label"),m=x("input"),h=N(),p=x("i"),g=_("\r\n        Like"),f=N(),L&&L.c(),k=N(),E&&E.c(),w=N(),$=x("div"),(T=x("button")).textContent="Reply",P=N(),B.c(),o.className="card-body",M(m,"type","checkbox"),m.checked=t.liked,p.className="form-icon",d.className="form-switch d-inline",u.className="column col-6",T.className="btn",$.className="column col-6 text-right",i.className="columns col-gapless",c.className="card-footer",F=[C(m,"change",t.likeChanged),C(T,"click",t.reply)]},m(e,t){I&&I.m(e,t),b(e,n,t),b(e,o,t),R&&R.m(o,null),v(o,r),S&&S.m(o,null),v(o,s),A.m(o,null),b(e,l,t),b(e,c,t),v(c,i),v(i,u),v(u,d),v(d,m),v(d,h),v(d,p),v(d,g),v(u,f),L&&L.m(u,null),v(u,k),E&&E.m(u,null),v(i,w),v(i,$),v($,T),v($,P),B.m($,null)},p(e,t){t.thumbnail?I?I.p(e,t):((I=ft(t)).c(),I.m(n.parentNode,n)):I&&(I.d(1),I=null),t.title?R?R.p(e,t):((R=vt(t)).c(),R.m(o,r)):R&&(R.d(1),R=null),t.toast?S?S.p(e,t):((S=bt(t)).c(),S.m(o,s)):S&&(S.d(1),S=null),j===(j=U(t))&&A?A.p(e,t):(A.d(1),(A=j(t))&&(A.c(),A.m(o,null))),e.liked&&(m.checked=t.liked),t.msg.value.content.root?L?L.p(e,t):((L=wt(t)).c(),L.m(u,k)):L&&(L.d(1),L=null),t.msg.value.content.branch?E?E.p(e,t):((E=xt(t)).c(),E.m(u,null)):E&&(E.d(1),E=null),W===(W=O(t))&&B?B.p(e,t):(B.d(1),(B=W(t))&&(B.c(),B.m($,null)))},i:e,o:e,d(e){I&&I.d(e),e&&(y(n),y(o)),R&&R.d(),S&&S.d(),A.d(),e&&(y(l),y(c)),L&&L.d(),E&&E.d(),B.d(),a(F)}}}function Ct(e,t,n){let o;c(e,No,e=>{n("$routeLocation",o=e)});let{msg:r}=t,a=r.value.content,s=ssb.markdown(a.summary),l=a.thumbnail||!1,i=a.title||!1,u=!1,d=!1,m=!1,h="",p=s,g=!1;ssb.votes(r.key).then(e=>{e.forEach(e=>{e.value.author===ssb.feed&&1===e.value.content.vote.value&&n("liked",g=!0)})});const f=e=>{n("loading",d=!0),console.log("loading blogpost",a.blog),ssb.getBlob(a.blog).then(e=>{n("post",p=ssb.markdown(e)),n("showBlogpost",u=!0)}).catch(e=>{console.error("can't load blog post",e),n("toast",m=!0),n("toastMsg",h=e)})};return"/thread"==o&&setTimeout(f,100),e.$set=(e=>{"msg"in e&&n("msg",r=e.msg)}),{msg:r,summary:s,thumbnail:l,title:i,showBlogpost:u,loading:d,toast:m,toastMsg:h,post:p,liked:g,likeChanged:e=>{e.target.checked?ssb.like(r.key).then(()=>console.log("liked",r.key)).catch(()=>{const e=g=!1;return n("liked",g),e}):ssb.unlike(r.key).then(()=>console.log("unliked",r.key)).catch(()=>{const e=g=!0;return n("liked",g),e})},displayBlogPost:f,reply:e=>{let t=r.value.content.root||r.key,n=r.value.content.channel;$o("/compose",{root:t,branch:r.key,channel:n})},goRoot:e=>{let t=r.value.content.root||r.key;$o("/thread",{thread:t})},goBranch:e=>{let t=r.value.content.branch||r.key;$o("/thread",{thread:t})},click_handler:function(){const e=u=!1;return n("showBlogpost",u),e}}}class Tt extends ce{constructor(e){var t;super(),document.getElementById("svelte-ygl8m2-style")||((t=x("style")).id="svelte-ygl8m2-style",t.textContent="",v(document.head,t)),le(this,e,Ct,$t,l,["msg"])}}function Pt(e){var t,n,o;return{c(){t=x("span"),n=_(e.name),t.className="chip",o=C(t,"click",e.avatarClick)},m(e,o){b(e,t,o),v(t,n)},p(e,t){e.name&&F(n,t.name)},d(e){e&&y(t),o()}}}function Mt(e){var t,n,o,r,a;return{c(){t=x("div"),n=x("img"),o=N(),r=_(e.name),n.src=e.image,n.className="avatar avatar-sm",t.className="chip",a=C(t,"click",e.avatarClick)},m(e,a){b(e,t,a),v(t,n),v(t,o),v(t,r)},p(e,t){e.image&&(n.src=t.image),e.name&&F(r,t.name)},d(e){e&&y(t),a()}}}function Ft(t){var n;function o(e){return e.image?Mt:Pt}var r=o(t),a=r(t);return{c(){a.c(),n=$()},m(e,t){a.m(e,t),b(e,n,t)},p(e,t){r===(r=o(t))&&a?a.p(e,t):(a.d(1),(a=r(t))&&(a.c(),a.m(n.parentNode,n)))},i:e,o:e,d(e){a.d(e),e&&y(n)}}}function It(e,t,n){let{feed:o}=t,r=!1,a=o;const s=W();return ssb.avatar(o).then(e=>{null!==e.image&&n("image",r=`http://localhost:8989/blobs/get/${e.image}`),n("name",a=e.name)}),e.$set=(e=>{"feed"in e&&n("feed",o=e.feed)}),{feed:o,image:r,name:a,avatarClick:function(){s("avatarClick",{feed:o,name:a})}}}class Rt extends ce{constructor(e){super(),le(this,e,It,Ft,l,["feed"])}}var St=function(){};St.prototype.simple=function(e){var t=Date.now(),n=Date.parse(e);try{if(n!=n)throw"timeago-simple: Please check date and time format! Unable to parse the date & time: "+e}catch(t){return console.error(t),e}return n-t<0?function(e){var t=Date.now();e=Date.parse(e);var n=(t-e)/1e3,o=n/60,r=n/3600;if(n<60&&o<1)return 1===n?Math.round(n)+" second ago":Math.round(n)+" seconds ago";if(o<60&&r<1)return 1===o?Math.round(o)+" minute ago":Math.round(o)+" minutes ago";if(r>24){var a=r/24;if(a>30){var s=a/30;if(s>12){var l=s/12;if(l>0)return 1===l?Math.ceil(l)+" year ago":Math.ceil(l)+" years ago"}return Math.round(s)+" month ago"}return 1===a?Math.round(a)+" day ago":Math.round(a)+" days ago"}return 1===r?Math.round(r)+" hour ago":Math.round(r)+" hours ago"}(e):function(e){var t=Date.now(),n=((e=Date.parse(e))-t)/1e3,o=n/60,r=n/3600;if(n<60&&o<1)return 1===n?"in "+Math.round(n)+" second":"in "+Math.round(n)+" seconds";if(o<60&&r<1)return 1===o?"in "+Math.round(o)+" minute":"in "+Math.round(o)+" minutes";if(r>24){var a=r/24;if(a>30){var s=a/30;if(s>12){var l=s/12;if(l>0)return 1===l?"in "+Math.ceil(l)+" year":"in "+Math.ceil(l)+" years"}return"in "+Math.round(s)+" month"}return 1===a?"in "+Math.round(a)+" day":"in "+Math.round(a)+" days"}return 1===r?"in "+Math.round(r)+" hour":"in "+Math.round(r)+" hours"}(e)},St.prototype.future=function(e){console.warn("timeago-simple: .future function is depricated! Please use .simple for both past and future dates.");var t=Date.now();try{if(Date.parse(e)!=Date.parse(e))throw"timeago-simple: Please check date and time format! Unable to parse the date & time: "+e;if(Date.parse(e)-t<0)throw"timeago-simple: Looks like it's more relevant case for timeago.simple"}catch(t){return console.error(t),e}var n=((e=Date.parse(e))-t)/1e3,o=n/60,r=n/3600;if(n<60&&o<1)return 1===n?"in "+Math.round(n)+" second":"in "+Math.round(n)+" seconds";if(o<60&&r<1)return 1===o?"in "+Math.round(o)+" minute":"in "+Math.round(o)+" minutes";if(r>24){var a=r/24;if(a>30){var s=a/30;if(s>12){var l=s/12;if(l>0)return 1===l?"in "+Math.ceil(l)+" year":"in "+Math.ceil(l)+" years"}return"in "+Math.round(s)+" month"}return 1===a?"in "+Math.round(a)+" day":"in "+Math.round(a)+" days"}return 1===r?"in "+Math.round(r)+" hour":"in "+Math.round(r)+" hours"};var Ut=new St;const jt=e=>Ut.simple(new Date(e));function At(e){var t;return{c(){(t=x("span")).textContent="PRIVATE",t.className="label"},m(e,n){b(e,t,n)},d(e){e&&y(t)}}}function Lt(e){var t,n,o=e.msg.value.content.channel;return{c(){t=_("#"),n=_(o)},m(e,o){b(e,t,o),b(e,n,o)},p(e,t){e.msg&&o!==(o=t.msg.value.content.channel)&&F(n,o)},d(e){e&&(y(t),y(n))}}}function Et(e){var t;return{c(){t=_("Close raw message")},m(e,n){b(e,t,n)},d(e){e&&y(t)}}}function Ot(e){var t;return{c(){t=_("Show raw message")},m(e,n){b(e,t,n)},d(e){e&&y(t)}}}function Wt(t){var n,o,r,a,s,l,c,i,u,d,m,h,p,g,f,k,w,$,C,T,P;return{c(){n=x("div"),o=x("div"),r=x("div"),a=x("pre"),s=x("code"),l=_(t.rawContent),c=N(),i=x("div"),u=x("p"),d=_("This is a message of type\r\n            "),m=x("em"),h=_(t.type),p=_("\r\n            ."),g=N(),f=x("p"),k=_("To learn more about it, go to\r\n            "),w=x("a"),$=_("the documentation about messages with type "),C=_(t.type),P=_("\r\n            ."),a.className="code",r.className="column col-9",w.target="_blank",w.href=T="/docs/index.html#/message_types/"+t.type,i.className="column col-3",o.className="columns",n.className="card-body"},m(e,t){b(e,n,t),v(n,o),v(o,r),v(r,a),v(a,s),v(s,l),v(o,c),v(o,i),v(i,u),v(u,d),v(u,m),v(m,h),v(u,p),v(i,g),v(i,f),v(f,k),v(f,w),v(w,$),v(w,C),v(f,P)},p(e,t){e.type&&(F(h,t.type),F(C,t.type)),e.type&&T!==(T="/docs/index.html#/message_types/"+t.type)&&(w.href=T)},i:e,o:e,d(e){e&&y(n)}}}function Bt(e){var t,n,o=e.selectedRenderer;function r(e){return{props:{msg:e.msg}}}if(o)var a=new o(r(e));return{c(){a&&a.$$.fragment.c(),t=$()},m(e,o){a&&ae(a,e,o),b(e,t,o),n=!0},p(e,n){var s={};if(e.msg&&(s.msg=n.msg),o!==(o=n.selectedRenderer)){if(a){Z();const e=a;te(()=>{e.$destroy()}),e.$$.fragment.o(1),ee()}o?((a=new o(r(n))).$$.fragment.c(),a.$$.fragment.i(1),ae(a,t.parentNode,t)):a=null}else o&&a.$set(s)},i(e){n||(a&&a.$$.fragment.i(e),n=!0)},o(e){a&&a.$$.fragment.o(e),n=!1},d(e){e&&y(t),a&&a.$destroy(e)}}}function Ht(e){var t,n,o,r,s,l,c,i,u,d,m,h,p,g,f,k,w,$,P,M,R,S,U,j,A,L,E,O,W,B,H,q,D,z,Y,V,K,J,G,Q,X,ne,oe,re,ae,se,le,ce=jt(e.msg.value.timestamp),ie=e.privateMsgForYou&&At(),ue=e.msg.value.content.channel&&Lt(e);function de(e){return e.showRaw?Et:Ot}var me=de(e),he=me(e),pe=[Bt,Wt],ge=[];function fe(e){return e.showRaw?1:0}return re=fe(e),ae=ge[re]=pe[re](e),{c(){t=x("div"),n=x("div"),o=x("div"),r=x("div"),s=x("div"),l=x("div"),c=x("div"),i=x("img"),u=N(),d=x("div"),m=x("div"),h=_(e.name),p=N(),g=x("small"),f=_(ce),k=N(),ie&&ie.c(),w=N(),$=x("div"),P=x("span"),ue&&ue.c(),M=N(),R=x("div"),(S=x("span")).innerHTML='<i class="icon icon-more-vert"></i>',U=N(),j=x("ul"),A=x("li"),L=x("a"),E=x("i"),O=_("\r\n              Open in new tab"),B=N(),H=x("li"),(q=x("a")).innerHTML='<i class="icon icon-copy"></i>\n\t\t\t              Copy permalink to clipboard\n\t\t\t            ',D=N(),z=x("li"),(Y=x("a")).innerHTML='<i class="icon icon-copy"></i>\n\t\t\t              Copy message id to clipboard\n\t\t\t            ',V=N(),K=x("li"),J=N(),G=x("li"),Q=x("a"),X=x("i"),ne=N(),he.c(),oe=N(),ae.c(),i.src=e.image,i.className="avatar avatar-lg svelte-1jn1wek",i.alt=e.feed,c.className="example-tile-icon",l.className="tile-icon",m.className="tile-title",g.className="tile-subtitle text-gray",d.className="tile-content",s.className="tile tile-centered feed-display svelte-1jn1wek",r.className="card-title",o.className="float-left",P.className="text-gray channel-display svelte-1jn1wek",S.className="btn btn-link dropdown-toggle",S.tabIndex="0",I(S,"active",e.dropdownActive),E.className="icon icon-share",L.href=W="?thread="+e.encodeURIComponent(e.msg.key)+"#/thread",L.target="_blank",A.className="menu-item",q.href="#",H.className="menu-item",Y.href="#",z.className="menu-item",K.className="divider",K.dataset.content="FOR THE CURIOUS",X.className="icon icon-message",Q.href="#",G.className="menu-item",j.className="menu menu-right svelte-1jn1wek",R.className="dropdown",$.className="float-right",n.className="card-header",t.className="card m-2 svelte-1jn1wek",I(t,"private",e.privateMsgForYou),I(t,"blured",e.blured),le=[C(s,"click",e.goProfile),C(P,"click",e.click_handler),C(S,"click",e.click_handler_1),C(q,"click",T(e.copyPermalink)),C(Y,"click",T(e.copyHash)),C(Q,"click",T(e.toggleRawMessage))]},m(e,a){b(e,t,a),v(t,n),v(n,o),v(o,r),v(r,s),v(s,l),v(l,c),v(c,i),v(s,u),v(s,d),v(d,m),v(m,h),v(d,p),v(d,g),v(g,f),v(n,k),ie&&ie.m(n,null),v(n,w),v(n,$),v($,P),ue&&ue.m(P,null),v($,M),v($,R),v(R,S),v(R,U),v(R,j),v(j,A),v(A,L),v(L,E),v(L,O),v(j,B),v(j,H),v(H,q),v(j,D),v(j,z),v(z,Y),v(j,V),v(j,K),v(j,J),v(j,G),v(G,Q),v(Q,X),v(Q,ne),he.m(Q,null),v(t,oe),ge[re].m(t,null),se=!0},p(e,o){se&&!e.image||(i.src=o.image),se&&!e.name||F(h,o.name),se&&!e.msg||ce===(ce=jt(o.msg.value.timestamp))||F(f,ce),o.privateMsgForYou?ie||((ie=At()).c(),ie.m(n,w)):ie&&(ie.d(1),ie=null),o.msg.value.content.channel?ue?ue.p(e,o):((ue=Lt(o)).c(),ue.m(P,null)):ue&&(ue.d(1),ue=null),e.dropdownActive&&I(S,"active",o.dropdownActive),se&&!e.msg||W===(W="?thread="+o.encodeURIComponent(o.msg.key)+"#/thread")||(L.href=W),me!==(me=de(o))&&(he.d(1),(he=me(o))&&(he.c(),he.m(Q,null)));var r=re;(re=fe(o))===r?ge[re].p(e,o):(Z(),te(()=>{ge[r].d(1),ge[r]=null}),ae.o(1),ee(),(ae=ge[re])||(ae=ge[re]=pe[re](o)).c(),ae.i(1),ae.m(t,null)),e.privateMsgForYou&&I(t,"private",o.privateMsgForYou),e.blured&&I(t,"blured",o.blured)},i(e){se||(ae&&ae.i(),se=!0)},o(e){ae&&ae.o(),se=!1},d(e){e&&y(t),ie&&ie.d(),ue&&ue.d(),he.d(),ge[re].d(),a(le)}}}function qt(e,t,n){let o,r,{msg:a}=t,s=a.value.author,l=!1,c=JSON.stringify(a,null,2),i=!1,u=!1,d={"*":Ye,post:qe,vote:Je,private:Xe,contact:tt,channel:rt,about:mt,pub:gt,blog:Tt};"string"==typeof a.value.content?n("type",o="private"):n("type",o=a.value.content.type),a.value.private&&n("privateMsgForYou",u=!0),d.hasOwnProperty(o)?n("selectedRenderer",r=d[o]):n("selectedRenderer",r=d["*"]);let m="images/icon.png",h=s,p=pe(a);ssb.avatar(s).then(e=>{null!==e.image&&n("image",m=`http://localhost:8989/blobs/get/${e.image}`),n("name",h=e.name)});return e.$set=(e=>{"msg"in e&&n("msg",a=e.msg)}),{msg:a,type:o,feed:s,showRaw:l,rawContent:c,dropdownActive:i,privateMsgForYou:u,selectedRenderer:r,image:m,name:h,blured:p,toggleRawMessage:()=>{n("showRaw",l=!l),n("dropdownActive",i=!1)},copyPermalink:()=>{navigator.clipboard.writeText(`ssb:${a.key}`).then(()=>console.log("permalink copied")).catch(e=>console.error("can't copy permalink",e)),n("dropdownActive",i=!1)},copyHash:()=>{navigator.clipboard.writeText(`${a.key}`).then(()=>console.log("hash copied")).catch(e=>console.error("can't copy hash",e)),n("dropdownActive",i=!1)},goProfile:e=>{e.ctrlKey?window.open(`?feed=${encodeURIComponent(s)}#/profile`):$o("/profile",{feed:s})},encodeURIComponent:encodeURIComponent,click_handler:function(){return $o("/channel",{channel:a.value.content.channel})},click_handler_1:function(){const e=i=!i;return n("dropdownActive",i),e}}}class Dt extends ce{constructor(e){var t;super(),document.getElementById("svelte-1jn1wek-style")||((t=x("style")).id="svelte-1jn1wek-style",t.textContent=".blured.svelte-1jn1wek img.svelte-1jn1wek{filter:blur(20px) !important}.blured.svelte-1jn1wek{border:solid 2px red}.feed-display.svelte-1jn1wek{cursor:pointer}.channel-display.svelte-1jn1wek{cursor:pointer}.menu-right.svelte-1jn1wek{right:0px;left:unset;min-width:300px}.private.svelte-1jn1wek{border:solid 2px orange}",v(document.head,t)),le(this,e,qt,Ht,l,["msg"])}}function zt(e,t,n){const o=Object.create(e);return o.msg=t[n],o}function Yt(t){var n,o,r;return{c(){n=x("div"),o=_("Error: "),r=_(t.error),n.className="toast toast-error"},m(e,t){b(e,n,t),v(n,o),v(n,r)},p:e,d(e){e&&y(n)}}}function Vt(e){var t,n,o,r,s,l,c,i,u,d=[],m=new Map,h=e.msgs;const p=e=>e.msg.key;for(var g=0;g<h.length;g+=1){let t=zt(e,h,g),n=p(t);m.set(n,d[g]=Jt(n,t))}return{c(){for(g=0;g<d.length;g+=1)d[g].c();t=N(),n=x("ul"),o=x("li"),(r=x("a")).innerHTML='<div class="page-item-subtitle">Previous</div>',s=N(),l=x("li"),(c=x("a")).innerHTML='<div class="page-item-subtitle">Next</div>',r.href="#/public",o.className="page-item page-previous",c.href="#/public",l.className="page-item page-next",n.className="pagination",u=[C(r,"click",P(T(e.goPrevious))),C(c,"click",P(T(e.goNext)))]},m(e,a){for(g=0;g<d.length;g+=1)d[g].m(e,a);b(e,t,a),b(e,n,a),v(n,o),v(o,r),v(n,s),v(n,l),v(l,c),i=!0},p(e,n){const o=n.msgs;Z(),d=re(d,e,p,1,n,o,m,t.parentNode,oe,Jt,t,zt),ee()},i(e){if(!i){for(var t=0;t<h.length;t+=1)d[t].i();i=!0}},o(e){for(g=0;g<d.length;g+=1)d[g].o();i=!1},d(e){for(g=0;g<d.length;g+=1)d[g].d(e);e&&(y(t),y(n)),a(u)}}}function Kt(t){var n;return{c(){(n=x("div")).className="loading loading-lg"},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Jt(e,t){var n,o,r=new Dt({props:{msg:t.msg}});return{key:e,first:null,c(){n=$(),r.$$.fragment.c(),this.first=n},m(e,t){b(e,n,t),ae(r,e,t),o=!0},p(e,t){var n={};e.msgs&&(n.msg=t.msg),r.$set(n)},i(e){o||(r.$$.fragment.i(e),o=!0)},o(e){r.$$.fragment.o(e),o=!1},d(e){e&&y(n),r.$destroy(e)}}}function Gt(e){var t,n,o,r,a,s,l,c=e.error&&Yt(e),i=[Kt,Vt],u=[];function d(e){return e.msgs?1:0}return r=d(e),a=u[r]=i[r](e),{c(){(t=x("div")).innerHTML='<div class="columns"><h4 class="column">Public Feed</h4>\n\t\t\t    <div class="column"></div></div>',n=N(),c&&c.c(),o=N(),a.c(),s=$(),t.className="container"},m(e,a){b(e,t,a),b(e,n,a),c&&c.m(e,a),b(e,o,a),u[r].m(e,a),b(e,s,a),l=!0},p(e,t){t.error?c?c.p(e,t):((c=Yt(t)).c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null);var n=r;(r=d(t))===n?u[r].p(e,t):(Z(),te(()=>{u[n].d(1),u[n]=null}),a.o(1),ee(),(a=u[r])||(a=u[r]=i[r](t)).c(),a.i(1),a.m(s.parentNode,s))},i(e){l||(a&&a.i(),l=!0)},o(e){a&&a.o(),l=!1},d(e){e&&(y(t),y(n)),c&&c.d(e),e&&y(o),u[r].d(e),e&&y(s)}}}function Qt(e,t,n){let o;c(e,_o,e=>{n("$routeParams",o=e)});let r=!1,a=o.error||!1,s={};return e.$$.update=((e={opts:1,$routeParams:1,error:1})=>{if(e.opts||e.$routeParams||e.error){Object.assign(s,o),document.title="Patchfox - Public",s.hasOwnProperty("lt")&&(s.lt=parseInt(s.lt),n("opts",s),n("$routeParams",o),n("error",a)),s.hasOwnProperty("limit")&&(s.limit=parseInt(s.limit),n("opts",s),n("$routeParams",o),n("error",a));ssb.public(s).then(e=>{n("msgs",r=e),window.scrollTo(0,0)}).catch(e=>{a||console.error("errrrooooor",e)})}}),{msgs:r,error:a,goNext:()=>{$o("/public",{lt:r[r.length-1].value.timestamp})},goPrevious:()=>{history.back()}}}function Xt(t){var n;return{c(){(n=x("div")).className="empty"},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Zt(e){return e.stopPropagation(),e.preventDefault(),!1}var en=function(e,t){e.addEventListener("dragenter",Zt,!1),e.addEventListener("dragover",Zt,!1),e.addEventListener("drop",function(e,t){t.stopPropagation(),t.preventDefault(),e(Array.prototype.slice.call(t.dataTransfer.files))}.bind(void 0,t),!1)};function tn(e){const t=e-1;return t*t*t+1}function nn(e,{delay:t=0,duration:n=400,easing:o=tn}){const r=getComputedStyle(e),a=+r.opacity,s=parseFloat(r.height),l=parseFloat(r.paddingTop),c=parseFloat(r.paddingBottom),i=parseFloat(r.marginTop),u=parseFloat(r.marginBottom),d=parseFloat(r.borderTopWidth),m=parseFloat(r.borderBottomWidth);return{delay:t,duration:n,easing:o,css:e=>"overflow: hidden;"+`opacity: ${Math.min(20*e,1)*a};`+`height: ${e*s}px;`+`padding-top: ${e*l}px;`+`padding-bottom: ${e*c}px;`+`margin-top: ${e*i}px;`+`margin-bottom: ${e*u}px;`+`border-top-width: ${e*d}px;`+`border-bottom-width: ${e*m}px;`}}function on(t){var n,o,r;return{c(){n=x("div"),o=_("You are forking: "),r=_(t.fork),n.className="toast toast-warning"},m(e,t){b(e,n,t),v(n,o),v(n,r)},p:e,d(e){e&&y(n)}}}function rn(e){var t;function n(e){return e.error?sn:an}var o=n(e),r=o(e);return{c(){r.c(),t=$()},m(e,n){r.m(e,n),b(e,t,n)},p(e,a){o===(o=n(a))&&r?r.p(e,a):(r.d(1),(r=o(a))&&(r.c(),r.m(t.parentNode,t)))},d(e){r.d(e),e&&y(t)}}}function an(e){var t,n,o,r,a;return{c(){t=x("div"),n=_("Your message has been posted. Do you want to\r\n            "),o=x("a"),r=_("Check it out?"),o.target="_blank",o.href=a="?thread="+e.encodeURIComponent(e.msg.key)+"#/thread",t.className="toast toast-success"},m(e,a){b(e,t,a),v(t,n),v(t,o),v(o,r)},p(e,t){e.msg&&a!==(a="?thread="+t.encodeURIComponent(t.msg.key)+"#/thread")&&(o.href=a)},d(e){e&&y(t)}}}function sn(e){var t,n;return{c(){t=x("div"),n=_(e.msg),t.className="toast toast-error"},m(e,o){b(e,t,o),v(t,n)},p(e,t){e.msg&&F(n,t.msg)},d(e){e&&y(t)}}}function ln(t){var n,o,r,s,l,c,i,u,d,m,h,p,g,f,w,_,$,T=t.ssb.markdown(t.content),P=(t.channel||t.root||t.branch||t.contentWarning.length>0)&&un(t);return{c(){n=x("div"),(o=x("h2")).textContent="Post preview",r=N(),P&&P.c(),s=N(),l=x("noscript"),c=x("noscript"),i=N(),u=x("div"),d=N(),m=x("div"),(h=x("div")).innerHTML='<span class="label label-warning">\n\t\t\t                This message will be public and can\'t be edited or deleted\n\t\t\t              </span>',p=N(),g=x("div"),(f=x("button")).textContent="Go Back",w=N(),(_=x("button")).textContent="Post",u.className="divider",h.className="column col-md-12 col-lg-10",f.className="btn",_.className="btn btn-primary",I(_,"loading",t.posting),g.className="column col-md-12 col-lg-2",m.className="columns",n.className="column col-md-12",$=[C(f,"click",t.click_handler),C(_,"click",t.post)]},m(e,t){b(e,n,t),v(n,o),v(n,r),P&&P.m(n,null),v(n,s),v(n,l),l.insertAdjacentHTML("afterend",T),v(n,c),v(n,i),v(n,u),v(n,d),v(n,m),v(m,h),v(m,p),v(m,g),v(g,f),v(g,w),v(g,_)},p(e,t){t.channel||t.root||t.branch||t.contentWarning.length>0?P?P.p(e,t):((P=un(t)).c(),P.m(n,s)):P&&(P.d(1),P=null),e.content&&T!==(T=t.ssb.markdown(t.content))&&(k(l,c),l.insertAdjacentHTML("afterend",T)),e.posting&&I(_,"loading",t.posting)},i:e,o:e,d(e){e&&y(n),P&&P.d(),a($)}}}function cn(n){var o,r,s,l,c,i,d,m,h,p,g,k,w,_,$,F,R,S,U,L,E,O,W,B,H,q=n.branch&&gn(n),D=n.replyfeed&&fn(n),z=n.showContentWarningField&&vn(n),Y=n.ipfsDaemonRunning&&bn(n);return{c(){o=x("div"),(r=x("label")).textContent="Channel",s=N(),l=x("input"),c=N(),q&&q.c(),i=N(),D&&D.c(),d=N(),(m=x("label")).textContent="Message",h=N(),p=x("textarea"),g=N(),k=x("div"),(w=x("button")).textContent="CW",_=N(),z&&z.c(),$=N(),F=x("input"),R=N(),(S=x("button")).textContent="Attach File",U=N(),Y&&Y.c(),L=N(),(E=x("button")).textContent="Preview",r.className="form-label",r.htmlFor="channel",l.className="form-input",M(l,"type","text"),l.id="channel",l.placeholder="channel",m.className="form-label",m.htmlFor="content",p.className="form-input svelte-olsuyr",p.id="content",p.placeholder="Type in your post",p.rows="10",I(p,"file-on-top",n.fileOnTop),w.className="btn btn-link",k.className="d-block m-2",M(F,"type","file"),F.id="fileInput",F.className="svelte-olsuyr",S.className="btn",E.className="btn btn-primary float-right",o.className="form-group",H=[C(l,"input",n.input0_input_handler),C(p,"input",n.textarea_input_handler),C(p,"dragover",P(T(n.dragOver))),C(p,"dragleave",P(T(n.dragLeave))),C(w,"click",n.toggleContentWarning),C(F,"input",n.attachFile),C(S,"click",n.attachFileTrigger),C(E,"click",n.preview)]},m(e,t){b(e,o,t),v(o,r),v(o,s),v(o,l),l.value=n.channel,v(o,c),q&&q.m(o,null),v(o,i),D&&D.m(o,null),v(o,d),v(o,m),v(o,h),v(o,p),p.value=n.content,v(o,g),v(o,k),v(k,w),v(k,_),z&&z.m(k,null),v(o,$),v(o,F),v(o,R),v(o,S),v(o,U),Y&&Y.m(o,null),v(o,L),v(o,E),B=!0},p(e,t){e.channel&&l.value!==t.channel&&(l.value=t.channel),t.branch?q?q.p(e,t):((q=gn(t)).c(),q.m(o,i)):q&&(q.d(1),q=null),t.replyfeed?D?(D.p(e,t),D.i(1)):((D=fn(t)).c(),D.i(1),D.m(o,d)):D&&(Z(),te(()=>{D.d(1),D=null}),D.o(1),ee()),e.content&&(p.value=t.content),e.fileOnTop&&I(p,"file-on-top",t.fileOnTop),t.showContentWarningField?z?z.p(e,t):((z=vn(t)).c(),z.m(k,null)):z&&(z.d(1),z=null),t.ipfsDaemonRunning?Y?Y.p(e,t):((Y=bn(t)).c(),Y.m(o,L)):Y&&(Y.d(1),Y=null)},i(n){B||(D&&D.i(),V(()=>{W&&W.end(1),O||(O=function(n,o,r){let a,s,l=o(n,r),c=!1,i=0;function d(){a&&A(n,a)}function m(){const{delay:o=0,duration:r=300,easing:m=t,tick:h=e,css:p}=l;p&&(a=j(n,0,1,r,o,m,p,i++)),h(0,1);const g=u()+o,v=g+r;s&&s.abort(),c=!0,s=f(e=>{if(c){if(e>=v)return h(1,0),d(),c=!1;if(e>=g){const t=m((e-g)/r);h(t,1-t)}}return c})}let h=!1;return{start(){h||(A(n),"function"==typeof l?(l=l(),X().then(m)):m())},invalidate(){h=!1},end(){c&&(d(),c=!1)}}}(o,nn,{})),O.start()}),B=!0)},o(n){D&&D.o(),O&&O.invalidate(),n&&(W=function(n,o,r){let s,l=o(n,r),c=!0;const i=Q;function d(){const{delay:o=0,duration:r=300,easing:d=t,tick:m=e,css:h}=l;h&&(s=j(n,1,0,r,o,d,h));const p=u()+o,g=p+r;f(e=>{if(c){if(e>=g)return m(0,1),--i.remaining||a(i.callbacks),!1;if(e>=p){const t=d((e-p)/r);m(1-t,t)}}return c})}return i.remaining+=1,"function"==typeof l?X().then(()=>{l=l(),d()}):d(),{end(e){e&&l.tick&&l.tick(1,0),c&&(s&&A(n,s),c=!1)}}}(o,nn,{})),B=!1},d(e){e&&y(o),q&&q.d(),D&&D.d(),z&&z.d(),Y&&Y.d(),e&&W&&W.end(),a(H)}}}function un(e){var t,n,o,r,a=e.channel&&dn(e),s=e.root&&mn(e),l=e.branch&&hn(e),c=e.contentWarning.length>0&&pn(e);return{c(){t=x("blockquote"),a&&a.c(),n=N(),s&&s.c(),o=N(),l&&l.c(),r=N(),c&&c.c()},m(e,i){b(e,t,i),a&&a.m(t,null),v(t,n),s&&s.m(t,null),v(t,o),l&&l.m(t,null),v(t,r),c&&c.m(t,null)},p(e,i){i.channel?a?a.p(e,i):((a=dn(i)).c(),a.m(t,n)):a&&(a.d(1),a=null),i.root?s?s.p(e,i):((s=mn(i)).c(),s.m(t,o)):s&&(s.d(1),s=null),i.branch?l?l.p(e,i):((l=hn(i)).c(),l.m(t,r)):l&&(l.d(1),l=null),i.contentWarning.length>0?c?c.p(e,i):((c=pn(i)).c(),c.m(t,null)):c&&(c.d(1),c=null)},d(e){e&&y(t),a&&a.d(),s&&s.d(),l&&l.d(),c&&c.d()}}}function dn(e){var t,n,o,r,a=e.channel.startsWith("#")?e.channel.slice(1):e.channel;return{c(){t=x("p"),(n=x("b")).textContent="Channel:",o=N(),r=_(a)},m(e,a){b(e,t,a),v(t,n),v(t,o),v(t,r)},p(e,t){e.channel&&a!==(a=t.channel.startsWith("#")?t.channel.slice(1):t.channel)&&F(r,a)},d(e){e&&y(t)}}}function mn(t){var n,o,r,a;return{c(){n=x("p"),(o=x("b")).textContent="Root:",r=N(),a=_(t.root)},m(e,t){b(e,n,t),v(n,o),v(n,r),v(n,a)},p:e,d(e){e&&y(n)}}}function hn(e){var t,n,o,r;return{c(){t=x("p"),(n=x("b")).textContent="In Reply To:",o=N(),r=_(e.branch)},m(e,a){b(e,t,a),v(t,n),v(t,o),v(t,r)},p(e,t){e.branch&&F(r,t.branch)},d(e){e&&y(t)}}}function pn(e){var t,n,o,r;return{c(){t=x("p"),(n=x("b")).textContent="Content Warning:",o=N(),r=_(e.contentWarning)},m(e,a){b(e,t,a),v(t,n),v(t,o),v(t,r)},p(e,t){e.contentWarning&&F(r,t.contentWarning)},d(e){e&&y(t)}}}function gn(e){var t,n,o,r;return{c(){(t=x("label")).textContent="In reply to",n=N(),o=x("input"),t.className="form-label",t.htmlFor="reply-to",o.className="form-input",M(o,"type","text"),o.id="reply-to",o.placeholder="in reply to",r=C(o,"input",e.input_input_handler)},m(r,a){b(r,t,a),b(r,n,a),b(r,o,a),o.value=e.branch},p(e,t){e.branch&&o.value!==t.branch&&(o.value=t.branch)},d(e){e&&(y(t),y(n),y(o)),r()}}}function fn(e){var t,n,o,r,a=new Rt({props:{feed:e.replyfeed}});return a.$on("avatarClick",e.avatarClick),{c(){t=x("div"),n=x("span"),o=_("Click the avatar to add a link to the message:\r\n                "),a.$$.fragment.c(),t.className="mt-2"},m(e,s){b(e,t,s),v(t,n),v(n,o),ae(a,n,null),r=!0},p(e,t){var n={};e.replyfeed&&(n.feed=t.replyfeed),a.$set(n)},i(e){r||(a.$$.fragment.i(e),r=!0)},o(e){a.$$.fragment.o(e),r=!1},d(e){e&&y(t),a.$destroy()}}}function vn(e){var t,n;return{c(){M(t=x("input"),"type","text"),t.size="50",t.placeholder="Describe your content warning (leave empty to no use it)",n=C(t,"input",e.input_input_handler_1)},m(n,o){b(n,t,o),t.value=e.contentWarning},p(e,n){e.contentWarning&&t.value!==n.contentWarning&&(t.value=n.contentWarning)},d(e){e&&y(t),n()}}}function bn(t){var n,o,r,s;return{c(){n=x("input"),o=N(),(r=x("button")).textContent="Attach File using IPFS",M(n,"type","file"),n.id="fileInputIPFS",n.className="svelte-olsuyr",r.className="btn",s=[C(n,"input",t.attachFileIPFS),C(r,"click",t.attachFileIPFSTrigger)]},m(e,t){b(e,n,t),b(e,o,t),b(e,r,t)},p:e,d(e){e&&(y(n),y(o),y(r)),a(s)}}}function yn(e){var t,n,o,r,a,s,l,c,i=e.fork&&on(e),u=e.msg&&rn(e),d=[cn,ln],m=[];function h(e){return e.showPreview?1:0}return s=h(e),l=m[s]=d[s](e),{c(){t=x("div"),n=x("div"),o=x("div"),i&&i.c(),r=N(),u&&u.c(),a=N(),l.c(),o.className="column",n.className="columns",t.className="container"},m(e,l){b(e,t,l),v(t,n),v(n,o),i&&i.m(o,null),v(o,r),u&&u.m(o,null),v(o,a),m[s].m(o,null),c=!0},p(e,t){t.fork?i?i.p(e,t):((i=on(t)).c(),i.m(o,r)):i&&(i.d(1),i=null),t.msg?u?u.p(e,t):((u=rn(t)).c(),u.m(o,a)):u&&(u.d(1),u=null);var n=s;(s=h(t))===n?m[s].p(e,t):(Z(),te(()=>{m[n].d(1),m[n]=null}),l.o(1),ee(),(l=m[s])||(l=m[s]=d[s](t)).c(),l.i(1),l.m(o,null))},i(e){c||(l&&l.i(),c=!0)},o(e){l&&l.o(),c=!1},d(e){e&&y(t),i&&i.d(),u&&u.d(),m[s].d()}}}function kn(e,t,n){let o;c(e,_o,e=>{n("$routeParams",o=e)});let r=!1,a=!1,s=!1,l=!1,i=o.root,u=o.branch,d=o.channel||"",m=o.content||"",h=o.replyfeed||!1,p=o.fork,g=!1,f=hermiebox.modules.pullStream,v=hermiebox.modules.pullFileReader,b=hermiebox.sbot,y=!1;document.title="Patchfox - compose",O(()=>{n("error",s=!1),n("msg",a=""),en(document.getElementById("content"),e=>w(e)),k()});const k=()=>{let e=Po("ipfsPort",5001);fetch(`http://127.0.0.1:${e}/api/v0/config/show`).then(e=>{n("ipfsDaemonRunning",y=!0)})},w=e=>{if(n("error",s=!1),n("msg",a=""),0==e.length)return n("fileOnTop",g=!1),console.log("this is not a file"),!1;var t=e[0];return console.log(t),t.type.startsWith("image")?t.size>=5e6?(n("error",s=!0),n("msg",a=`File too large: ${Math.floor(t.size/1048576,2)}mb when max size is 5mb`),!1):void f(v(t),b.blobs.add(function(e,o){e?(n("error",s=!0),n("msg",a="Couldn't attach file: "+e)):n("content",m+=` ![${t.name}](${o})`),n("fileOnTop",g=!1)})):(n("error",s=!0),n("msg",a=`You can only drag & drop image, this file is a ${t.type}`),!1)},x=async e=>{n("error",s=!1),n("msg",a="");var t=window.IpfsHttpClient("127.0.0.1","5001");const o=await t.add(e[0]);console.log("added via IPFS",o),n("content",m+=` [${o[0].path}](ipfs://${o[0].hash})`)};let _=!1;let N="";return{showPreview:r,msg:a,error:s,posting:l,root:i,branch:u,channel:d,content:m,replyfeed:h,fork:p,fileOnTop:g,ipfsDaemonRunning:y,post:async e=>{if(e.stopPropagation(),e.preventDefault(),!l){n("posting",l=!0),d.startsWith("#")&&n("channel",d=d.slice(1));try{n("msg",a=await ssb.newPost({text:m,channel:d,root:i,branch:u,fork:p,contentWarning:N.length>0?N:void 0})),n("posting",l=!1),console.log("posted",a),window.scrollTo(0,0)}catch(e){n("error",s=!0),n("msg",a=`Couldn't post your message: ${e}`),window.scrollTo(0,0),"stream is closed"==a.message&&(n("msg",a+=". We lost connection to sbot. We'll try to restablish it..."),To().then(()=>{n("showPreview",r=!1),n("posting",l=!1),n("error",s=!1),n("msg",a="Connection to sbot reestablished. Try posting again")}).catch(e=>{window.location.search=`?root=${encodeURIComponent(i)}&branch=${encodeURIComponent(u)}&content=${encodeURIComponent(m)}&channel=${encodeURIComponent(d)}`,n("msg",a=`Sorry, couldn't reconnect to sbot:${e}. Try reloading the page. Your content has been saved to the URL`)}))}}},preview:e=>{n("showPreview",r=!0)},avatarClick:e=>{let t=e.detail.feed,o=e.detail.name;m.length>0?n("content",m+=` [${o}](${t})`):n("content",m=`[${o}](${t})`)},dragOver:e=>{n("fileOnTop",g=!0)},dragLeave:e=>{n("fileOnTop",g=!1)},attachFileTrigger:()=>{document.getElementById("fileInput").click()},attachFileIPFSTrigger:()=>{document.getElementById("fileInputIPFS").click()},attachFile:e=>{const t=e.target.files;w(t)},attachFileIPFS:e=>{const t=e.target.files;x(t)},showContentWarningField:_,toggleContentWarning:()=>{const e=_=!_;return n("showContentWarningField",_),e},contentWarning:N,ssb:ssb,encodeURIComponent:encodeURIComponent,input0_input_handler:function(){d=this.value,n("channel",d)},input_input_handler:function(){u=this.value,n("branch",u)},textarea_input_handler:function(){m=this.value,n("content",m)},input_input_handler_1:function(){N=this.value,n("contentWarning",N)},click_handler:function(){const e=r=!1;return n("showPreview",r),e}}}function wn(e,t,n){const o=Object.create(e);return o.msg=t[n],o}function xn(e){var t,n,o,r,a,s,l;return{c(){t=x("div"),n=_("Couldn't load thead\r\n    "),o=x("a"),r=_(e.msgid),s=_("\r\n    : "),l=_(e.error),o.href=a="?thread="+e.msgid+"#/thread",t.className="toast toast-error"},m(e,a){b(e,t,a),v(t,n),v(t,o),v(o,r),v(t,s),v(t,l)},p(e,t){e.msgid&&F(r,t.msgid),e.msgid&&a!==(a="?thread="+t.msgid+"#/thread")&&(o.href=a),e.error&&F(l,t.error)},d(e){e&&y(t)}}}function _n(e){var t,n,o=[],r=new Map,a=e.msgs;const s=e=>e.msg.key;for(var l=0;l<a.length;l+=1){let t=wn(e,a,l),n=s(t);r.set(n,o[l]=$n(n,t))}return{c(){for(l=0;l<o.length;l+=1)o[l].c();t=$()},m(e,r){for(l=0;l<o.length;l+=1)o[l].m(e,r);b(e,t,r),n=!0},p(e,n){const a=n.msgs;Z(),o=re(o,e,s,1,n,a,r,t.parentNode,oe,$n,t,wn),ee()},i(e){if(!n){for(var t=0;t<a.length;t+=1)o[t].i();n=!0}},o(e){for(l=0;l<o.length;l+=1)o[l].o();n=!1},d(e){for(l=0;l<o.length;l+=1)o[l].d(e);e&&y(t)}}}function Nn(t){var n;return{c(){(n=x("div")).className="loading loading-lg"},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function $n(e,t){var n,o,r=new Dt({props:{msg:t.msg}});return{key:e,first:null,c(){n=$(),r.$$.fragment.c(),this.first=n},m(e,t){b(e,n,t),ae(r,e,t),o=!0},p(e,t){var n={};e.msgs&&(n.msg=t.msg),r.$set(n)},i(e){o||(r.$$.fragment.i(e),o=!0)},o(e){r.$$.fragment.o(e),o=!1},d(e){e&&y(n),r.$destroy(e)}}}function Cn(e){var t,n,o,r,a,s,l,c,i,u,d,m=e.error&&xn(e),h=[Nn,_n],p=[];function g(e){return e.msgs||e.error?1:0}return c=g(e),i=p[c]=h[c](e),{c(){t=x("div"),n=x("h4"),o=_("Thread\r\n    "),r=x("small"),a=_(e.msgid),s=N(),m&&m.c(),l=N(),i.c(),u=$(),r.className="label hide-sm",t.className="container"},m(e,i){b(e,t,i),v(t,n),v(n,o),v(n,r),v(r,a),b(e,s,i),m&&m.m(e,i),b(e,l,i),p[c].m(e,i),b(e,u,i),d=!0},p(e,t){d&&!e.msgid||F(a,t.msgid),t.error?m?m.p(e,t):((m=xn(t)).c(),m.m(l.parentNode,l)):m&&(m.d(1),m=null);var n=c;(c=g(t))===n?p[c].p(e,t):(Z(),te(()=>{p[n].d(1),p[n]=null}),i.o(1),ee(),(i=p[c])||(i=p[c]=h[c](t)).c(),i.i(1),i.m(u.parentNode,u))},i(e){d||(i&&i.i(),d=!0)},o(e){i&&i.o(),d=!1},d(e){e&&(y(t),y(s)),m&&m.d(e),e&&y(l),p[c].d(e),e&&y(u)}}}function Tn(e,t,n){let o;c(e,_o,e=>{n("$routeParams",o=e)});let r,a=!1,s=!1;return e.$$.update=((e={$routeParams:1,msgid:1})=>{if(e.$routeParams||e.msgid){n("msgid",r=o.thread),r.startsWith("ssb:")&&n("msgid",r=r.replace("ssb:","")),document.title=`Patchfox - Thread: ${r}`;ssb.thread(r).then(e=>{n("msgs",a=e),window.scrollTo(0,0)}).catch(e=>{console.dir(e),n("error",s=e.message)})}}),{msgs:a,error:s,msgid:r}}function Pn(e,t,n){const o=Object.create(e);return o.msg=t[n],o}function Mn(t){var n,o,r,a=t.n.message;return{c(){n=x("p"),o=_("Error: "),r=_(a)},m(e,t){b(e,n,t),v(n,o),v(n,r)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Fn(e){var t,o,r,a,s,l,c,i,u,d,m,h,p,g,f,k,w,$,C,T=e.ssb.markdown(e.description),P=e.feed!==e.ssb.feed&&In(e);let M={ctx:e,current:null,pending:jn,then:Sn,catch:Rn,value:"data",error:"n",blocks:Array(3)};return ne($=e.messagePromise,M),{c(){t=x("div"),o=x("div"),r=x("div"),a=x("img"),l=N(),c=x("div"),i=x("h1"),u=_(e.name),d=N(),m=x("pre"),h=_(e.feed),p=N(),P&&P.c(),g=N(),f=x("p"),k=N(),w=x("div"),M.block.c(),a.className="img-responsive",a.src=s="http://localhost:8989/blobs/get/"+e.image,a.alt=e.feed,r.className="container",o.className="column col-6",c.className="column col-6",t.className="columns"},m(e,n){b(e,t,n),v(t,o),v(o,r),v(r,a),v(t,l),v(t,c),v(c,i),v(i,u),v(c,d),v(c,m),v(m,h),v(c,p),P&&P.m(c,null),v(c,g),v(c,f),f.innerHTML=T,b(e,k,n),b(e,w,n),M.block.m(w,M.anchor=null),M.mount=(()=>w),M.anchor=null,C=!0},p(t,o){e=o,C&&!t.image||s===(s="http://localhost:8989/blobs/get/"+e.image)||(a.src=s),C&&!t.feed||(a.alt=e.feed),C&&!t.name||F(u,e.name),C&&!t.feed||F(h,e.feed),e.feed!==e.ssb.feed?P?P.p(t,e):((P=In(e)).c(),P.m(c,g)):P&&(P.d(1),P=null),C&&!t.description||T===(T=e.ssb.markdown(e.description))||(f.innerHTML=T),M.ctx=e,"messagePromise"in t&&$!==($=e.messagePromise)&&ne($,M)||M.block.p(t,n(n({},e),M.resolved))},i(e){C||(M.block.i(),C=!0)},o(e){for(let e=0;e<3;e+=1){const t=M.blocks[e];t&&t.o()}C=!1},d(e){e&&y(t),P&&P.d(),e&&(y(k),y(w)),M.block.d(),M=null}}}function In(e){var t,n,o,r,s,l,c,i,u,d,m,h,p,g,f,k,w,$;return{c(){t=x("div"),n=x("div"),o=N(),r=x("div"),s=x("label"),l=x("input"),c=N(),i=x("i"),u=_("\r\n                following"),d=N(),m=x("label"),h=x("input"),p=N(),g=x("i"),f=_("\r\n                blocking"),k=N(),w=x("div"),n.className="divider",M(l,"type","checkbox"),i.className="form-icon",s.className="form-switch form-inline",M(h,"type","checkbox"),g.className="form-icon",m.className="form-switch form-inline",r.className="form-group",w.className="divider",t.className="container",$=[C(l,"change",e.input0_change_handler),C(l,"change",e.followingChanged),C(h,"change",e.input1_change_handler),C(h,"change",e.blockingChanged)]},m(a,y){b(a,t,y),v(t,n),v(t,o),v(t,r),v(r,s),v(s,l),l.checked=e.following,v(s,c),v(s,i),v(s,u),v(r,d),v(r,m),v(m,h),h.checked=e.blocking,v(m,p),v(m,g),v(m,f),v(t,k),v(t,w)},p(e,t){e.following&&(l.checked=t.following),e.blocking&&(h.checked=t.blocking)},d(e){e&&y(t),a($)}}}function Rn(t){var n,o,r,a=t.n.message;return{c(){n=x("p"),o=_("Error fetching messages: "),r=_(a)},m(e,t){b(e,n,t),v(n,o),v(n,r)},p(e,t){e.messagePromise&&a!==(a=t.n.message)&&F(r,a)},i:e,o:e,d(e){e&&y(n)}}}function Sn(e){var t,n,o,r,a,s,l=[],c=new Map,i=e.lastMsgs;const u=e=>e.msg.key;for(var d=0;d<i.length;d+=1){let t=Pn(e,i,d),n=u(t);c.set(n,l[d]=Un(n,t))}return{c(){for(d=0;d<l.length;d+=1)l[d].c();t=N(),n=x("ul"),o=x("li"),(r=x("a")).innerHTML='<div class="page-item-subtitle">Load More</div>',r.href="#/public",o.className="page-item page-next",n.className="pagination",s=C(r,"click",P(T(e.click_handler)))},m(e,s){for(d=0;d<l.length;d+=1)l[d].m(e,s);b(e,t,s),b(e,n,s),v(n,o),v(o,r),a=!0},p(e,n){const o=n.lastMsgs;Z(),l=re(l,e,u,1,n,o,c,t.parentNode,oe,Un,t,Pn),ee()},i(e){if(!a){for(var t=0;t<i.length;t+=1)l[t].i();a=!0}},o(e){for(d=0;d<l.length;d+=1)l[d].o();a=!1},d(e){for(d=0;d<l.length;d+=1)l[d].d(e);e&&(y(t),y(n)),s()}}}function Un(e,t){var n,o,r=new Dt({props:{msg:t.msg}});return{key:e,first:null,c(){n=$(),r.$$.fragment.c(),this.first=n},m(e,t){b(e,n,t),ae(r,e,t),o=!0},p(e,t){var n={};e.lastMsgs&&(n.msg=t.msg),r.$set(n)},i(e){o||(r.$$.fragment.i(e),o=!0)},o(e){r.$$.fragment.o(e),o=!1},d(e){e&&y(n),r.$destroy(e)}}}function jn(t){var n;return{c(){(n=x("div")).className="loading"},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function An(t){var n;return{c(){(n=x("div")).className="loading loading-lg"},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Ln(e){var t,o,r;let a={ctx:e,current:null,pending:An,then:Fn,catch:Mn,value:"null",error:"n",blocks:Array(3)};return ne(o=e.aboutPromise&&e.avatarPromise,a),{c(){t=x("div"),a.block.c(),t.className="container"},m(e,n){b(e,t,n),a.block.m(t,a.anchor=null),a.mount=(()=>t),a.anchor=null,r=!0},p(t,r){e=r,a.ctx=e,o!==(o=e.aboutPromise&&e.avatarPromise)&&ne(o,a)||a.block.p(t,n(n({},e),a.resolved))},i(e){r||(a.block.i(),r=!0)},o(e){for(let e=0;e<3;e+=1){const t=a.blocks[e];t&&t.o()}r=!1},d(e){e&&y(t),a.block.d(),a=null}}}function En(e,t,n){let o;c(e,_o,e=>{n("$routeParams",o=e)});let r,a,s,l=!1,i=!1,u=!1,d=[];n("feed",a=o.feed),a||n("feed",a=ssb.feed);let m=a;document.title=`Patchfox - Feed: ${a}`,console.log("fetching",a);let h=ssb.avatar(a).then(e=>{n("name",m=e.name),n("image",r=e.image),document.title=`Patchfox - Feed: ${m}`}),p=ssb.profile(a).then(e=>{s=e.about.reverse().find(e=>{return e.value.content.hasOwnProperty("description")});try{n("description",l=s.value.content.description)}catch(e){n("description",l="")}window.scrollTo(0,0)}),g=ssb.query({value:{author:a}},10).then(e=>{n("lastMsgs",d=e),window.scrollTo(0,0)});a!==ssb.feed&&(ssb.following(a).then(e=>{const t=i=e;return n("following",i),t}),ssb.blocking(a).then(e=>{const t=u=e;return n("blocking",u),t}));const f=e=>{n("messagePromise",g=ssb.query({value:{author:a,timestamp:{$lt:e}}}).then(e=>{n("lastMsgs",d=e),window.scrollTo(0,0)}))};return{description:l,following:i,blocking:u,image:r,feed:a,lastMsgs:d,name:m,avatarPromise:h,aboutPromise:p,messagePromise:g,blockingChanged:e=>{e.target.checked?ssb.block(a).catch(()=>{const e=u=!1;return n("blocking",u),e}):ssb.unblock(a).catch(()=>{const e=u=!0;return n("blocking",u),e})},followingChanged:e=>{e.target.checked?ssb.follow(a).catch(()=>{const e=i=!1;return n("following",i),e}):ssb.unfollow(a).catch(()=>{const e=i=!0;return n("following",i),e})},loadMoreMessages:f,ssb:ssb,input0_change_handler:function(){i=this.checked,n("following",i)},input1_change_handler:function(){u=this.checked,n("blocking",u)},click_handler:function(){f(d[d.length-1].value.timestamp)}}}function On(e){var t,n,o;return{c(){t=x("div"),n=_(e.msg),t.className=o="toast "+e.toastClass},m(e,o){b(e,t,o),v(t,n)},p(e,r){e.msg&&F(n,r.msg),e.toastClass&&o!==(o="toast "+r.toastClass)&&(t.className=o)},d(e){e&&y(t)}}}function Wn(e){var t,n,o,r,a=e.cta.label;return{c(){t=x("li"),n=x("a"),o=_(a),n.href="#",r=C(n,"click",P(T(e.cta.action)))},m(e,r){b(e,t,r),v(t,n),v(n,o)},p(e,t){e.cta&&a!==(a=t.cta.label)&&F(o,a)},d(e){e&&y(t),r()}}}function Bn(t){var n,o,r,a,s,l,c,i,u,d,m,h,p,g,f,k,w,$=t.toast&&On(t),C=t.cta&&Wn(t);return{c(){n=x("div"),(o=x("h1")).textContent="ðŸ˜¿ An Error Has Occurred, sorry ðŸ˜­",r=N(),$&&$.c(),a=N(),(s=x("h4")).textContent="This is what we know about it",l=N(),c=x("pre"),i=x("code"),u=_(t.error),d=N(),(m=x("p")).textContent="You might want to:",h=N(),p=x("ul"),C&&C.c(),g=N(),(f=x("li")).innerHTML='<a href="/docs/index.html#/troubleshooting/" target="_blank">\n\t\t\t        Open our troubleshooting documentation.\n\t\t\t      </a>',k=N(),(w=x("li")).innerHTML='<a href="https://github.com/soapdog/patchfox/issues" target="_blank">\n\t\t\t        Add an issue\n\t\t\t      </a>\n\t\t\t      to the Patchfox repository.\n\t\t\t    ',c.className="code",n.className="container"},m(e,t){b(e,n,t),v(n,o),v(n,r),$&&$.m(n,null),v(n,a),v(n,s),v(n,l),v(n,c),v(c,i),v(i,u),v(n,d),v(n,m),v(n,h),v(n,p),C&&C.m(p,null),v(p,g),v(p,f),v(p,k),v(p,w)},p(e,t){t.toast?$?$.p(e,t):(($=On(t)).c(),$.m(n,a)):$&&($.d(1),$=null),e.error&&F(u,t.error),t.cta?C?C.p(e,t):((C=Wn(t)).c(),C.m(p,g)):C&&(C.d(1),C=null)},i:e,o:e,d(e){e&&y(n),$&&$.d(),C&&C.d()}}}function Hn(e,t,n){let o;c(e,_o,e=>{n("$routeParams",o=e)}),document.title="Patchfox - Error";let r,a=o.error,s={},l="",i=!1,u=!1;console.dir(a),"object"==typeof a&&n("error",a=(s=a).message);let d={"Error: stream is closed":{label:"Want to try to reconnect?",action:()=>{n("toast",i=!0),n("toastClass",l="toast-warning"),n("msg",r="Attempting to reconnect to sbot..."),To().then(()=>{n("toastClass",l="toast-success"),n("toast",i=!0),n("msg",r="Connection to sbot reestablished. Try going to your public feed.")}).catch(e=>{n("toastClass",l="toast-error"),n("toast",i=!0),n("msg",r="Couldn't reconnect. Try reloading the page.")})}}};return d.hasOwnProperty(a)&&n("cta",u=d[a]),{error:a,toastClass:l,toast:i,msg:r,cta:u}}function qn(e,t,n){const o=Object.create(e);return o.c=t[n],o}function Dn(e){for(var t,n=e.subscribedChannels,o=[],r=0;r<n.length;r+=1)o[r]=Yn(qn(e,n,r));return{c(){for(var e=0;e<o.length;e+=1)o[e].c();t=$()},m(e,n){for(var r=0;r<o.length;r+=1)o[r].m(e,n);b(e,t,n)},p(e,r){if(e.subscribedChannels){n=r.subscribedChannels;for(var a=0;a<n.length;a+=1){const s=qn(r,n,a);o[a]?o[a].p(e,s):(o[a]=Yn(s),o[a].c(),o[a].m(t.parentNode,t))}for(;a<o.length;a+=1)o[a].d(1);o.length=n.length}},d(e){w(o,e),e&&y(t)}}}function zn(t){var n,o,r;return{c(){n=x("div"),o=N(),(r=x("p")).textContent="This is a complex query, it might take a while... Channels will appear as we find them",n.className="loading"},m(e,t){b(e,n,t),b(e,o,t),b(e,r,t)},p:e,d(e){e&&(y(n),y(o),y(r))}}}function Yn(e){var t,n,o,r,a,s=e.c;function l(){return e.click_handler(e)}return{c(){t=x("span"),n=_("#"),o=_(s),r=N(),t.className="channel label label-secondary m-1 svelte-1or0a5q",a=C(t,"click",l)},m(e,a){b(e,t,a),v(t,n),v(t,o),v(t,r)},p(t,n){e=n,t.subscribedChannels&&s!==(s=e.c)&&F(o,s)},d(e){e&&y(t),a()}}}function Vn(t){var n,o,r;function a(e){return 0==e.subscribedChannels.length?zn:Dn}var s=a(t),l=s(t);return{c(){(n=x("h4")).textContent="Subscribed Channels",o=N(),l.c(),r=$()},m(e,t){b(e,n,t),b(e,o,t),l.m(e,t),b(e,r,t)},p(e,t){s===(s=a(t))&&l?l.p(e,t):(l.d(1),(l=s(t))&&(l.c(),l.m(r.parentNode,r)))},i:e,o:e,d(e){e&&(y(n),y(o)),l.d(e),e&&y(r)}}}function Kn(e,t,n){let o=[],r=hermiebox.modules.pullStream,a=hermiebox.sbot;return(()=>{let e={$filter:{value:{author:a.id,content:{type:"channel"}}},$sort:[["value","timestamp"]]};r(a.query.read({query:[e],live:!0,reverse:!0,limit:500}),r.drain(e=>{e.sync?console.log("finished loading"):e.value.content.subscribed&&(o.push(e.value.content.channel),n("subscribedChannels",o))}))})(),{subscribedChannels:o,click_handler:function({c:e}){return $o("/channel",{channel:e})}}}function Jn(e,t,n){const o=Object.create(e);return o.msg=t[n],o}function Gn(t){var n,o,r;return{c(){n=x("div"),o=_("Error: "),r=_(t.error),n.className="toast toast-error"},m(e,t){b(e,n,t),v(n,o),v(n,r)},p:e,d(e){e&&y(n)}}}function Qn(e){var t,n,o,r,s,l,c,i,u,d=[],m=new Map,h=e.msgs;const p=e=>e.msg.key;for(var g=0;g<h.length;g+=1){let t=Jn(e,h,g),n=p(t);m.set(n,d[g]=eo(n,t))}var f=null;return h.length||(f=Zn(e)).c(),{c(){for(g=0;g<d.length;g+=1)d[g].c();t=N(),n=x("ul"),o=x("li"),(r=x("a")).innerHTML='<div class="page-item-subtitle">Previous</div>',s=N(),l=x("li"),(c=x("a")).innerHTML='<div class="page-item-subtitle">Next</div>',r.href="#/public",o.className="page-item page-previous",c.href="#/public",l.className="page-item page-next",n.className="pagination",u=[C(r,"click",P(T(e.goPrevious))),C(c,"click",P(T(e.goNext)))]},m(e,a){for(g=0;g<d.length;g+=1)d[g].m(e,a);f&&f.m(e,null),b(e,t,a),b(e,n,a),v(n,o),v(o,r),v(n,s),v(n,l),v(l,c),i=!0},p(e,n){const o=n.msgs;Z(),d=re(d,e,p,1,n,o,m,t.parentNode,oe,eo,t,Jn),ee(),o.length?f&&(f.d(1),f=null):f||((f=Zn(n)).c(),f.m(t.parentNode,t))},i(e){if(!i){for(var t=0;t<h.length;t+=1)d[t].i();i=!0}},o(e){for(g=0;g<d.length;g+=1)d[g].o();i=!1},d(e){for(g=0;g<d.length;g+=1)d[g].d(e);f&&f.d(e),e&&(y(t),y(n)),a(u)}}}function Xn(t){var n;return{c(){(n=x("div")).className="loading loading-lg"},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Zn(e){var t;return{c(){(t=x("p")).textContent="No messages."},m(e,n){b(e,t,n)},d(e){e&&y(t)}}}function eo(e,t){var n,o,r=new Dt({props:{msg:t.msg}});return{key:e,first:null,c(){n=$(),r.$$.fragment.c(),this.first=n},m(e,t){b(e,n,t),ae(r,e,t),o=!0},p(e,t){var n={};e.msgs&&(n.msg=t.msg),r.$set(n)},i(e){o||(r.$$.fragment.i(e),o=!0)},o(e){r.$$.fragment.o(e),o=!1},d(e){e&&y(n),r.$destroy(e)}}}function to(e){var t,n,o,r,s,l,c,i,u,d,m,h,p,g,f,k,w,P,F,I,R,S,U,j=e.error&&Gn(e),A=[Xn,Qn],L=[];function E(e){return e.msgs?1:0}return F=E(e),I=L[F]=A[F](e),{c(){t=x("div"),n=x("div"),o=x("div"),r=x("h4"),s=_("Channel: #"),l=_(e.channel),c=N(),i=x("div"),u=x("label"),d=x("input"),m=N(),h=x("i"),p=_("\r\n        Subscribe"),g=N(),f=x("button"),k=_("New Post"),w=N(),j&&j.c(),P=N(),I.c(),R=$(),o.className="column",M(d,"type","checkbox"),h.className="form-icon",u.className="form-switch float-right",f.className="btn btn-link float-right",M(f,"href","?channel="+e.channel+"#/compose"),i.className="column",n.className="columns",t.className="container",U=[C(d,"change",e.input_change_handler),C(d,"change",e.subscriptionChanged),C(f,"click",T(e.click_handler))]},m(a,y){b(a,t,y),v(t,n),v(n,o),v(o,r),v(r,s),v(r,l),v(n,c),v(n,i),v(i,u),v(u,d),d.checked=e.subscribed,v(u,m),v(u,h),v(u,p),v(i,g),v(i,f),v(f,k),b(a,w,y),j&&j.m(a,y),b(a,P,y),L[F].m(a,y),b(a,R,y),S=!0},p(e,t){e.subscribed&&(d.checked=t.subscribed),t.error?j?j.p(e,t):((j=Gn(t)).c(),j.m(P.parentNode,P)):j&&(j.d(1),j=null);var n=F;(F=E(t))===n?L[F].p(e,t):(Z(),te(()=>{L[n].d(1),L[n]=null}),I.o(1),ee(),(I=L[F])||(I=L[F]=A[F](t)).c(),I.i(1),I.m(R.parentNode,R))},i(e){S||(I&&I.i(),S=!0)},o(e){I&&I.o(),S=!1},d(e){e&&(y(t),y(w)),j&&j.d(e),e&&y(P),L[F].d(e),e&&y(R),a(U)}}}function no(e,t,n){let o;c(e,_o,e=>{n("$routeParams",o=e)});let r=!1,a=o.error||!1,s=o.channel||!1,l=!1;s||(console.log("can't navigate to unnamed channel, going back to public"),location="index.html#/public");let i={limit:o.limit||Po("limit",10),reverse:!0};ssb.channelSubscribed(s).then(e=>{const t=l=e;return n("subscribed",l),t});return e.$$.update=((e={opts:1,$routeParams:1,channel:1,error:1})=>{if(e.opts||e.$routeParams||e.channel||e.error){Object.assign(i,o),document.title=`Patchfox - #${s}`,i.hasOwnProperty("lt")&&(i.lt=parseInt(i.lt),n("opts",i),n("$routeParams",o),n("channel",s),n("error",a)),i.hasOwnProperty("limit")&&(i.limit=parseInt(i.limit),n("opts",i),n("$routeParams",o),n("channel",s),n("error",a));ssb.channel(s,i).then(e=>{console.log("msg",e),n("msgs",r=e),window.scrollTo(0,0)}).catch(e=>{a||console.error("errrrooooor",e)})}}),{msgs:r,error:a,channel:s,subscribed:l,subscriptionChanged:e=>{e.target.checked?ssb.channelSubscribe(s).catch(()=>{const e=l=!1;return n("subscribed",l),e}):ssb.channelUnsubscribe(s).catch(()=>{const e=l=!0;return n("subscribed",l),e})},goNext:()=>{$o("/channel",{channel:s,lt:r[r.length-1].rts})},goPrevious:()=>{history.back()},input_change_handler:function(){l=this.checked,n("subscribed",l)},click_handler:function(){return $o("/compose",{channel:s})}}}function oo(e,t,n){const o=Object.create(e);return o.filter=t[n],o}function ro(e){var t;return{c(){(t=x("div")).innerHTML='<p class="label">You don\'t have any filter yet.</p>',t.className="column col-12"},m(e,n){b(e,t,n)},d(e){e&&y(t)}}}function ao(e){var t,n,o,r,a,s=e.filter.feed;return{c(){t=x("li"),n=_("From "),o=x("a"),r=_(s),o.href=a="?feed="+e.filter.feed+"#/profile",o.target="_blank",o.className="feed svelte-1e0jkdi"},m(e,a){b(e,t,a),v(t,n),v(t,o),v(o,r)},p(e,t){e.currentFilters&&s!==(s=t.filter.feed)&&F(r,s),e.currentFilters&&a!==(a="?feed="+t.filter.feed+"#/profile")&&(o.href=a)},d(e){e&&y(t)}}}function so(e){var t,n,o,r,a,s,l=e.filter.channel;return{c(){t=x("li"),n=_("On channel "),o=x("a"),r=_("#"),a=_(l),o.href=s="?channel="+e.filter.feed+"#/channel",o.target="_blank",o.className="feed svelte-1e0jkdi"},m(e,s){b(e,t,s),v(t,n),v(t,o),v(o,r),v(o,a)},p(e,t){e.currentFilters&&l!==(l=t.filter.channel)&&F(a,l),e.currentFilters&&s!==(s="?channel="+t.filter.feed+"#/channel")&&(o.href=s)},d(e){e&&y(t)}}}function lo(e){var t,n,o,r,a=e.filter.keywords.join(", ");return{c(){t=x("i"),n=x("li"),o=_("Containing: "),r=_(a)},m(e,a){b(e,t,a),v(t,n),v(n,o),v(n,r)},p(e,t){e.currentFilters&&a!==(a=t.filter.keywords.join(", "))&&F(r,a)},d(e){e&&y(t)}}}function co(e){var t,n,o,r=e.filter.expires;return{c(){t=x("li"),n=_("Expiring in "),o=_(r)},m(e,r){b(e,t,r),v(t,n),v(t,o)},p(e,t){e.currentFilters&&r!==(r=t.filter.expires)&&F(o,r)},d(e){e&&y(t)}}}function io(e){var t,n,o,r,a,s,l,c,i,u,d,m,h,p,g,f=e.filter.action,k=e.filter.feed&&ao(e),w=e.filter.channel&&so(e),$=e.filter.keywords.length>0&&lo(e),T=e.filter.expires&&co(e);function P(){return e.click_handler(e)}return{c(){t=x("div"),n=x("div"),o=x("div"),r=x("div"),a=_(f),s=N(),l=x("div"),c=x("ul"),k&&k.c(),i=N(),w&&w.c(),u=N(),$&&$.c(),d=N(),T&&T.c(),m=N(),h=x("div"),(p=x("button")).textContent="Delete",r.className="card-title h5",o.className="card-header",l.className="card-body",p.className="btn",M(p,"aria-label","Delete"),h.className="card-footer",n.className="card filter svelte-1e0jkdi",t.className="column col-6",g=C(p,"click",P)},m(e,g){b(e,t,g),v(t,n),v(n,o),v(o,r),v(r,a),v(n,s),v(n,l),v(l,c),k&&k.m(c,null),v(c,i),w&&w.m(c,null),v(c,u),$&&$.m(c,null),v(c,d),T&&T.m(c,null),v(n,m),v(n,h),v(h,p)},p(t,n){e=n,t.currentFilters&&f!==(f=e.filter.action)&&F(a,f),e.filter.feed?k?k.p(t,e):((k=ao(e)).c(),k.m(c,i)):k&&(k.d(1),k=null),e.filter.channel?w?w.p(t,e):((w=so(e)).c(),w.m(c,u)):w&&(w.d(1),w=null),e.filter.keywords.length>0?$?$.p(t,e):(($=lo(e)).c(),$.m(c,d)):$&&($.d(1),$=null),e.filter.expires?T?T.p(t,e):((T=co(e)).c(),T.m(c,null)):T&&(T.d(1),T=null)},d(e){e&&y(t),k&&k.d(),w&&w.d(),$&&$.d(),T&&T.d(),g()}}}function uo(t){for(var n,o,r,s,l,c,i,u,d,m,h,p,g,f,k,$,T,P,F,I,R,S,U,j,A,L,E,O,W,B,H,q,D,z,Y,V,K,J,G,Q,X,Z,ee,te,ne,oe,re,ae,se,le,ce,ie,ue,de,me,he,pe,ge,fe,ve,be,ye,ke,we,xe,_e,Ne,$e,Ce,Te,Pe,Me,Fe,Ie,Re,Se,Ue,je,Ae,Le,Ee,Oe,We,Be,He,qe,De,ze,Ye,Ve,Ke,Je,Ge,Qe,Xe,Ze,et,tt,nt,ot,rt,at,st,lt,ct,it,ut,dt,mt,ht,pt,gt,ft,vt,bt,yt,kt,wt,xt,_t,Nt,$t,Ct,Tt,Pt,Mt,Ft,It,Rt,St,Ut,jt,At,Lt,Et,Ot,Wt,Bt,Ht,qt,Dt,zt,Yt,Vt,Kt,Jt,Gt,Qt,Xt,Zt,en,tn,nn,on,rn,an,sn,ln,cn,un,dn,mn,hn,pn,gn,fn,vn,bn,yn,kn,wn,xn,_n,Nn,$n,Cn,Tn,Pn,Mn=t.currentFilters,Fn=[],In=0;In<Mn.length;In+=1)Fn[In]=io(oo(t,Mn,In));var Rn=null;return Mn.length||(Rn=ro()).c(),{c(){(n=x("h1")).textContent="Settings",o=N(),(r=x("p")).innerHTML="\n\t\t\t  Settings changes are saved as you make them except for identity and connection\n\t\t\t  changes, those require a full page reload and thus you need to press a save\n\t\t\t  button. The reason behind this is that Patchfox needs to disconnect and\n\t\t\t  reconnect to the\n\t\t\t  <i>ssb-server</i>\n\t\t\t  using the new info.\n\t\t\t",s=N(),(l=x("p")).innerHTML='<b>\n\t\t\t    You can\'t use Patchfox until you fill your\n\t\t\t    <i>Connection &amp; Identity</i>\n\t\t\t    information.\n\t\t\t    <a href="/docs/index.html#/troubleshooting/no-configuration" target="_blank">\n\t\t\t      If you want more help regarding connection and configuration click here\n\t\t\t    </a>\n\t\t\t    .\n\t\t\t  </b>',c=N(),(i=x("h4")).textContent="Connection & Identity",u=N(),d=x("form"),(m=x("label")).innerHTML="\n\t\t\t    Patchfox can infer the values for both\n\t\t\t    <i>remote</i>\n\t\t\t    and\n\t\t\t    <i>secret</i>\n\t\t\t    from your\n\t\t\t    <code>~/.ssb/secret</code>\n\t\t\t    file. You can use the button below to browse for it.\n\t\t\t  ",h=N(),p=x("input"),g=N(),(f=x("label")).textContent="Remote",k=N(),$=x("input"),T=N(),(P=x("label")).textContent="Secret",F=N(),I=x("textarea"),R=N(),S=x("br"),U=N(),(j=x("button")).textContent="Save Identity & Remote",A=N(),(L=x("p")).textContent="Saving identity and remote will cause a full page refresh.",E=N(),(O=x("h4")).textContent="Vieweing Experience",W=N(),B=x("form"),(H=x("label")).textContent="Messages per page",q=N(),D=x("input"),z=N(),Y=x("br"),V=N(),(K=x("span")).innerHTML='\n\t\t\t    Which message types you want to see?\n\t\t\t    <a target="_blank" href="/docs/index.html#/message_types/">\n\t\t\t      Click here for more information about\n\t\t\t      <i>Message Types</i></a>',J=N(),G=x("label"),Q=x("input"),X=N(),Z=x("i"),ee=N(),(te=x("b")).textContent="About",ne=_("\r\n    (aka people setting avatars and descriptions; gatherings)"),oe=N(),re=x("label"),ae=x("input"),se=N(),le=x("i"),ce=N(),(ie=x("b")).textContent="Blog",ue=_("\r\n    (Longform text posts)"),de=N(),me=x("label"),he=x("input"),pe=N(),ge=x("i"),fe=N(),(ve=x("b")).textContent="Channel",be=_("\r\n    (People subscribing to channels)"),ye=N(),ke=x("label"),we=x("input"),xe=N(),_e=x("i"),Ne=N(),($e=x("b")).textContent="Contact",Ce=_("\r\n    (People following each other)"),Te=N(),Pe=x("label"),Me=x("input"),Fe=N(),Ie=x("i"),Re=N(),(Se=x("b")).textContent="Posts",Ue=_("\r\n    (Common content post, leave this on or it is not that fun)"),je=N(),Ae=x("label"),Le=x("input"),Ee=N(),Oe=x("i"),We=N(),(Be=x("b")).textContent="Pub",He=_("\r\n    (Pub servers announcements)"),qe=N(),De=x("label"),ze=x("input"),Ye=N(),Ve=x("i"),Ke=N(),(Je=x("b")).textContent="Private",Ge=_("\r\n    (Private messages; You won't be able to read them, but you'll see their\r\n    encrypted content passing by)"),Qe=N(),Xe=x("label"),Ze=x("input"),et=N(),tt=x("i"),nt=N(),(ot=x("b")).textContent="Vote",rt=_("\r\n    (People liking/digging stuff)"),at=N(),st=x("div"),lt=N(),ct=x("label"),it=x("input"),ut=N(),dt=x("i"),mt=N(),(ht=x("b")).textContent="Unknown",pt=_("\r\n    (Show messages Patchfox doesn't understand as their raw content)"),gt=N(),ft=x("br"),vt=N(),(bt=x("label")).textContent="Feed column size. There is research that says that a short column size makes\r\n    for a more pleasant reading experience, still some users prefer to use the\r\n    full screen space. Your choice is between reading through long text lines or\r\n    short ones.",yt=N(),kt=x("label"),wt=x("input"),xt=N(),_t=x("i"),Nt=_("\r\n    Short column"),$t=N(),Ct=x("label"),Tt=x("input"),Pt=N(),Mt=x("i"),Ft=_("\r\n    Long column"),It=N(),(Rt=x("h4")).textContent="Abuse Prevention",St=N(),(Ut=x("p")).textContent="Use the features from this section to tailor your Patchfox experience to suit\r\n  your needs.",jt=N(),(At=x("h5")).textContent="Filters",Lt=N(),(Et=x("p")).innerHTML="\n\t\t\t  Use filters to hide messages and blur images. Use any combination of channel,\n\t\t\t  feeds and keywords (separated by commas) to create your triggers and make SSB\n\t\t\t  the platform you want. Be aware that these filters are saved to your browser,\n\t\t\t  they are not shared on the feed, they don't affect gossiping, they only affect\n\t\t\t  the displaying of messages and images in Patchfox itself. If you create a\n\t\t\t  filter and open a different client, they won't be working there. If you want\n\t\t\t  to learn more about\n\t\t\t  <a href=\"/docs/index.html#/features/filter\">\n\t\t\t    filters, click here to go to the documentation.\n\t\t\t  </a>\n\t\t\t  You can create as many filters as you want.\n\t\t\t",Ot=N(),Wt=x("div"),Bt=x("div");for(var e=0;e<Fn.length;e+=1)Fn[e].c();Ht=N(),(qt=x("h5")).textContent="New Filter",Dt=N(),zt=x("form-group"),Yt=x("label"),Vt=x("input"),Kt=N(),Jt=x("i"),Gt=_("\r\n    Hide Message"),Qt=N(),Xt=x("label"),Zt=x("input"),en=N(),tn=x("i"),nn=_("\r\n    Blur Images"),on=N(),(rn=x("label")).textContent="Channel",an=N(),sn=x("input"),ln=N(),(cn=x("label")).textContent="Feed",un=N(),dn=x("input"),mn=N(),(hn=x("label")).textContent="Keywords",pn=N(),gn=x("input"),fn=N(),(vn=x("label")).textContent="Expiration Date",bn=N(),yn=x("input"),kn=N(),wn=x("br"),xn=N(),(_n=x("button")).textContent="Add Filter",Nn=N(),$n=x("br"),Cn=N(),Tn=x("br"),m.className="form-label",m.htmlFor="secret-file",M(p,"type","file"),p.className="form-input",p.id="secret-file",f.className="form-label",f.htmlFor="remote",$.className="form-input",M($,"type","text"),$.id="remote",$.placeholder="remote",P.className="form-label",P.htmlFor="secret",I.className="form-input",I.id="secret",I.placeholder="Your secret",I.rows="8",j.className="btn btn-primary float-right",d.className="form-group",H.className="form-label",H.htmlFor="limit",D.className="form-input",M(D,"type","number"),M(Q,"type","checkbox"),Z.className="form-icon",G.className="form-switch",M(ae,"type","checkbox"),le.className="form-icon",re.className="form-switch",M(he,"type","checkbox"),ge.className="form-icon",me.className="form-switch",M(we,"type","checkbox"),_e.className="form-icon",ke.className="form-switch",M(Me,"type","checkbox"),Ie.className="form-icon",Pe.className="form-switch",M(Le,"type","checkbox"),Oe.className="form-icon",Ae.className="form-switch",M(ze,"type","checkbox"),Ve.className="form-icon",De.className="form-switch",M(Ze,"type","checkbox"),tt.className="form-icon",Xe.className="form-switch",st.className="divider",M(it,"type","checkbox"),dt.className="form-icon",ct.className="form-switch",bt.className="form-label",t.$$binding_groups[1].push(wt),M(wt,"type","radio"),wt.name="column-size",wt.__value="short",wt.value=wt.__value,_t.className="form-icon",kt.className="form-radio",t.$$binding_groups[1].push(Tt),M(Tt,"type","radio"),Tt.name="column-size",Tt.__value="long",Tt.value=Tt.__value,Mt.className="form-icon",Ct.className="form-radio",B.className="form-group",Bt.className="columns",Wt.className="container",t.$$binding_groups[0].push(Vt),M(Vt,"type","radio"),Vt.name="filter-action",Vt.__value="hide",Vt.value=Vt.__value,Jt.className="form-icon",Yt.className="form-radio",t.$$binding_groups[0].push(Zt),M(Zt,"type","radio"),Zt.name="filter-action",Zt.__value="blur",Zt.value=Zt.__value,tn.className="form-icon",Xt.className="form-radio",rn.className="form-label",rn.htmlFor="remote",sn.className="form-input",M(sn,"type","text"),sn.placeholder="Channel",cn.className="form-label",cn.htmlFor="remote",dn.className="form-input",M(dn,"type","text"),dn.placeholder="Feed",hn.className="form-label",hn.htmlFor="remote",gn.className="form-input",M(gn,"type","text"),gn.placeholder="Keywords separated by commas",vn.className="form-label",vn.htmlFor="remote",yn.className="form-input",M(yn,"type","date"),yn.placeholder="When should this filter expiry",_n.className="btn btn-primary",Pn=[C(p,"change",t.selectedFile),C($,"input",t.input1_input_handler),C(I,"input",t.textarea_input_handler),C(j,"click",t.saveConfiguration),C(D,"input",t.input2_input_handler),C(D,"change",t.change_handler),C(Q,"change",t.input3_change_handler),C(Q,"change",t.change_handler_1),C(ae,"change",t.input4_change_handler),C(ae,"change",t.change_handler_2),C(he,"change",t.input5_change_handler),C(he,"change",t.change_handler_3),C(we,"change",t.input6_change_handler),C(we,"change",t.change_handler_4),C(Me,"change",t.input7_change_handler),C(Me,"change",t.change_handler_5),C(Le,"change",t.input8_change_handler),C(Le,"change",t.change_handler_6),C(ze,"change",t.input9_change_handler),C(ze,"change",t.change_handler_7),C(Ze,"change",t.input10_change_handler),C(Ze,"change",t.change_handler_8),C(it,"change",t.input11_change_handler),C(it,"change",t.change_handler_9),C(wt,"change",t.input12_change_handler),C(wt,"change",t.change_handler_10),C(Tt,"change",t.input13_change_handler),C(Tt,"change",t.change_handler_11),C(Vt,"change",t.input14_change_handler),C(Zt,"change",t.input15_change_handler),C(sn,"input",t.input16_input_handler),C(dn,"input",t.input17_input_handler),C(gn,"input",t.input18_input_handler),C(yn,"input",t.input19_input_handler),C(_n,"click",t.addNewFilter)]},m(e,a){b(e,n,a),b(e,o,a),b(e,r,a),b(e,s,a),b(e,l,a),b(e,c,a),b(e,i,a),b(e,u,a),b(e,d,a),v(d,m),v(d,h),v(d,p),v(d,g),v(d,f),v(d,k),v(d,$),$.value=t.remote,v(d,T),v(d,P),v(d,F),v(d,I),I.value=t.keys,v(d,R),v(d,S),v(d,U),v(d,j),v(d,A),v(d,L),b(e,E,a),b(e,O,a),b(e,W,a),b(e,B,a),v(B,H),v(B,q),v(B,D),D.value=t.limit,v(B,z),v(B,Y),v(B,V),v(B,K),v(B,J),v(B,G),v(G,Q),Q.checked=t.showTypeAbout,v(G,X),v(G,Z),v(G,ee),v(G,te),v(G,ne),v(B,oe),v(B,re),v(re,ae),ae.checked=t.showTypeBlog,v(re,se),v(re,le),v(re,ce),v(re,ie),v(re,ue),v(B,de),v(B,me),v(me,he),he.checked=t.showTypeChannel,v(me,pe),v(me,ge),v(me,fe),v(me,ve),v(me,be),v(B,ye),v(B,ke),v(ke,we),we.checked=t.showTypeContact,v(ke,xe),v(ke,_e),v(ke,Ne),v(ke,$e),v(ke,Ce),v(B,Te),v(B,Pe),v(Pe,Me),Me.checked=t.showTypePost,v(Pe,Fe),v(Pe,Ie),v(Pe,Re),v(Pe,Se),v(Pe,Ue),v(B,je),v(B,Ae),v(Ae,Le),Le.checked=t.showTypePub,v(Ae,Ee),v(Ae,Oe),v(Ae,We),v(Ae,Be),v(Ae,He),v(B,qe),v(B,De),v(De,ze),ze.checked=t.showTypePrivate,v(De,Ye),v(De,Ve),v(De,Ke),v(De,Je),v(De,Ge),v(B,Qe),v(B,Xe),v(Xe,Ze),Ze.checked=t.showTypeVote,v(Xe,et),v(Xe,tt),v(Xe,nt),v(Xe,ot),v(Xe,rt),v(B,at),v(B,st),v(B,lt),v(B,ct),v(ct,it),it.checked=t.showTypeUnknown,v(ct,ut),v(ct,dt),v(ct,mt),v(ct,ht),v(ct,pt),v(B,gt),v(B,ft),v(B,vt),v(B,bt),v(B,yt),v(B,kt),v(kt,wt),wt.checked=wt.__value===t.columnSize,v(kt,xt),v(kt,_t),v(kt,Nt),v(B,$t),v(B,Ct),v(Ct,Tt),Tt.checked=Tt.__value===t.columnSize,v(Ct,Pt),v(Ct,Mt),v(Ct,Ft),b(e,It,a),b(e,Rt,a),b(e,St,a),b(e,Ut,a),b(e,jt,a),b(e,At,a),b(e,Lt,a),b(e,Et,a),b(e,Ot,a),b(e,Wt,a),v(Wt,Bt);for(var y=0;y<Fn.length;y+=1)Fn[y].m(Bt,null);Rn&&Rn.m(Bt,null),b(e,Ht,a),b(e,qt,a),b(e,Dt,a),b(e,zt,a),v(zt,Yt),v(Yt,Vt),Vt.checked=Vt.__value===t.filterAction,v(Yt,Kt),v(Yt,Jt),v(Yt,Gt),v(zt,Qt),v(zt,Xt),v(Xt,Zt),Zt.checked=Zt.__value===t.filterAction,v(Xt,en),v(Xt,tn),v(Xt,nn),v(zt,on),v(zt,rn),v(zt,an),v(zt,sn),sn.value=t.filterChannel,v(zt,ln),v(zt,cn),v(zt,un),v(zt,dn),dn.value=t.filterFeed,v(zt,mn),v(zt,hn),v(zt,pn),v(zt,gn),gn.value=t.filterKeywords,v(zt,fn),v(zt,vn),v(zt,bn),v(zt,yn),yn.value=t.filterExpiry,b(e,kn,a),b(e,wn,a),b(e,xn,a),b(e,_n,a),b(e,Nn,a),b(e,$n,a),b(e,Cn,a),b(e,Tn,a)},p(e,t){if(e.remote&&$.value!==t.remote&&($.value=t.remote),e.keys&&(I.value=t.keys),e.limit&&(D.value=t.limit),e.showTypeAbout&&(Q.checked=t.showTypeAbout),e.showTypeBlog&&(ae.checked=t.showTypeBlog),e.showTypeChannel&&(he.checked=t.showTypeChannel),e.showTypeContact&&(we.checked=t.showTypeContact),e.showTypePost&&(Me.checked=t.showTypePost),e.showTypePub&&(Le.checked=t.showTypePub),e.showTypePrivate&&(ze.checked=t.showTypePrivate),e.showTypeVote&&(Ze.checked=t.showTypeVote),e.showTypeUnknown&&(it.checked=t.showTypeUnknown),e.columnSize&&(wt.checked=wt.__value===t.columnSize),e.columnSize&&(Tt.checked=Tt.__value===t.columnSize),e.currentFilters){Mn=t.currentFilters;for(var n=0;n<Mn.length;n+=1){const o=oo(t,Mn,n);Fn[n]?Fn[n].p(e,o):(Fn[n]=io(o),Fn[n].c(),Fn[n].m(Bt,null))}for(;n<Fn.length;n+=1)Fn[n].d(1);Fn.length=Mn.length}Mn.length?Rn&&(Rn.d(1),Rn=null):Rn||((Rn=ro()).c(),Rn.m(Bt,null)),e.filterAction&&(Vt.checked=Vt.__value===t.filterAction),e.filterAction&&(Zt.checked=Zt.__value===t.filterAction),e.filterChannel&&sn.value!==t.filterChannel&&(sn.value=t.filterChannel),e.filterFeed&&dn.value!==t.filterFeed&&(dn.value=t.filterFeed),e.filterKeywords&&gn.value!==t.filterKeywords&&(gn.value=t.filterKeywords),e.filterExpiry&&(yn.value=t.filterExpiry)},i:e,o:e,d(e){e&&(y(n),y(o),y(r),y(s),y(l),y(c),y(i),y(u),y(d),y(E),y(O),y(W),y(B)),t.$$binding_groups[1].splice(t.$$binding_groups[1].indexOf(wt),1),t.$$binding_groups[1].splice(t.$$binding_groups[1].indexOf(Tt),1),e&&(y(It),y(Rt),y(St),y(Ut),y(jt),y(At),y(Lt),y(Et),y(Ot),y(Wt)),w(Fn,e),Rn&&Rn.d(),e&&(y(Ht),y(qt),y(Dt),y(zt)),t.$$binding_groups[0].splice(t.$$binding_groups[0].indexOf(Vt),1),t.$$binding_groups[0].splice(t.$$binding_groups[0].indexOf(Zt),1),e&&(y(kn),y(wn),y(xn),y(_n),y(Nn),y($n),y(Cn),y(Tn)),a(Pn)}}}function mo(e,t,n){let o={},r="",a=Po("limit",10),s=Po("columnSize","short");document.title="Patchfox - Settings";let l=Po("showTypeUnknown",!1),c=Po("showTypeAbout",!0),i=Po("showTypeBlog",!0),u=Po("showTypeChannel",!0),d=Po("showTypeContact",!0),m=Po("showTypePost",!0),h=Po("showTypePrivate",!0),p=Po("showTypePub",!0),g=Po("showTypeVote",!0),f=de(),v="",b="",y="",k="",w="";const x=e=>{console.log("saved data from settings",e),n("remote",r=e.remote||""),e.keys?n("keys",o=JSON.stringify(e.keys,null,2)):n("keys",o="")};browser.storage.local.get().then(x,e=>{console.error("error on settings",e)});return{keys:o,remote:r,limit:a,columnSize:s,showTypeUnknown:l,showTypeAbout:c,showTypeBlog:i,showTypeChannel:u,showTypeContact:d,showTypePost:m,showTypePrivate:h,showTypePub:p,showTypeVote:g,currentFilters:f,filterFeed:v,filterChannel:b,filterKeywords:y,filterExpiry:k,filterAction:w,saveConfiguration:e=>{Mo({remote:r,keys:JSON.parse(o),manifest:manifest}),$o("/public"),location.reload()},selectedFile:e=>{const t=e.target.files[0],o=new FileReader;o.onload=function(e){console.log(e.target.result);let t=e.target.result.split("\n").filter(function(e){return 0!=e.indexOf("#")});t=JSON.parse(t.join("\n")),n("remote",r=`ws://localhost:8989~shs:${t.id.slice(0,t.id.indexOf("=")+1)}`),x({keys:t,remote:r})},o.readAsText(t)},addNewFilter:()=>{let e=y.split(",").map(e=>e.trim()).filter(e=>0!==e.length),t={};t.action=0!==w.length&&w,t.feed=0!==v.length&&v,t.channel=0!==b.length&&b,t.keywords=e,t.expires=0!==k.length&&k,t.channel&&t.channel.startsWith("#")&&(t.channel=t.channel.slice(1)),t.action&&(t.feed||t.channel||t.keywords.length>0)?(me(t),n("currentFilters",f=de()),console.dir("filters",f),n("filterFeed",v=""),n("filterChannel",b=""),n("filterKeywords",y=""),n("filterExpiry",k=""),n("filterAction",w="")):alert("Fill at least filter action and one of feed, channel or keywords")},input1_input_handler:function(){r=this.value,n("remote",r)},textarea_input_handler:function(){o=this.value,n("keys",o)},input2_input_handler:function(){var e;e=this.value,n("limit",a=""===e?void 0:+e)},change_handler:function(){return Fo("limit",a)},input3_change_handler:function(){c=this.checked,n("showTypeAbout",c)},change_handler_1:function(e){Fo("showTypeAbout",c)},input4_change_handler:function(){i=this.checked,n("showTypeBlog",i)},change_handler_2:function(e){Fo("showTypeBlog",i)},input5_change_handler:function(){u=this.checked,n("showTypeChannel",u)},change_handler_3:function(e){Fo("showTypeChannel",u)},input6_change_handler:function(){d=this.checked,n("showTypeContact",d)},change_handler_4:function(e){Fo("showTypeContact",d)},input7_change_handler:function(){m=this.checked,n("showTypePost",m)},change_handler_5:function(e){Fo("showTypePost",m)},input8_change_handler:function(){p=this.checked,n("showTypePub",p)},change_handler_6:function(e){Fo("showTypePub",p)},input9_change_handler:function(){h=this.checked,n("showTypePrivate",h)},change_handler_7:function(e){Fo("showTypePrivate",h)},input10_change_handler:function(){g=this.checked,n("showTypeVote",g)},change_handler_8:function(e){Fo("showTypeVote",g)},input11_change_handler:function(){l=this.checked,n("showTypeUnknown",l)},change_handler_9:function(e){Fo("showTypeUnknown",l)},input12_change_handler:function(){s=this.__value,n("columnSize",s)},change_handler_10:function(){return Fo("columnSize",s)},input13_change_handler:function(){s=this.__value,n("columnSize",s)},change_handler_11:function(){return Fo("columnSize",s)},click_handler:function({filter:e}){he(e),f=de(),n("currentFilters",f)},input14_change_handler:function(){w=this.__value,n("filterAction",w)},input15_change_handler:function(){w=this.__value,n("filterAction",w)},input16_input_handler:function(){b=this.value,n("filterChannel",b)},input17_input_handler:function(){v=this.value,n("filterFeed",v)},input18_input_handler:function(){y=this.value,n("filterKeywords",y)},input19_input_handler:function(){k=this.value,n("filterExpiry",k)},$$binding_groups:[[],[]]}}class ho extends ce{constructor(e){var t;super(),document.getElementById("svelte-1e0jkdi-style")||((t=x("style")).id="svelte-1e0jkdi-style",t.textContent=".filter.svelte-1e0jkdi{height:300px;margin-bottom:0.4rem;overflow:hidden}.feed.svelte-1e0jkdi{max-width:100%;overflow:hidden}",v(document.head,t)),le(this,e,mo,uo,l,[])}}function po(e,t,n){const o=Object.create(e);return o.msg=t[n],o}function go(e){var t,n,o,r,s,l,c,i,u,d=[],m=new Map,h=e.msgs;const p=e=>e.msg.key;for(var g=0;g<h.length;g+=1){let t=po(e,h,g),n=p(t);m.set(n,d[g]=vo(n,t))}return{c(){for(g=0;g<d.length;g+=1)d[g].c();t=N(),n=x("ul"),o=x("li"),(r=x("a")).innerHTML='<div class="page-item-subtitle">Previous</div>',s=N(),l=x("li"),(c=x("a")).innerHTML='<div class="page-item-subtitle">Next</div>',r.href="#/public",o.className="page-item page-previous",c.href="#/public",l.className="page-item page-next",n.className="pagination",u=[C(r,"click",P(T(e.click_handler))),C(c,"click",P(T(e.click_handler_1)))]},m(e,a){for(g=0;g<d.length;g+=1)d[g].m(e,a);b(e,t,a),b(e,n,a),v(n,o),v(o,r),v(n,s),v(n,l),v(l,c),i=!0},p(e,n){const o=n.msgs;Z(),d=re(d,e,p,1,n,o,m,t.parentNode,oe,vo,t,po),ee()},i(e){if(!i){for(var t=0;t<h.length;t+=1)d[t].i();i=!0}},o(e){for(g=0;g<d.length;g+=1)d[g].o();i=!1},d(e){for(g=0;g<d.length;g+=1)d[g].d(e);e&&(y(t),y(n)),a(u)}}}function fo(t){var n;return{c(){(n=x("div")).className="loading loading-lg"},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function vo(e,t){var n,o,r=new Dt({props:{msg:t.msg}});return{key:e,first:null,c(){n=$(),r.$$.fragment.c(),this.first=n},m(e,t){b(e,n,t),ae(r,e,t),o=!0},p(e,t){var n={};e.msgs&&(n.msg=t.msg),r.$set(n)},i(e){o||(r.$$.fragment.i(e),o=!0)},o(e){r.$$.fragment.o(e),o=!1},d(e){e&&y(n),r.$destroy(e)}}}function bo(e){var t,n,o,r,a,s,l=[fo,go],c=[];function i(e){return 0===e.msgs.length?0:1}return o=i(e),r=c[o]=l[o](e),{c(){(t=x("div")).innerHTML='<div class="columns"><h4 class="column">Mentions</h4>\n\t\t\t    <div class="column"></div></div>',n=N(),r.c(),a=$(),t.className="container"},m(e,r){b(e,t,r),b(e,n,r),c[o].m(e,r),b(e,a,r),s=!0},p(e,t){var n=o;(o=i(t))===n?c[o].p(e,t):(Z(),te(()=>{c[n].d(1),c[n]=null}),r.o(1),ee(),(r=c[o])||(r=c[o]=l[o](t)).c(),r.i(1),r.m(a.parentNode,a))},i(e){s||(r&&r.i(),s=!0)},o(e){r&&r.o(),s=!1},d(e){e&&(y(t),y(n)),c[o].d(e),e&&y(a)}}}function yo(e,t,n){let o,r=[];document.title="Patchfox - Mentions";let a=!1;hermiebox.modules.pullStream,hermiebox.sbot;var s;return s=(()=>{o()}),E().$$.on_destroy.push(s),O(()=>{o=_o.subscribe(e=>{if(console.log("params changed.",a,e.lt),e.lt){let t=parseInt(e.lt);t!==a&&(a=t)}else a=!1;console.log("Loading mentions...",a),window.scrollTo(0,0),n("msgs",r=[]),ssb.mentions(ssb.feed,a).then(e=>{const t=r=e;return n("msgs",r),t})})}),{msgs:r,click_handler:function(){return history.back()},click_handler_1:function(){$o("/mentions",{lt:r[r.length-1].rts})}}}let ko={};const wo=ie(!1),xo=ie({data:Ue.parse(window.location.search),location:window.location.hash.slice(1).replace("?","")}),_o=ue(xo,e=>e.data),No=ue(xo,e=>e.location),$o=(e,t)=>{t=t||{},xo.set({location:e,data:t});let n=Ue.stringify(t);history.pushState({location:e,data:t},`Patchfox - ${e}`,`/index.html?${n}#${e}`),console.log(`Navigate ${e}`,t)},Co={"/thread":class extends ce{constructor(e){super(),le(this,e,Tn,Cn,l,[])}},"/public":class extends ce{constructor(e){var t;super(),document.getElementById("svelte-kdiu44-style")||((t=x("style")).id="svelte-kdiu44-style",t.textContent="",v(document.head,t)),le(this,e,Qt,Gt,l,[])}},"/compose":class extends ce{constructor(e){var t;super(),document.getElementById("svelte-olsuyr-style")||((t=x("style")).id="svelte-olsuyr-style",t.textContent='.file-on-top.svelte-olsuyr{border:solid 2px rgb(26, 192, 11)}input[type="file"].svelte-olsuyr{display:none}',v(document.head,t)),le(this,e,kn,yn,l,[])}},"/profile":class extends ce{constructor(e){super(),le(this,e,En,Ln,l,[])}},"/error":class extends ce{constructor(e){super(),le(this,e,Hn,Bn,l,[])}},"/channels":class extends ce{constructor(e){var t;super(),document.getElementById("svelte-1or0a5q-style")||((t=x("style")).id="svelte-1or0a5q-style",t.textContent=".channel.svelte-1or0a5q{cursor:pointer}",v(document.head,t)),le(this,e,Kn,Vn,l,[])}},"/channel":class extends ce{constructor(e){var t;super(),document.getElementById("svelte-kdiu44-style")||((t=x("style")).id="svelte-kdiu44-style",t.textContent="",v(document.head,t)),le(this,e,no,to,l,[])}},"/settings":ho,"/mentions":class extends ce{constructor(e){var t;super(),document.getElementById("svelte-kdiu44-style")||((t=x("style")).id="svelte-kdiu44-style",t.textContent="",v(document.head,t)),le(this,e,yo,bo,l,[])}},"*":class extends ce{constructor(e){super(),le(this,e,null,Xt,l,[])}}},To=(ue([wo,xo],([e,t])=>{let n=t.location;return e?Co.hasOwnProperty(n)?Co[n]:(console.log("didn't find",n),Co["*"]):"/settings"===n?ho:Co["*"]}),()=>new Promise((e,t)=>{browser.storage.local.get().then(n=>{window.ssb=new we,ssb.connect(n.keys).then(t=>{console.log("connected"),wo.set(!0),e()}).catch(e=>{console.error("can't reconnect",e),t(e)})},t)})),Po=(e,t)=>ko.preferences&&ko.preferences.hasOwnProperty(e)?ko.preferences[e]:t,Mo=({keys:e,remote:t,manifest:n})=>{ko.keys=e,ko.remote=t,ko.manifest=n,browser.storage.local.set(ko)},Fo=(e,t)=>{ko.preferences=ko.preferences||{},ko.preferences[e]=t,browser.storage.local.set(ko)};let Io;window.hermiebox=hermiebox,console.log("hermiebox",hermiebox),browser.runtime.onInstalled.addListener(function(e){let t;switch(browser.runtime.getManifest().version,e.reason){case"update":t=browser.extension.getURL("/docs/index.html#/release_notes/2019.6.2"),browser.tabs.create({url:`${t}`});break;case"install":t=browser.extension.getURL("/docs/index.html#/guide"),browser.tabs.create({url:`${t}`})}});(async()=>{(Io=new SharedWorker("worker-contact-cache-bundle.js")).port.onmessage=(e=>{console.log("[[ contact worker ]]",e)}),Io.port.postMessage({command:"connect",hermiebox:hermiebox})})()}();
//# sourceMappingURL=background-bundle.js.map
