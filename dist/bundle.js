!function(){"use strict";function e(){}const t=e=>e;function n(e,t){for(const n in t)e[n]=t[n];return e}function o(e){return e()}function r(){return Object.create(null)}function a(e){e.forEach(o)}function s(e){return"function"==typeof e}function c(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function i(e,t,n){const o=t.subscribe(n);e.$$.on_destroy.push(o.unsubscribe?()=>o.unsubscribe():o)}const l="undefined"!=typeof window;let u=l?()=>window.performance.now():()=>Date.now(),m=l?requestAnimationFrame:e;const d=new Set;let h,p=!1;function g(){d.forEach(e=>{e[0](u())||(d.delete(e),e[1]())}),(p=d.size>0)&&m(g)}function f(e){let t;return p||(p=!0,m(g)),{promise:new Promise(n=>{d.add(t=[e,n])}),abort(){d.delete(t)}}}function b(e,t){e.appendChild(t)}function v(e,t,n){e.insertBefore(t,n||null)}function y(e){e.parentNode.removeChild(e)}function k(e,t){for(;e.nextSibling&&e.nextSibling!==t;)e.parentNode.removeChild(e.nextSibling)}function w(e){return document.createElement(e)}function $(e){return document.createTextNode(e)}function x(){return $(" ")}function N(){return $("")}function C(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function _(e){return function(t){return t.preventDefault(),e.call(this,t)}}function T(e){return function(t){return t.stopPropagation(),e.call(this,t)}}function P(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function M(e,t){t=""+t,e.data!==t&&(e.data=t)}function R(e,t,n){e.classList[n?"add":"remove"](t)}let S,I=0,U={};function L(e,t,n,o,r,a,s,c=0){const i=16.666/o;let l="{\n";for(let e=0;e<=1;e+=i){const o=t+(n-t)*a(e);l+=100*e+`%{${s(o,1-o)}}\n`}const u=l+`100% {${s(n,1-n)}}\n}`,m=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${c}`;if(!U[m]){if(!h){const e=w("style");document.head.appendChild(e),h=e.sheet}U[m]=!0,h.insertRule(`@keyframes ${m} ${u}`,h.cssRules.length)}const d=e.style.animation||"";return e.style.animation=`${d?`${d}, `:""}${m} ${o}ms linear ${r}ms 1 both`,I+=1,m}function O(e,t){e.style.animation=(e.style.animation||"").split(", ").filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")).join(", "),t&&!--I&&m(()=>{if(I)return;let e=h.cssRules.length;for(;e--;)h.deleteRule(e);U={}})}function A(e){S=e}function F(){if(!S)throw new Error("Function called outside component initialization");return S}function E(e){F().$$.on_mount.push(e)}function H(e){F().$$.on_destroy.push(e)}function j(){const e=S;return(t,n)=>{const o=e.$$.callbacks[t];if(o){const r=function(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}(t,n);o.slice().forEach(t=>{t.call(e,r)})}}}const B=[],q=Promise.resolve();let D=!1;const z=[],Y=[],V=[];function W(e){Y.push(e)}function J(){const e=new Set;do{for(;B.length;){const e=B.shift();A(e),K(e.$$)}for(;z.length;)z.shift()();for(;Y.length;){const t=Y.pop();e.has(t)||(t(),e.add(t))}}while(B.length);for(;V.length;)V.pop()();D=!1}function K(e){e.fragment&&(e.update(e.dirty),a(e.before_render),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_render.forEach(W))}let G,Q;function X(){return G||(G=Promise.resolve()).then(()=>{G=null}),G}function Z(){Q={remaining:0,callbacks:[]}}function ee(){Q.remaining||a(Q.callbacks)}function te(e){Q.callbacks.push(e)}function ne(e,t){const o=t.token={};function r(e,r,a,s){if(t.token!==o)return;t.resolved=a&&{[a]:s};const c=n(n({},t.ctx),t.resolved),i=e&&(t.current=e)(c);t.block&&(t.blocks?t.blocks.forEach((e,n)=>{n!==r&&e&&(Z(),te(()=>{e.d(1),t.blocks[n]=null}),e.o(1),ee())}):t.block.d(1),i.c(),i.i&&i.i(1),i.m(t.mount(),t.anchor),J()),t.block=i,t.blocks&&(t.blocks[r]=i)}if((a=e)&&"function"==typeof a.then){if(e.then(e=>{r(t.then,1,t.value,e)},e=>{r(t.catch,2,t.error,e)}),t.current!==t.pending)return r(t.pending,0),!0}else{if(t.current!==t.then)return r(t.then,1,t.value,e),!0;t.resolved={[t.value]:e}}var a}function oe(e,t){te(()=>{!function(e,t){e.d(1),t.delete(e.key)}(e,t)}),e.o(1)}function re(e,t,n,o,r,a,s,c,i,l,u,m){let d=e.length,h=a.length,p=d;const g={};for(;p--;)g[e[p].key]=p;const f=[],b=new Map,v=new Map;for(p=h;p--;){const e=m(r,a,p),c=n(e);let i=s.get(c);i?o&&i.p(t,e):(i=l(c,e)).c(),b.set(c,f[p]=i),c in g&&v.set(c,Math.abs(p-g[c]))}const y=new Set,k=new Set;function w(e){e.i&&e.i(1),e.m(c,u),s.set(e.key,e),u=e.first,h--}for(;d&&h;){const t=f[h-1],n=e[d-1],o=t.key,r=n.key;t===n?(u=t.first,d--,h--):b.has(r)?!s.has(o)||y.has(o)?w(t):k.has(r)?d--:v.get(o)>v.get(r)?(k.add(o),w(t)):(y.add(r),d--):(i(n,s),d--)}for(;d--;){const t=e[d];b.has(t.key)||i(t,s)}for(;h;)w(f[h-1]);return f}function ae(e,t,n){const{fragment:r,on_mount:c,on_destroy:i,after_render:l}=e.$$;r.m(t,n),W(()=>{const t=c.map(o).filter(s);i?i.push(...t):a(t),e.$$.on_mount=[]}),l.forEach(W)}function se(e,t){e.$$.dirty||(B.push(e),D||(D=!0,q.then(J)),e.$$.dirty=r()),e.$$.dirty[t]=!0}function ce(t,n,o,s,c,i){const l=S;A(t);const u=n.props||{},m=t.$$={fragment:null,ctx:null,props:i,update:e,not_equal:c,bound:r(),on_mount:[],on_destroy:[],before_render:[],after_render:[],context:new Map(l?l.$$.context:[]),callbacks:r(),dirty:null};let d=!1;var h;m.ctx=o?o(t,u,(e,n)=>{m.ctx&&c(m.ctx[e],m.ctx[e]=n)&&(m.bound[e]&&m.bound[e](n),d&&se(t,e))}):u,m.update(),d=!0,a(m.before_render),m.fragment=s(m.ctx),n.target&&(n.hydrate?m.fragment.l((h=n.target,Array.from(h.childNodes))):m.fragment.c(),n.intro&&t.$$.fragment.i&&t.$$.fragment.i(),ae(t,n.target,n.anchor),J()),A(l)}class ie{$destroy(){var t,n;n=!0,(t=this).$$&&(a(t.$$.on_destroy),t.$$.fragment.d(n),t.$$.on_destroy=t.$$.fragment=null,t.$$.ctx={}),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}function le(t,n=e){let o;const r=[];function a(e){if(c(t,e)){if(t=e,!o)return;r.forEach(e=>e[1]()),r.forEach(e=>e[0](t))}}return{set:a,update:function(e){a(e(t))},subscribe:function(s,c=e){const i=[s,c];return r.push(i),1===r.length&&(o=n(a)||e),s(t),()=>{const e=r.indexOf(i);-1!==e&&r.splice(e,1),0===r.length&&o()}}}}function ue(t,n,o){const r=!Array.isArray(t),c=r?[t]:t,i=n.length<2;return{subscribe:le(o,t=>{let o=!1;const l=[];let u=0,m=e;const d=()=>{if(u)return;m();const o=n(r?l[0]:l,t);i?t(o):m=s(o)?o:e},h=c.map((e,t)=>e.subscribe(e=>{l[t]=e,u&=~(1<<t),o&&d()},()=>{u|=1<<t}));return o=!0,d(),function(){a(h),m()}}).subscribe}}const me=hermiebox.modules.pullStream,de=hermiebox.modules.ssbSort;let he=!1;class pe{log(e,t=""){console.log(`[SSB API] - ${e}`,t)}async connect(e){var t=await hermiebox.api.connect(e);this.log("you are",t.id),this.feed=t.id,he=t}filterLimit(){return me.take(mo("limit",10))}filterTypes(){let e={post:"showTypePost",about:"showTypeAbout",vote:"showTypeVote",contact:"showTypeContent",pub:"showTypePost",blog:"showTypeBlog",channel:"showTypeChannel"};return mo("showTypeUnknown",!1)?me.filter(()=>!0):me.filter(t=>{let n=t.value.content.type;return"string"==typeof n&&e.hasOwnProperty(n)?mo(e[n],!0):mo("showTypeUnknown",!1)})}public(e){return new Promise((t,n)=>{(e=e||{}).reverse=e.reverse||!0,me(he.createFeedStream(e),me.filter(e=>e&&e.value&&e.value.content),this.filterTypes(),this.filterLimit(),me.collect((e,o)=>{e&&n(e),t(o)}))})}thread(e){return new Promise((t,n)=>{he.get(e,(o,r)=>{if(o)return cb(o);var a={key:e,value:r};me(he.backlinks&&he.backlinks.read?he.backlinks.read({query:[{$filter:{dest:e,value:{content:{root:e}}}}]}):me(he.links({dest:e,values:!0,rel:"root"}),me.filter(function(t){var n=t&&t.value&&t.value.content;return n&&"post"===n.type&&n.root===e}),me.unique("key")),this.filterTypes(),me.collect((e,o)=>{e&&n(e),t(de([a].concat(o)))}))})})}mentions(e,t){return new Promise((e,n)=>{me((e=>{var n={$filter:{dest:e}};return t&&(n.$filter.value={timestamp:{$lt:t}}),he.backlinks.read({query:[n],index:"DTA",reverse:!0})})(he.id),this.filterTypes(),this.filterLimit(),me.collect((t,o)=>{t?n(t):e(o)}))})}async profile(e){try{return await hermiebox.api.profile(e)}catch(e){return console.error(e),!1}}async get(e){return await hermiebox.api.get(e)}async setAvatarCache(e,t){let n={};return n[`avatar-${e}`]=t,browser.storage.local.set(n)}async getCachedAvatar(e){return browser.storage.local.get(`avatar-${e}`)}async avatar(e){try{let t=await hermiebox.api.avatar(e);return await this.setAvatarCache(e,t),t}catch(e){throw e}}async blurbFromMsg(e,t){let n=e;try{let o=await ssb.get(e);return"post"==o.content.type&&(n=this.plainTextFromMarkdown(o.content.text.slice(0,t)+"...")),n}catch(e){return n}}plainTextFromMarkdown(e){let t=this.markdown(e),n=document.createElement("div");return n.innerHTML=t,n.innerText}markdown(e){let t=hermiebox.modules.ssbMarkdown.block(e);return t=t.replace("<pre>",'<pre class="code">').replace(/<a href="#([^"]*)/gi,function(e,t,n,o){return`<a class="channel-link" href="?channel=${encodeURIComponent(t)}#/channel`}).replace(/<a href="@([^"]*)/gi,function(e,t,n,o){return'<a class="profile-link" href="?feed='+encodeURIComponent(`@${t}`)+"#/profile"}).replace(/target="_blank"/gi,"").replace(/<a href="%([^"]*)/gi,function(e,t,n,o){return`<a class="thread-link" href="?thread=${encodeURIComponent(`%${t}`)}#/thread`}).replace(/<img src="&([^"]*)/gi,function(e,t,n,o){return'<img class="is-image-from-blob" src="http://localhost:8989/blobs/get/&'+encodeURIComponent(t)}).replace(/<a href="&([^"]*)/gi,function(e,t,n,o){return'<a class="image-link" target="_blank" href="http://localhost:8989/blobs/get/&'+encodeURIComponent(t)})}ref(){return hermiebox.modules.ssbRef}getTimestamp(e){const t=e.timestamp,n=e.value.timestamp;return Math.min(t,n)}getRootMsgId(e){if(e&&e.value&&e.value.content){const t=e.value.content.root;if(hermiebox.modules.ssbRef.isMsgId(t))return t}}newPost(e){return new Promise((t,n)=>{let o={type:"post",text:e.text};["root","branch","channel","fork"].forEach(t=>{void 0!==e[t]&&(o[t]=e[t])}),o.mentions=hermiebox.modules.ssbMentions(o.text)||[],o.mentions=o.mentions.filter(e=>e);const r=hermiebox.sbot||!1;console.log("post",o),r?r.publish(o,function(e,o){e?n(e):t(o)}):n("There is no sbot connection")})}follow(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1;o&&o.publish({type:"contact",contact:e,following:!0},(e,o)=>{e?n(e):t(o)})})}getBlob(e){return hermiebox.api.getBlob(e)}votes(e){return new Promise((t,n)=>{let o=hermiebox.modules.pullStream,r=hermiebox.sbot;r&&o(r.links({dest:e,rel:"vote",values:!0}),o.collect((e,o)=>{e?n(e):t(o)}))})}like(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"vote",vote:{link:e,value:1,expression:"Like"}};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}unlike(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"vote",vote:{link:e,value:0,expression:"Unlike"}};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}channels(){return new Promise((e,t)=>{let n=hermiebox.modules.pullStream,o=hermiebox.sbot||!1;o?(console.log("querying channels"),n(o.query.read({query:[{$filter:{value:{content:{channel:{$is:"string"},type:"post"}}}},{$reduce:{channel:["value","content","channel"],count:{$count:!0},timestamp:{$max:["value","timestamp"]}}},{$sort:[["timestamp"],["count"]]}],limit:20}),n.collect(function(n,o){console.log("channels",o),n?t(n):e(o)}))):t("no sbot")})}channel(e,t){return new Promise((n,o)=>{let r=hermiebox.modules.pullStream,a=hermiebox.sbot||!1,s={$filter:{value:{content:{channel:e}}}};t.lt&&(s.$filter.value.timestamp={$lt:t.lt}),console.dir(s),a?r(a.query.read({query:[s],limit:t.limit,reverse:!0}),r.collect(function(e,t){e?o(e):n(t)})):o("no sbot")})}channelSubscribe(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"channel",channel:e,subscribed:!0};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}channelUnsubscribe(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"channel",channel:e,subscribed:!1};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}channelSubscribed(e,t){return new Promise((n,o)=>{let r=hermiebox.modules.pullStream,a=hermiebox.sbot||!1;if(a){t||(t=a.id);let s={$filter:{value:{author:t,content:{type:"channel",channel:e}}}};r(a.query.read({query:[s],reverse:!0}),r.collect(function(e,t){e?o(e):t.length>0?n(t[0].value.content.subscribed||!1):n(!1)}))}else o("no sbot")})}subscribedChannels(e,t){return new Promise((e,n)=>{let o=hermiebox.modules.pullStream,r=hermiebox.sbot||!1;if(r){t||(t=r.id);let a={$filter:{value:{author:t,content:{type:"channel"}}},$map:{channel:["value","content","channel"],subscribed:["value","content","subscribed"]},$sort:[["value","timestamp"]]};o(r.query.read({query:[a],reverse:!0}),o.collect(function(t,o){t?n(t):e(o)}))}else n("no sbot")})}follow(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"contact",contact:e,following:!0};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}unfollow(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"contact",contact:e,following:!1};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}block(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"contact",contact:e,blocking:!0};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}unblock(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"contact",contact:e,blocking:!1};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}following(e,t){return new Promise((n,o)=>{let r=hermiebox.modules.pullStream,a=hermiebox.sbot||!1;if(a){t||(t=a.id);let s={$filter:{value:{author:t,content:{type:"contact",contact:e,following:{$is:"boolean"}}}}};r(a.query.read({query:[s],reverse:!0}),r.collect(function(e,t){e?o(e):t.length>0?n(t[0].value.content.following||!1):n(!1)}))}else o("no sbot")})}blocking(e,t){return new Promise((n,o)=>{let r=hermiebox.modules.pullStream,a=hermiebox.sbot||!1;if(a){t||(t=a.id);let s={$filter:{value:{author:t,content:{type:"contact",contact:e,blocking:{$is:"boolean"}}}}};r(a.query.read({query:[s],reverse:!0}),r.collect(function(e,t){e?o(e):t.length>0?n(t[0].value.content.blocking||!1):n(!1)}))}else o("no sbot")})}query(e,t,n,o,r){return new Promise((t,a)=>{if(he){let s={$filter:e};o&&(s.$map=o),r&&(s.$reduce=r),void 0===n&&(n=!0),me(he.query.read({query:[s],reverse:n}),this.filterTypes(),this.filterLimit(),me.collect((e,n)=>{e?a(e):t(n)}))}else a("no sbot")})}}var ge=e=>encodeURIComponent(e).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),fe=new RegExp("%[a-f0-9]{2}","gi"),be=new RegExp("(%[a-f0-9]{2})+","gi");function ve(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var n=e.slice(0,t),o=e.slice(t);return Array.prototype.concat.call([],ve(n),ve(o))}function ye(e){try{return decodeURIComponent(e)}catch(o){for(var t=e.match(fe),n=1;n<t.length;n++)t=(e=ve(t,n).join("")).match(fe);return e}}var ke=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"ï¿½ï¿½","%FF%FE":"ï¿½ï¿½"},n=be.exec(e);n;){try{t[n[0]]=decodeURIComponent(n[0])}catch(e){var o=ye(n[0]);o!==n[0]&&(t[n[0]]=o)}n=be.exec(e)}t["%C2"]="ï¿½";for(var r=Object.keys(t),a=0;a<r.length;a++){var s=r[a];e=e.replace(new RegExp(s,"g"),t[s])}return e}(e)}},we=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const n=e.indexOf(t);return-1===n?[e]:[e.slice(0,n),e.slice(n+t.length)]};function $e(e,t){return t.encode?t.strict?ge(e):encodeURIComponent(e):e}function xe(e,t){return t.decode?ke(e):e}function Ne(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function Ce(e){const t=(e=Ne(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function _e(e,t){const n=function(e){let t;switch(e.arrayFormat){case"index":return(e,n,o)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===o[e]&&(o[e]={}),o[e][t[1]]=n):o[e]=n};case"bracket":return(e,n,o)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==o[e]?o[e]=[].concat(o[e],n):o[e]=[n]:o[e]=n};case"comma":return(e,t,n)=>{const o="string"==typeof t&&t.split("").indexOf(",")>-1?t.split(","):t;n[e]=o};default:return(e,t,n)=>{void 0!==n[e]?n[e]=[].concat(n[e],t):n[e]=t}}}(t=Object.assign({decode:!0,arrayFormat:"none"},t)),o=Object.create(null);if("string"!=typeof e)return o;if(!(e=e.trim().replace(/^[?#&]/,"")))return o;for(const r of e.split("&")){let[e,a]=we(r.replace(/\+/g," "),"=");a=void 0===a?null:xe(a,t),n(xe(e,t),a,o)}return Object.keys(o).sort().reduce((e,t)=>{const n=o[t];return Boolean(n)&&"object"==typeof n&&!Array.isArray(n)?e[t]=function e(t){return Array.isArray(t)?t.sort():"object"==typeof t?e(Object.keys(t)).sort((e,t)=>Number(e)-Number(t)).map(e=>t[e]):t}(n):e[t]=n,e},Object.create(null))}var Te={extract:Ce,parse:_e,stringify:(e,t)=>{if(!e)return"";const n=function(e){switch(e.arrayFormat){case"index":return t=>(n,o)=>{const r=n.length;return void 0===o?n:null===o?[...n,[$e(t,e),"[",r,"]"].join("")]:[...n,[$e(t,e),"[",$e(r,e),"]=",$e(o,e)].join("")]};case"bracket":return t=>(n,o)=>void 0===o?n:null===o?[...n,[$e(t,e),"[]"].join("")]:[...n,[$e(t,e),"[]=",$e(o,e)].join("")];case"comma":return t=>(n,o,r)=>null==o||0===o.length?n:0===r?[[$e(t,e),"=",$e(o,e)].join("")]:[[n,$e(o,e)].join(",")];default:return t=>(n,o)=>void 0===o?n:null===o?[...n,$e(t,e)]:[...n,[$e(t,e),"=",$e(o,e)].join("")]}}(t=Object.assign({encode:!0,strict:!0,arrayFormat:"none"},t)),o=Object.keys(e);return!1!==t.sort&&o.sort(t.sort),o.map(o=>{const r=e[o];return void 0===r?"":null===r?$e(o,t):Array.isArray(r)?r.reduce(n(o),[]).join("&"):$e(o,t)+"="+$e(r,t)}).filter(e=>e.length>0).join("&")},parseUrl:(e,t)=>({url:Ne(e).split("?")[0]||"",query:_e(Ce(e),t)})};function Pe(e){var t,n,o,r,a;return{c(){t=w("span"),n=w("a"),o=$("(root)"),n.href=r="?thread="+encodeURIComponent(e.msg.value.content.root)+"#/thread",a=C(n,"click",_(e.goRoot))},m(e,r){v(e,t,r),b(t,n),b(n,o)},p(e,t){e.msg&&r!==(r="?thread="+encodeURIComponent(t.msg.value.content.root)+"#/thread")&&(n.href=r)},d(e){e&&y(t),a()}}}function Me(e){var t,n,o,r,a;return{c(){t=w("span"),n=w("a"),o=$("(in reply to)"),n.href=r="?thread="+encodeURIComponent(e.msg.value.content.branch)+"#/thread",a=C(n,"click",_(e.goBranch))},m(e,r){v(e,t,r),b(t,n),b(n,o)},p(e,t){e.msg&&r!==(r="?thread="+encodeURIComponent(t.msg.value.content.branch)+"#/thread")&&(n.href=r)},d(e){e&&y(t),a()}}}function Re(t){var n,o,r,s,c;return{c(){n=w("div"),(o=w("button")).textContent="Fork",r=x(),(s=w("button")).textContent="Reply",o.className="btn",s.className="btn",n.className="column col-6 text-right",c=[C(o,"click",t.fork),C(s,"click",t.reply)]},m(e,t){v(e,n,t),b(n,o),b(n,r),b(n,s)},p:e,d(e){e&&y(n),a(c)}}}function Se(t){var n,o,r,a,s,c,i,l,u,m,d,h,p,g,f=t.msg.value.content.root&&Pe(t),k=t.msg.value.content.branch&&Me(t),N=!t.msg.value.private&&Re(t);return{c(){n=w("div"),o=x(),r=w("div"),a=w("div"),s=w("div"),c=w("label"),i=w("input"),l=x(),u=w("i"),m=$("\r\n        Like"),d=x(),f&&f.c(),h=x(),k&&k.c(),p=x(),N&&N.c(),n.className="card-body svelte-1ftdgav",P(i,"type","checkbox"),i.checked=t.liked,u.className="form-icon",c.className="form-switch d-inline",s.className="column col-6",a.className="columns col-gapless",r.className="card-footer",g=C(i,"change",t.likeChanged)},m(e,g){v(e,n,g),n.innerHTML=t.content,v(e,o,g),v(e,r,g),b(r,a),b(a,s),b(s,c),b(c,i),b(c,l),b(c,u),b(c,m),b(s,d),f&&f.m(s,null),b(s,h),k&&k.m(s,null),b(a,p),N&&N.m(a,null)},p(e,t){e.liked&&(i.checked=t.liked),t.msg.value.content.root?f?f.p(e,t):((f=Pe(t)).c(),f.m(s,h)):f&&(f.d(1),f=null),t.msg.value.content.branch?k?k.p(e,t):((k=Me(t)).c(),k.m(s,null)):k&&(k.d(1),k=null),t.msg.value.private?N&&(N.d(1),N=null):N?N.p(e,t):((N=Re(t)).c(),N.m(a,null))},i:e,o:e,d(e){e&&(y(n),y(o),y(r)),f&&f.d(),k&&k.d(),N&&N.d(),g()}}}function Ie(e,t,n){let{msg:o}=t,r=ssb.markdown(o.value.content.text),a=!1;ssb.votes(o.key).then(e=>{e.forEach(e=>{e.value.author===ssb.feed&&1===e.value.content.vote.value&&n("liked",a=!0)})});return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,content:r,liked:a,likeChanged:e=>{e.target.checked?ssb.like(o.key).then(()=>console.log("liked",o.key)).catch(()=>{const e=a=!1;return n("liked",a),e}):ssb.unlike(o.key).then(()=>console.log("unliked",o.key)).catch(()=>{const e=a=!0;return n("liked",a),e})},reply:e=>{let t=o.value.content.root||o.key,n=o.value.content.channel,r=o.value.author;ao("/compose",{root:t,branch:o.key,channel:n,replyfeed:r})},fork:e=>{let t=o.value.content.root||o.key,n=o.value.content.channel,r=o.value.author;ao("/compose",{root:o.key,branch:o.key,fork:t,channel:n,replyfeed:r})},goRoot:e=>{let t=o.value.content.root||o.key;ao("/thread",{thread:t})},goBranch:e=>{let t=o.value.content.branch||o.key;ao("/thread",{thread:t})}}}class Ue extends ie{constructor(e){super(),ce(this,e,Ie,Se,c,["msg"])}}function Le(t){var n,o,r,a;return{c(){n=w("div"),o=w("pre"),r=w("code"),a=$(t.rawContent),o.className="code svelte-1c3kv1x",n.className="card-body"},m(e,t){v(e,n,t),b(n,o),b(o,r),b(r,a)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Oe(e,t,n){let{msg:o}=t,r=JSON.stringify(o,null,2);return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,rawContent:r}}class Ae extends ie{constructor(e){super(),ce(this,e,Oe,Le,c,["msg"])}}function Fe(t){var n,o,r,a,s,c,i,l;return{c(){n=w("div"),o=$(t.person),r=x(),a=$(t.expression),s=x(),c=w("a"),i=$(t.label),c.href="/index.html?thread="+t.encodedid+"#/thread",n.className="card-body",l=C(c,"click",t.goThread)},m(e,t){v(e,n,t),b(n,o),b(n,r),b(n,a),b(n,s),b(n,c),b(c,i)},p(e,t){e.person&&M(o,t.person),e.label&&M(i,t.label)},i:e,o:e,d(e){e&&y(n),l()}}}function Ee(e,t,n){let{msg:o}=t,r=o.value.content.vote.expression,a=o.value.content.vote.link,s=encodeURIComponent(a),c=a,i=o.value.author;ssb.blurbFromMsg(a,100).then(e=>{n("label",c=e)}),ssb.avatar(o.value.author).then(e=>{const t=i=e.name;return n("person",i),t});return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,expression:r,encodedid:s,label:c,person:i,goThread:e=>{e.stopPropagation(),e.preventDefault(),e.ctrlKey?window.open(`?thread=${encodeURIComponent(a)}#/thread`):ao("/thread",{thread:a})}}}class He extends ie{constructor(e){super(),ce(this,e,Ee,Fe,c,["msg"])}}function je(t){var n;return{c(){(n=w("div")).innerHTML="<p>ðŸ”’ PRIVATE</p>",n.className="card-body"},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Be(e,t,n){let{msg:o}=t;return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o}}class qe extends ie{constructor(e){super(),ce(this,e,Be,je,c,["msg"])}}function De(t){var n,o,r,a,s,c,i,l;return{c(){n=w("div"),o=$(t.person),r=x(),a=$(t.verb),s=x(),c=w("a"),i=$(t.otherPersonName),c.href="?feed="+t.otherPersonFeed+"#/profile",n.className="card-body",l=C(c,"click",t.goProfile)},m(e,t){v(e,n,t),b(n,o),b(n,r),b(n,a),b(n,s),b(n,c),b(c,i)},p(e,t){e.person&&M(o,t.person),e.verb&&M(a,t.verb),e.otherPersonName&&M(i,t.otherPersonName)},i:e,o:e,d(e){e&&y(n),l()}}}function ze(e,t,n){let{msg:o}=t,r=o.value.author,a=encodeURIComponent(o.value.content.contact),s=a,c=o.value.content.following?"followed":"unfollowed";o.value.content.blocking&&n("verb",c="blocked"),ssb.avatar(o.value.author).then(e=>{const t=r=e.name;return n("person",r),t}),ssb.avatar(o.value.content.contact).then(e=>{n("otherPersonName",s=e.name)}).catch(e=>console.log(e));return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,person:r,otherPersonFeed:a,otherPersonName:s,verb:c,goProfile:e=>{e.stopPropagation(),e.preventDefault(),ao("/profile",{feed:o.value.content.contact})}}}class Ye extends ie{constructor(e){super(),ce(this,e,ze,De,c,["msg"])}}function Ve(t){var n,o,r,a,s,c,i,l,u;return{c(){n=w("div"),o=$(t.person),r=x(),a=$(t.verb),s=x(),c=w("a"),i=$("#"),l=$(t.channel),c.href="?channel="+t.channel+"#/channel",n.className="card-body",u=C(c,"click",t.goChannel)},m(e,t){v(e,n,t),b(n,o),b(n,r),b(n,a),b(n,s),b(n,c),b(c,i),b(c,l)},p(e,t){e.person&&M(o,t.person)},i:e,o:e,d(e){e&&y(n),u()}}}function We(e,t,n){let{msg:o}=t,r=o.value.author,a=o.value.content.subscribed?"subscribed":"unsubscribed",s=encodeURIComponent(o.value.content.channel);ssb.avatar(o.value.author).then(e=>{const t=r=e.name;return n("person",r),t});return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,person:r,verb:a,channel:s,goChannel:e=>{e.stopPropagation(),e.preventDefault(),ao("/channel",{channel:o.value.content.channel})}}}class Je extends ie{constructor(e){super(),ce(this,e,We,Ve,c,["msg"])}}function Ke(e){var t,n,o;return{c(){t=w("div"),n=$(e.person),o=$(" is doing something related to a gathering but gatherings are not\r\n      supported yet, sorry."),t.className="toast"},m(e,r){v(e,t,r),b(t,n),b(t,o)},p(e,t){e.person&&M(n,t.person)},d(e){e&&y(t)}}}function Ge(e){var t,n,o,r,a,s,c;function i(e){return e.image?Xe:Qe}var l=i(e),u=l(e),m=e.msg.value.content.description&&Ze(e);return{c(){t=$(e.person),n=x(),o=$(e.verb),r=x(),a=w("a"),u.c(),s=x(),m&&m.c(),c=N(),a.href="?feed="+e.otherLink+"#/profile"},m(e,i){v(e,t,i),v(e,n,i),v(e,o,i),v(e,r,i),v(e,a,i),u.m(a,null),v(e,s,i),m&&m.m(e,i),v(e,c,i)},p(e,n){e.person&&M(t,n.person),e.verb&&M(o,n.verb),l===(l=i(n))&&u?u.p(e,n):(u.d(1),(u=l(n))&&(u.c(),u.m(a,null))),n.msg.value.content.description?m?m.p(e,n):((m=Ze(n)).c(),m.m(c.parentNode,c)):m&&(m.d(1),m=null)},d(e){e&&(y(t),y(n),y(o),y(r),y(a)),u.d(),e&&y(s),m&&m.d(e),e&&y(c)}}}function Qe(e){var t,n;return{c(){t=w("span"),n=$(e.otherName),t.className="chip"},m(e,o){v(e,t,o),b(t,n)},p(e,t){e.otherName&&M(n,t.otherName)},d(e){e&&y(t)}}}function Xe(e){var t,n,o,r;return{c(){t=w("div"),n=w("img"),o=x(),r=$(e.otherName),n.src=e.image,n.className="avatar avatar-sm",n.alt=e.otherName,t.className="chip"},m(e,a){v(e,t,a),b(t,n),b(t,o),b(t,r)},p(e,t){e.otherName&&(n.alt=t.otherName,M(r,t.otherName))},d(e){e&&y(t)}}}function Ze(e){var t,n=e.ssb.markdown(e.msg.value.content.description);return{c(){t=w("blockquote")},m(e,o){v(e,t,o),t.innerHTML=n},p(e,o){e.msg&&n!==(n=o.ssb.markdown(o.msg.value.content.description))&&(t.innerHTML=n)},d(e){e&&y(t)}}}function et(t){var n;function o(e){return e.isThisAboutFeeds?Ge:Ke}var r=o(t),a=r(t);return{c(){n=w("div"),a.c(),n.className="card-body"},m(e,t){v(e,n,t),a.m(n,null)},p(e,t){r===(r=o(t))&&a?a.p(e,t):(a.d(1),(a=r(t))&&(a.c(),a.m(n,null)))},i:e,o:e,d(e){e&&y(n),a.d()}}}function tt(e,t,n){let{msg:o}=t,r=o.value.author,a=encodeURIComponent(o.value.content.about),s=o.value.content.name||o.value.content.about,c=!0,i=o.value.content.about===o.value.author?"self-identifies":"identifies";ssb.avatar(o.value.author).then(e=>{const t=r=e.name;return n("person",r),t}),s===o.value.content.about&&ssb.avatar(o.value.content.about).then(e=>{const t=s=e.name;return n("otherName",s),t});let l=!!o.value.content.image&&`http://localhost:8989/blobs/get/${encodeURIComponent(o.value.content.image)}`;return o.value.content.description&&n("verb",i+=" with description"),o.value.content.about.startsWith("%")&&n("isThisAboutFeeds",c=!1),e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,person:r,otherLink:a,otherName:s,isThisAboutFeeds:c,verb:i,image:l,ssb:ssb}}class nt extends ie{constructor(e){super(),ce(this,e,tt,et,c,["msg"])}}function ot(t){var n,o,r,a,s,c,i,l;return{c(){n=w("div"),o=$(t.person),r=$(" announced pub\r\n  "),a=w("a"),s=$(t.host),c=$(":"),i=$(t.port),a.href="/index.html?feed="+t.encodedid+"#/profile",n.className="card-body",l=C(a,"click",t.goProfile)},m(e,t){v(e,n,t),b(n,o),b(n,r),b(n,a),b(a,s),b(a,c),b(a,i)},p(e,t){e.person&&M(o,t.person)},i:e,o:e,d(e){e&&y(n),l()}}}function rt(e,t,n){let{msg:o}=t,r=encodeURIComponent(o.value.content.address.key),a=o.value.author,s=o.value.content.address.host,c=o.value.content.address.port;ssb.avatar(o.value.author).then(e=>{const t=a=e.name;return n("person",a),t});return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,encodedid:r,person:a,host:s,port:c,goProfile:e=>{e.stopPropagation(),e.preventDefault(),ao("/profile",{feed:o.value.content.address.key})}}}class at extends ie{constructor(e){super(),ce(this,e,rt,ot,c,["msg"])}}function st(t){var n,o;return{c(){n=w("div"),(o=w("img")).src="http://localhost:8989/blobs/get/"+encodeURIComponent(t.thumbnail),o.className="img-responsive",o.alt=t.title,n.className="card-image"},m(e,t){v(e,n,t),b(n,o)},p:e,d(e){e&&y(n)}}}function ct(t){var n,o;return{c(){n=w("h1"),o=$(t.title),n.className="card-title h5"},m(e,t){v(e,n,t),b(n,o)},p:e,d(e){e&&y(n)}}}function it(e){var t,n,o;return{c(){t=w("div"),n=$("Can't load blogpost: "),o=$(e.toastMsg),t.className="toast toast-error"},m(e,r){v(e,t,r),b(t,n),b(t,o)},p(e,t){e.toastMsg&&M(o,t.toastMsg)},d(e){e&&y(t)}}}function lt(t){var n,o;return{c(){n=w("noscript"),o=w("noscript")},m(e,r){v(e,n,r),n.insertAdjacentHTML("afterend",t.summary),v(e,o,r)},p:e,d(e){e&&(k(n,o),y(n),y(o))}}}function ut(e){var t,n;return{c(){t=w("noscript"),n=w("noscript")},m(o,r){v(o,t,r),t.insertAdjacentHTML("afterend",e.post),v(o,n,r)},p(e,o){e.post&&(k(t,n),t.insertAdjacentHTML("afterend",o.post))},d(e){e&&(k(t,n),y(t),y(n))}}}function mt(e){var t,n,o,r,a;return{c(){t=w("span"),n=w("a"),o=$("(root)"),n.href=r="?thread="+encodeURIComponent(e.msg.value.content.root)+"#/thread",a=C(n,"click",_(e.goRoot))},m(e,r){v(e,t,r),b(t,n),b(n,o)},p(e,t){e.msg&&r!==(r="?thread="+encodeURIComponent(t.msg.value.content.root)+"#/thread")&&(n.href=r)},d(e){e&&y(t),a()}}}function dt(e){var t,n,o,r,a;return{c(){t=w("span"),n=w("a"),o=$("(in reply to)"),n.href=r="?thread="+encodeURIComponent(e.msg.value.content.branch)+"#/thread",a=C(n,"click",_(e.goBranch))},m(e,r){v(e,t,r),b(t,n),b(n,o)},p(e,t){e.msg&&r!==(r="?thread="+encodeURIComponent(t.msg.value.content.branch)+"#/thread")&&(n.href=r)},d(e){e&&y(t),a()}}}function ht(e){var t,n;return{c(){(t=w("button")).textContent="Close Blogpost",t.className="btn btn-primary",R(t,"locating",e.loading),n=C(t,"click",e.click_handler)},m(e,n){v(e,t,n)},p(e,n){e.loading&&R(t,"locating",n.loading)},d(e){e&&y(t),n()}}}function pt(e){var t,n;return{c(){(t=w("button")).textContent="Read Blogpost",t.className="btn btn-primary",R(t,"locating",e.loading),n=C(t,"click",e.displayBlogPost)},m(e,n){v(e,t,n)},p(e,n){e.loading&&R(t,"locating",n.loading)},d(e){e&&y(t),n()}}}function gt(t){var n,o,r,s,c,i,l,u,m,d,h,p,g,f,k,N,_,T,M,R,S=t.thumbnail&&st(t),I=t.title&&ct(t),U=t.toast&&it(t);function L(e){return e.showBlogpost?ut:lt}var O=L(t),A=O(t),F=t.msg.value.content.root&&mt(t),E=t.msg.value.content.branch&&dt(t);function H(e){return e.showBlogpost?ht:pt}var j=H(t),B=j(t);return{c(){S&&S.c(),n=x(),o=w("div"),I&&I.c(),r=x(),U&&U.c(),s=x(),A.c(),c=x(),i=w("div"),l=w("div"),u=w("div"),m=w("label"),d=w("input"),h=x(),p=w("i"),g=$("\n        Like"),f=x(),F&&F.c(),k=x(),E&&E.c(),N=x(),_=w("div"),(T=w("button")).textContent="Reply",M=x(),B.c(),o.className="card-body",P(d,"type","checkbox"),d.checked=t.liked,p.className="form-icon",m.className="form-switch d-inline",u.className="column col-6",T.className="btn",_.className="column col-6 text-right",l.className="columns col-gapless",i.className="card-footer",R=[C(d,"change",t.likeChanged),C(T,"click",t.reply)]},m(e,t){S&&S.m(e,t),v(e,n,t),v(e,o,t),I&&I.m(o,null),b(o,r),U&&U.m(o,null),b(o,s),A.m(o,null),v(e,c,t),v(e,i,t),b(i,l),b(l,u),b(u,m),b(m,d),b(m,h),b(m,p),b(m,g),b(u,f),F&&F.m(u,null),b(u,k),E&&E.m(u,null),b(l,N),b(l,_),b(_,T),b(_,M),B.m(_,null)},p(e,t){t.thumbnail?S?S.p(e,t):((S=st(t)).c(),S.m(n.parentNode,n)):S&&(S.d(1),S=null),t.title?I?I.p(e,t):((I=ct(t)).c(),I.m(o,r)):I&&(I.d(1),I=null),t.toast?U?U.p(e,t):((U=it(t)).c(),U.m(o,s)):U&&(U.d(1),U=null),O===(O=L(t))&&A?A.p(e,t):(A.d(1),(A=O(t))&&(A.c(),A.m(o,null))),e.liked&&(d.checked=t.liked),t.msg.value.content.root?F?F.p(e,t):((F=mt(t)).c(),F.m(u,k)):F&&(F.d(1),F=null),t.msg.value.content.branch?E?E.p(e,t):((E=dt(t)).c(),E.m(u,null)):E&&(E.d(1),E=null),j===(j=H(t))&&B?B.p(e,t):(B.d(1),(B=j(t))&&(B.c(),B.m(_,null)))},i:e,o:e,d(e){S&&S.d(e),e&&(y(n),y(o)),I&&I.d(),U&&U.d(),A.d(),e&&(y(c),y(i)),F&&F.d(),E&&E.d(),B.d(),a(R)}}}function ft(e,t,n){let o;i(e,ro,e=>{n("$routeLocation",o=e)});let{msg:r}=t,a=r.value.content,s=ssb.markdown(a.summary),c=a.thumbnail||!1,l=a.title||!1,u=!1,m=!1,d=!1,h="",p=s,g=!1;ssb.votes(r.key).then(e=>{e.forEach(e=>{e.value.author===ssb.feed&&1===e.value.content.vote.value&&n("liked",g=!0)})});const f=e=>{n("loading",m=!0),console.log("loading blogpost",a.blog),ssb.getBlob(a.blog).then(e=>{n("post",p=ssb.markdown(e)),n("showBlogpost",u=!0)}).catch(e=>{console.error("can't load blog post",e),n("toast",d=!0),n("toastMsg",h=e)})};return"/thread"==o&&setTimeout(f,100),e.$set=(e=>{"msg"in e&&n("msg",r=e.msg)}),{msg:r,summary:s,thumbnail:c,title:l,showBlogpost:u,loading:m,toast:d,toastMsg:h,post:p,liked:g,likeChanged:e=>{e.target.checked?ssb.like(r.key).then(()=>console.log("liked",r.key)).catch(()=>{const e=g=!1;return n("liked",g),e}):ssb.unlike(r.key).then(()=>console.log("unliked",r.key)).catch(()=>{const e=g=!0;return n("liked",g),e})},displayBlogPost:f,reply:e=>{let t=r.value.content.root||r.key,n=r.value.content.channel;ao("/compose",{root:t,branch:r.key,channel:n})},goRoot:e=>{let t=r.value.content.root||r.key;ao("/thread",{thread:t})},goBranch:e=>{let t=r.value.content.branch||r.key;ao("/thread",{thread:t})},click_handler:function(){const e=u=!1;return n("showBlogpost",u),e}}}class bt extends ie{constructor(e){super(),ce(this,e,ft,gt,c,["msg"])}}function vt(e){var t,n,o;return{c(){t=w("span"),n=$(e.name),t.className="chip",o=C(t,"click",e.avatarClick)},m(e,o){v(e,t,o),b(t,n)},p(e,t){e.name&&M(n,t.name)},d(e){e&&y(t),o()}}}function yt(e){var t,n,o,r,a;return{c(){t=w("div"),n=w("img"),o=x(),r=$(e.name),n.src=e.image,n.className="avatar avatar-sm",t.className="chip",a=C(t,"click",e.avatarClick)},m(e,a){v(e,t,a),b(t,n),b(t,o),b(t,r)},p(e,t){e.image&&(n.src=t.image),e.name&&M(r,t.name)},d(e){e&&y(t),a()}}}function kt(t){var n;function o(e){return e.image?yt:vt}var r=o(t),a=r(t);return{c(){a.c(),n=N()},m(e,t){a.m(e,t),v(e,n,t)},p(e,t){r===(r=o(t))&&a?a.p(e,t):(a.d(1),(a=r(t))&&(a.c(),a.m(n.parentNode,n)))},i:e,o:e,d(e){a.d(e),e&&y(n)}}}function wt(e,t,n){let{feed:o}=t,r=!1,a=o;const s=j();return ssb.avatar(o).then(e=>{null!==e.image&&n("image",r=`http://localhost:8989/blobs/get/${e.image}`),n("name",a=e.name)}),e.$set=(e=>{"feed"in e&&n("feed",o=e.feed)}),{feed:o,image:r,name:a,avatarClick:function(){s("avatarClick",{feed:o,name:a})}}}class $t extends ie{constructor(e){super(),ce(this,e,wt,kt,c,["feed"])}}var xt=function(){};xt.prototype.simple=function(e){var t=Date.now(),n=Date.parse(e);try{if(n!=n)throw"timeago-simple: Please check date and time format! Unable to parse the date & time: "+e}catch(t){return console.error(t),e}return n-t<0?function(e){var t=Date.now();e=Date.parse(e);var n=(t-e)/1e3,o=n/60,r=n/3600;if(n<60&&o<1)return 1===n?Math.round(n)+" second ago":Math.round(n)+" seconds ago";if(o<60&&r<1)return 1===o?Math.round(o)+" minute ago":Math.round(o)+" minutes ago";if(r>24){var a=r/24;if(a>30){var s=a/30;if(s>12){var c=s/12;if(c>0)return 1===c?Math.ceil(c)+" year ago":Math.ceil(c)+" years ago"}return Math.round(s)+" month ago"}return 1===a?Math.round(a)+" day ago":Math.round(a)+" days ago"}return 1===r?Math.round(r)+" hour ago":Math.round(r)+" hours ago"}(e):function(e){var t=Date.now(),n=((e=Date.parse(e))-t)/1e3,o=n/60,r=n/3600;if(n<60&&o<1)return 1===n?"in "+Math.round(n)+" second":"in "+Math.round(n)+" seconds";if(o<60&&r<1)return 1===o?"in "+Math.round(o)+" minute":"in "+Math.round(o)+" minutes";if(r>24){var a=r/24;if(a>30){var s=a/30;if(s>12){var c=s/12;if(c>0)return 1===c?"in "+Math.ceil(c)+" year":"in "+Math.ceil(c)+" years"}return"in "+Math.round(s)+" month"}return 1===a?"in "+Math.round(a)+" day":"in "+Math.round(a)+" days"}return 1===r?"in "+Math.round(r)+" hour":"in "+Math.round(r)+" hours"}(e)},xt.prototype.future=function(e){console.warn("timeago-simple: .future function is depricated! Please use .simple for both past and future dates.");var t=Date.now();try{if(Date.parse(e)!=Date.parse(e))throw"timeago-simple: Please check date and time format! Unable to parse the date & time: "+e;if(Date.parse(e)-t<0)throw"timeago-simple: Looks like it's more relevant case for timeago.simple"}catch(t){return console.error(t),e}var n=((e=Date.parse(e))-t)/1e3,o=n/60,r=n/3600;if(n<60&&o<1)return 1===n?"in "+Math.round(n)+" second":"in "+Math.round(n)+" seconds";if(o<60&&r<1)return 1===o?"in "+Math.round(o)+" minute":"in "+Math.round(o)+" minutes";if(r>24){var a=r/24;if(a>30){var s=a/30;if(s>12){var c=s/12;if(c>0)return 1===c?"in "+Math.ceil(c)+" year":"in "+Math.ceil(c)+" years"}return"in "+Math.round(s)+" month"}return 1===a?"in "+Math.round(a)+" day":"in "+Math.round(a)+" days"}return 1===r?"in "+Math.round(r)+" hour":"in "+Math.round(r)+" hours"};var Nt=new xt;const Ct=e=>Nt.simple(new Date(e));function _t(e){var t;return{c(){(t=w("span")).textContent="PRIVATE",t.className="label"},m(e,n){v(e,t,n)},d(e){e&&y(t)}}}function Tt(e){var t,n,o=e.msg.value.content.channel;return{c(){t=$("#"),n=$(o)},m(e,o){v(e,t,o),v(e,n,o)},p(e,t){e.msg&&o!==(o=t.msg.value.content.channel)&&M(n,o)},d(e){e&&(y(t),y(n))}}}function Pt(e){var t;return{c(){t=$("Close raw message")},m(e,n){v(e,t,n)},d(e){e&&y(t)}}}function Mt(e){var t;return{c(){t=$("Show raw message")},m(e,n){v(e,t,n)},d(e){e&&y(t)}}}function Rt(t){var n,o,r,a,s,c,i,l,u,m,d,h,p,g,f,k,N,C,_,T,P;return{c(){n=w("div"),o=w("div"),r=w("div"),a=w("pre"),s=w("code"),c=$(t.rawContent),i=x(),l=w("div"),u=w("p"),m=$("This is a message of type\n            "),d=w("em"),h=$(t.type),p=$("\n            ."),g=x(),f=w("p"),k=$("To learn more about it, go to\n            "),N=w("a"),C=$("the documentation about messages with type "),_=$(t.type),P=$("\n            ."),a.className="code",r.className="column col-9",N.target="_blank",N.href=T="/docs/index.html#/message_types/"+t.type,l.className="column col-3",o.className="columns",n.className="card-body"},m(e,t){v(e,n,t),b(n,o),b(o,r),b(r,a),b(a,s),b(s,c),b(o,i),b(o,l),b(l,u),b(u,m),b(u,d),b(d,h),b(u,p),b(l,g),b(l,f),b(f,k),b(f,N),b(N,C),b(N,_),b(f,P)},p(e,t){e.type&&(M(h,t.type),M(_,t.type)),e.type&&T!==(T="/docs/index.html#/message_types/"+t.type)&&(N.href=T)},i:e,o:e,d(e){e&&y(n)}}}function St(e){var t,n,o=e.selectedRenderer;function r(e){return{props:{msg:e.msg}}}if(o)var a=new o(r(e));return{c(){a&&a.$$.fragment.c(),t=N()},m(e,o){a&&ae(a,e,o),v(e,t,o),n=!0},p(e,n){var s={};if(e.msg&&(s.msg=n.msg),o!==(o=n.selectedRenderer)){if(a){Z();const e=a;te(()=>{e.$destroy()}),e.$$.fragment.o(1),ee()}o?((a=new o(r(n))).$$.fragment.c(),a.$$.fragment.i(1),ae(a,t.parentNode,t)):a=null}else o&&a.$set(s)},i(e){n||(a&&a.$$.fragment.i(e),n=!0)},o(e){a&&a.$$.fragment.o(e),n=!1},d(e){e&&y(t),a&&a.$destroy(e)}}}function It(e){var t,n,o,r,s,c,i,l,u,m,d,h,p,g,f,k,N,T,P,S,I,U,L,O,A,F,E,H,j,B,q,D,z,Y,V,W,J,K,G,Q,X,ne,oe,re,ae,se,ce,ie=Ct(e.msg.value.timestamp),le=e.privateMsgForYou&&_t(),ue=e.msg.value.content.channel&&Tt(e);function me(e){return e.showRaw?Pt:Mt}var de=me(e),he=de(e),pe=[St,Rt],ge=[];function fe(e){return e.showRaw?1:0}return re=fe(e),ae=ge[re]=pe[re](e),{c(){t=w("div"),n=w("div"),o=w("div"),r=w("div"),s=w("div"),c=w("div"),i=w("div"),l=w("img"),u=x(),m=w("div"),d=w("div"),h=$(e.name),p=x(),g=w("small"),f=$(ie),k=x(),le&&le.c(),N=x(),T=w("div"),P=w("span"),ue&&ue.c(),S=x(),I=w("div"),(U=w("span")).innerHTML='<i class="icon icon-more-vert"></i>',L=x(),O=w("ul"),A=w("li"),F=w("a"),E=w("i"),H=$("\n              Open in new tab"),B=x(),q=w("li"),(D=w("a")).innerHTML='<i class="icon icon-copy"></i>\n\t\t\t              Copy permalink to clipboard\n\t\t\t            ',z=x(),Y=w("li"),(V=w("a")).innerHTML='<i class="icon icon-copy"></i>\n\t\t\t              Copy message id to clipboard\n\t\t\t            ',W=x(),J=w("li"),K=x(),G=w("li"),Q=w("a"),X=w("i"),ne=x(),he.c(),oe=x(),ae.c(),l.src=e.image,l.className="avatar avatar-lg",l.alt=e.feed,i.className="example-tile-icon",c.className="tile-icon",d.className="tile-title",g.className="tile-subtitle text-gray",m.className="tile-content",s.className="tile tile-centered feed-display svelte-m5ll6n",r.className="card-title",o.className="float-left",P.className="text-gray channel-display svelte-m5ll6n",U.className="btn btn-link dropdown-toggle",U.tabIndex="0",R(U,"active",e.dropdownActive),E.className="icon icon-share",F.href=j="?thread="+e.encodeURIComponent(e.msg.key)+"#/thread",F.target="_blank",A.className="menu-item",D.href="#",q.className="menu-item",V.href="#",Y.className="menu-item",J.className="divider",J.dataset.content="FOR THE CURIOUS",X.className="icon icon-message",Q.href="#",G.className="menu-item",O.className="menu menu-right svelte-m5ll6n",I.className="dropdown",T.className="float-right",n.className="card-header",t.className="card m-2 svelte-m5ll6n",R(t,"private",e.privateMsgForYou),ce=[C(s,"click",e.goProfile),C(P,"click",e.click_handler),C(U,"click",e.click_handler_1),C(D,"click",_(e.copyPermalink)),C(V,"click",_(e.copyHash)),C(Q,"click",_(e.toggleRawMessage))]},m(e,a){v(e,t,a),b(t,n),b(n,o),b(o,r),b(r,s),b(s,c),b(c,i),b(i,l),b(s,u),b(s,m),b(m,d),b(d,h),b(m,p),b(m,g),b(g,f),b(n,k),le&&le.m(n,null),b(n,N),b(n,T),b(T,P),ue&&ue.m(P,null),b(T,S),b(T,I),b(I,U),b(I,L),b(I,O),b(O,A),b(A,F),b(F,E),b(F,H),b(O,B),b(O,q),b(q,D),b(O,z),b(O,Y),b(Y,V),b(O,W),b(O,J),b(O,K),b(O,G),b(G,Q),b(Q,X),b(Q,ne),he.m(Q,null),b(t,oe),ge[re].m(t,null),se=!0},p(e,o){se&&!e.image||(l.src=o.image),se&&!e.name||M(h,o.name),se&&!e.msg||ie===(ie=Ct(o.msg.value.timestamp))||M(f,ie),o.privateMsgForYou?le||((le=_t()).c(),le.m(n,N)):le&&(le.d(1),le=null),o.msg.value.content.channel?ue?ue.p(e,o):((ue=Tt(o)).c(),ue.m(P,null)):ue&&(ue.d(1),ue=null),e.dropdownActive&&R(U,"active",o.dropdownActive),se&&!e.msg||j===(j="?thread="+o.encodeURIComponent(o.msg.key)+"#/thread")||(F.href=j),de!==(de=me(o))&&(he.d(1),(he=de(o))&&(he.c(),he.m(Q,null)));var r=re;(re=fe(o))===r?ge[re].p(e,o):(Z(),te(()=>{ge[r].d(1),ge[r]=null}),ae.o(1),ee(),(ae=ge[re])||(ae=ge[re]=pe[re](o)).c(),ae.i(1),ae.m(t,null)),e.privateMsgForYou&&R(t,"private",o.privateMsgForYou)},i(e){se||(ae&&ae.i(),se=!0)},o(e){ae&&ae.o(),se=!1},d(e){e&&y(t),le&&le.d(),ue&&ue.d(),he.d(),ge[re].d(),a(ce)}}}function Ut(e,t,n){let o,r,{msg:a}=t,s=a.value.author,c=!1,i=JSON.stringify(a,null,2),l=!1,u=!1,m={"*":Ae,post:Ue,vote:He,private:qe,contact:Ye,channel:Je,about:nt,pub:at,blog:bt};"string"==typeof a.value.content?n("type",o="private"):n("type",o=a.value.content.type),a.value.private&&n("privateMsgForYou",u=!0),m.hasOwnProperty(o)?n("selectedRenderer",r=m[o]):n("selectedRenderer",r=m["*"]);let d="images/icon.png",h=s;ssb.avatar(s).then(e=>{null!==e.image&&n("image",d=`http://localhost:8989/blobs/get/${e.image}`),n("name",h=e.name)});return e.$set=(e=>{"msg"in e&&n("msg",a=e.msg)}),{msg:a,type:o,feed:s,showRaw:c,rawContent:i,dropdownActive:l,privateMsgForYou:u,selectedRenderer:r,image:d,name:h,toggleRawMessage:()=>{n("showRaw",c=!c),n("dropdownActive",l=!1)},copyPermalink:()=>{navigator.clipboard.writeText(`ssb:${a.key}`).then(()=>console.log("permalink copied")).catch(e=>console.error("can't copy permalink",e)),n("dropdownActive",l=!1)},copyHash:()=>{navigator.clipboard.writeText(`${a.key}`).then(()=>console.log("hash copied")).catch(e=>console.error("can't copy hash",e)),n("dropdownActive",l=!1)},goProfile:e=>{e.ctrlKey?window.open(`?feed=${encodeURIComponent(s)}#/profile`):ao("/profile",{feed:s})},encodeURIComponent:encodeURIComponent,click_handler:function(){return ao("/channel",{channel:a.value.content.channel})},click_handler_1:function(){const e=l=!l;return n("dropdownActive",l),e}}}class Lt extends ie{constructor(e){super(),ce(this,e,Ut,It,c,["msg"])}}function Ot(e,t,n){const o=Object.create(e);return o.msg=t[n],o}function At(t){var n,o,r;return{c(){n=w("div"),o=$("Error: "),r=$(t.error),n.className="toast toast-error"},m(e,t){v(e,n,t),b(n,o),b(n,r)},p:e,d(e){e&&y(n)}}}function Ft(e){var t,n,o,r,s,c,i,l,u,m=[],d=new Map,h=e.msgs;const p=e=>e.msg.key;for(var g=0;g<h.length;g+=1){let t=Ot(e,h,g),n=p(t);d.set(n,m[g]=Ht(n,t))}return{c(){for(g=0;g<m.length;g+=1)m[g].c();t=x(),n=w("ul"),o=w("li"),(r=w("a")).innerHTML='<div class="page-item-subtitle">Previous</div>',s=x(),c=w("li"),(i=w("a")).innerHTML='<div class="page-item-subtitle">Next</div>',r.href="#/public",o.className="page-item page-previous",i.href="#/public",c.className="page-item page-next",n.className="pagination",u=[C(r,"click",T(_(e.goPrevious))),C(i,"click",T(_(e.goNext)))]},m(e,a){for(g=0;g<m.length;g+=1)m[g].m(e,a);v(e,t,a),v(e,n,a),b(n,o),b(o,r),b(n,s),b(n,c),b(c,i),l=!0},p(e,n){const o=n.msgs;Z(),m=re(m,e,p,1,n,o,d,t.parentNode,oe,Ht,t,Ot),ee()},i(e){if(!l){for(var t=0;t<h.length;t+=1)m[t].i();l=!0}},o(e){for(g=0;g<m.length;g+=1)m[g].o();l=!1},d(e){for(g=0;g<m.length;g+=1)m[g].d(e);e&&(y(t),y(n)),a(u)}}}function Et(t){var n;return{c(){(n=w("div")).className="loading loading-lg"},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Ht(e,t){var n,o,r=new Lt({props:{msg:t.msg}});return{key:e,first:null,c(){n=N(),r.$$.fragment.c(),this.first=n},m(e,t){v(e,n,t),ae(r,e,t),o=!0},p(e,t){var n={};e.msgs&&(n.msg=t.msg),r.$set(n)},i(e){o||(r.$$.fragment.i(e),o=!0)},o(e){r.$$.fragment.o(e),o=!1},d(e){e&&y(n),r.$destroy(e)}}}function jt(e){var t,n,o,r,a,s,c,i=e.error&&At(e),l=[Et,Ft],u=[];function m(e){return e.msgs?1:0}return r=m(e),a=u[r]=l[r](e),{c(){(t=w("div")).innerHTML='<div class="columns"><h4 class="column">Public Feed</h4>\n\t\t\t    <div class="column"></div></div>',n=x(),i&&i.c(),o=x(),a.c(),s=N(),t.className="container"},m(e,a){v(e,t,a),v(e,n,a),i&&i.m(e,a),v(e,o,a),u[r].m(e,a),v(e,s,a),c=!0},p(e,t){t.error?i?i.p(e,t):((i=At(t)).c(),i.m(o.parentNode,o)):i&&(i.d(1),i=null);var n=r;(r=m(t))===n?u[r].p(e,t):(Z(),te(()=>{u[n].d(1),u[n]=null}),a.o(1),ee(),(a=u[r])||(a=u[r]=l[r](t)).c(),a.i(1),a.m(s.parentNode,s))},i(e){c||(a&&a.i(),c=!0)},o(e){a&&a.o(),c=!1},d(e){e&&(y(t),y(n)),i&&i.d(e),e&&y(o),u[r].d(e),e&&y(s)}}}function Bt(e,t,n){let o;i(e,oo,e=>{n("$routeParams",o=e)});let r=!1,a=o.error||!1,s={limit:o.limit||mo("limit",10),reverse:!0};const c=()=>{ao("/public",{lt:r[r.length-1].rts})},l=()=>{history.back()};let u=keymage("p",()=>(l(),!1)),m=keymage("n",()=>(c(),!1));return H(()=>{u(),m()}),e.$$.update=((e={opts:1,$routeParams:1,error:1})=>{if(e.opts||e.$routeParams||e.error){Object.assign(s,o),document.title="Patchfox - Public",s.hasOwnProperty("lt")&&(s.lt=parseInt(s.lt),n("opts",s),n("$routeParams",o),n("error",a)),s.hasOwnProperty("limit")&&(s.limit=parseInt(s.limit),n("opts",s),n("$routeParams",o),n("error",a));ssb.public(s).then(e=>{n("msgs",r=e),window.scrollTo(0,0)}).catch(e=>{a||console.error("errrrooooor",e)})}}),{msgs:r,error:a,goNext:c,goPrevious:l}}function qt(t){var n;return{c(){(n=w("div")).className="empty"},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Dt(e){return e.stopPropagation(),e.preventDefault(),!1}var zt=function(e,t){e.addEventListener("dragenter",Dt,!1),e.addEventListener("dragover",Dt,!1),e.addEventListener("drop",function(e,t){t.stopPropagation(),t.preventDefault(),e(Array.prototype.slice.call(t.dataTransfer.files))}.bind(void 0,t),!1)};function Yt(e){const t=e-1;return t*t*t+1}function Vt(e,{delay:t=0,duration:n=400,easing:o=Yt}){const r=getComputedStyle(e),a=+r.opacity,s=parseFloat(r.height),c=parseFloat(r.paddingTop),i=parseFloat(r.paddingBottom),l=parseFloat(r.marginTop),u=parseFloat(r.marginBottom),m=parseFloat(r.borderTopWidth),d=parseFloat(r.borderBottomWidth);return{delay:t,duration:n,easing:o,css:e=>"overflow: hidden;"+`opacity: ${Math.min(20*e,1)*a};`+`height: ${e*s}px;`+`padding-top: ${e*c}px;`+`padding-bottom: ${e*i}px;`+`margin-top: ${e*l}px;`+`margin-bottom: ${e*u}px;`+`border-top-width: ${e*m}px;`+`border-bottom-width: ${e*d}px;`}}function Wt(t){var n,o,r;return{c(){n=w("div"),o=$("You are forking: "),r=$(t.fork),n.className="toast toast-warning"},m(e,t){v(e,n,t),b(n,o),b(n,r)},p:e,d(e){e&&y(n)}}}function Jt(e){var t;function n(e){return e.error?Gt:Kt}var o=n(e),r=o(e);return{c(){r.c(),t=N()},m(e,n){r.m(e,n),v(e,t,n)},p(e,a){o===(o=n(a))&&r?r.p(e,a):(r.d(1),(r=o(a))&&(r.c(),r.m(t.parentNode,t)))},d(e){r.d(e),e&&y(t)}}}function Kt(e){var t,n,o,r,a;return{c(){t=w("div"),n=$("Your message has been posted. Do you want to\r\n            "),o=w("a"),r=$("Check it out?"),o.target="_blank",o.href=a="?thread="+e.encodeURIComponent(e.msg.key)+"#/thread",t.className="toast toast-success"},m(e,a){v(e,t,a),b(t,n),b(t,o),b(o,r)},p(e,t){e.msg&&a!==(a="?thread="+t.encodeURIComponent(t.msg.key)+"#/thread")&&(o.href=a)},d(e){e&&y(t)}}}function Gt(e){var t,n;return{c(){t=w("div"),n=$(e.msg),t.className="toast toast-error"},m(e,o){v(e,t,o),b(t,n)},p(e,t){e.msg&&M(n,t.msg)},d(e){e&&y(t)}}}function Qt(t){var n,o,r,s,c,i,l,u,m,d,h,p,g,f,$,N,_,T=t.ssb.markdown(t.content),P=(t.channel||t.root||t.branch)&&Zt(t);return{c(){n=w("div"),(o=w("h2")).textContent="Post preview",r=x(),P&&P.c(),s=x(),c=w("noscript"),i=w("noscript"),l=x(),u=w("div"),m=x(),d=w("div"),(h=w("div")).innerHTML='<span class="label label-warning">\n\t\t\t                This message will be public and can\'t be edited or deleted\n\t\t\t              </span>',p=x(),g=w("div"),(f=w("button")).textContent="Go Back",$=x(),(N=w("button")).textContent="Post",u.className="divider",h.className="column col-md-12 col-lg-10",f.className="btn",N.className="btn btn-primary",R(N,"loading",t.posting),g.className="column col-md-12 col-lg-2",d.className="columns",n.className="column col-md-12",_=[C(f,"click",t.click_handler),C(N,"click",t.post)]},m(e,t){v(e,n,t),b(n,o),b(n,r),P&&P.m(n,null),b(n,s),b(n,c),c.insertAdjacentHTML("afterend",T),b(n,i),b(n,l),b(n,u),b(n,m),b(n,d),b(d,h),b(d,p),b(d,g),b(g,f),b(g,$),b(g,N)},p(e,t){t.channel||t.root||t.branch?P?P.p(e,t):((P=Zt(t)).c(),P.m(n,s)):P&&(P.d(1),P=null),e.content&&T!==(T=t.ssb.markdown(t.content))&&(k(c,i),c.insertAdjacentHTML("afterend",T)),e.posting&&R(N,"loading",t.posting)},i:e,o:e,d(e){e&&y(n),P&&P.d(),a(_)}}}function Xt(n){var o,r,s,c,i,l,m,d,h,p,g,k,$,N,M,S,I,U,A,F,E,H,j=n.branch&&on(n),B=n.replyfeed&&rn(n);return{c(){o=w("div"),(r=w("label")).textContent="Channel",s=x(),c=w("input"),i=x(),j&&j.c(),l=x(),B&&B.c(),m=x(),(d=w("label")).textContent="Message",h=x(),p=w("textarea"),g=x(),k=w("br"),$=x(),N=w("input"),M=x(),(S=w("button")).textContent="Attach File",I=x(),(U=w("button")).textContent="Preview",r.className="form-label",r.htmlFor="channel",c.className="form-input",P(c,"type","text"),c.id="channel",c.placeholder="channel",d.className="form-label",d.htmlFor="content",p.className="form-input svelte-olsuyr",p.id="content",p.placeholder="Type in your post",p.rows="10",R(p,"file-on-top",n.fileOnTop),P(N,"type","file"),N.id="fileInput",N.className="svelte-olsuyr",S.className="btn",U.className="btn btn-primary float-right",o.className="form-group",H=[C(c,"input",n.input0_input_handler),C(p,"input",n.textarea_input_handler),C(p,"dragover",T(_(n.dragOver))),C(p,"dragleave",T(_(n.dragLeave))),C(N,"input",n.attachFile),C(S,"click",n.attachFileTrigger),C(U,"click",n.preview)]},m(e,t){v(e,o,t),b(o,r),b(o,s),b(o,c),c.value=n.channel,b(o,i),j&&j.m(o,null),b(o,l),B&&B.m(o,null),b(o,m),b(o,d),b(o,h),b(o,p),p.value=n.content,b(o,g),b(o,k),b(o,$),b(o,N),b(o,M),b(o,S),b(o,I),b(o,U),E=!0},p(e,t){e.channel&&c.value!==t.channel&&(c.value=t.channel),t.branch?j?j.p(e,t):((j=on(t)).c(),j.m(o,l)):j&&(j.d(1),j=null),t.replyfeed?B?(B.p(e,t),B.i(1)):((B=rn(t)).c(),B.i(1),B.m(o,m)):B&&(Z(),te(()=>{B.d(1),B=null}),B.o(1),ee()),e.content&&(p.value=t.content),e.fileOnTop&&R(p,"file-on-top",t.fileOnTop)},i(n){E||(B&&B.i(),W(()=>{F&&F.end(1),A||(A=function(n,o,r){let a,s,c=o(n,r),i=!1,l=0;function m(){a&&O(n,a)}function d(){const{delay:o=0,duration:r=300,easing:d=t,tick:h=e,css:p}=c;p&&(a=L(n,0,1,r,o,d,p,l++)),h(0,1);const g=u()+o,b=g+r;s&&s.abort(),i=!0,s=f(e=>{if(i){if(e>=b)return h(1,0),m(),i=!1;if(e>=g){const t=d((e-g)/r);h(t,1-t)}}return i})}let h=!1;return{start(){h||(O(n),"function"==typeof c?(c=c(),X().then(d)):d())},invalidate(){h=!1},end(){i&&(m(),i=!1)}}}(o,Vt,{})),A.start()}),E=!0)},o(n){B&&B.o(),A&&A.invalidate(),n&&(F=function(n,o,r){let s,c=o(n,r),i=!0;const l=Q;function m(){const{delay:o=0,duration:r=300,easing:m=t,tick:d=e,css:h}=c;h&&(s=L(n,1,0,r,o,m,h));const p=u()+o,g=p+r;f(e=>{if(i){if(e>=g)return d(0,1),--l.remaining||a(l.callbacks),!1;if(e>=p){const t=m((e-p)/r);d(1-t,t)}}return i})}return l.remaining+=1,"function"==typeof c?X().then(()=>{c=c(),m()}):m(),{end(e){e&&c.tick&&c.tick(1,0),i&&(s&&O(n,s),i=!1)}}}(o,Vt,{})),E=!1},d(e){e&&y(o),j&&j.d(),B&&B.d(),e&&F&&F.end(),a(H)}}}function Zt(e){var t,n,o,r=e.channel&&en(e),a=e.root&&tn(e),s=e.branch&&nn(e);return{c(){t=w("blockquote"),r&&r.c(),n=x(),a&&a.c(),o=x(),s&&s.c()},m(e,c){v(e,t,c),r&&r.m(t,null),b(t,n),a&&a.m(t,null),b(t,o),s&&s.m(t,null)},p(e,c){c.channel?r?r.p(e,c):((r=en(c)).c(),r.m(t,n)):r&&(r.d(1),r=null),c.root?a?a.p(e,c):((a=tn(c)).c(),a.m(t,o)):a&&(a.d(1),a=null),c.branch?s?s.p(e,c):((s=nn(c)).c(),s.m(t,null)):s&&(s.d(1),s=null)},d(e){e&&y(t),r&&r.d(),a&&a.d(),s&&s.d()}}}function en(e){var t,n,o,r,a=e.channel.startsWith("#")?e.channel.slice(1):e.channel;return{c(){t=w("p"),(n=w("b")).textContent="Channel:",o=x(),r=$(a)},m(e,a){v(e,t,a),b(t,n),b(t,o),b(t,r)},p(e,t){e.channel&&a!==(a=t.channel.startsWith("#")?t.channel.slice(1):t.channel)&&M(r,a)},d(e){e&&y(t)}}}function tn(t){var n,o,r,a;return{c(){n=w("p"),(o=w("b")).textContent="Root:",r=x(),a=$(t.root)},m(e,t){v(e,n,t),b(n,o),b(n,r),b(n,a)},p:e,d(e){e&&y(n)}}}function nn(e){var t,n,o,r;return{c(){t=w("p"),(n=w("b")).textContent="In Reply To:",o=x(),r=$(e.branch)},m(e,a){v(e,t,a),b(t,n),b(t,o),b(t,r)},p(e,t){e.branch&&M(r,t.branch)},d(e){e&&y(t)}}}function on(e){var t,n,o,r;return{c(){(t=w("label")).textContent="In reply to",n=x(),o=w("input"),t.className="form-label",t.htmlFor="reply-to",o.className="form-input",P(o,"type","text"),o.id="reply-to",o.placeholder="in reply to",r=C(o,"input",e.input_input_handler)},m(r,a){v(r,t,a),v(r,n,a),v(r,o,a),o.value=e.branch},p(e,t){e.branch&&o.value!==t.branch&&(o.value=t.branch)},d(e){e&&(y(t),y(n),y(o)),r()}}}function rn(e){var t,n,o,r,a=new $t({props:{feed:e.replyfeed}});return a.$on("avatarClick",e.avatarClick),{c(){t=w("div"),n=w("span"),o=$("Click the avatar to add a link to the message:\r\n                "),a.$$.fragment.c(),t.className="mt-2"},m(e,s){v(e,t,s),b(t,n),b(n,o),ae(a,n,null),r=!0},p(e,t){var n={};e.replyfeed&&(n.feed=t.replyfeed),a.$set(n)},i(e){r||(a.$$.fragment.i(e),r=!0)},o(e){a.$$.fragment.o(e),r=!1},d(e){e&&y(t),a.$destroy()}}}function an(e){var t,n,o,r,a,s,c,i,l=e.fork&&Wt(e),u=e.msg&&Jt(e),m=[Xt,Qt],d=[];function h(e){return e.showPreview?1:0}return s=h(e),c=d[s]=m[s](e),{c(){t=w("div"),n=w("div"),o=w("div"),l&&l.c(),r=x(),u&&u.c(),a=x(),c.c(),o.className="column",n.className="columns",t.className="container"},m(e,c){v(e,t,c),b(t,n),b(n,o),l&&l.m(o,null),b(o,r),u&&u.m(o,null),b(o,a),d[s].m(o,null),i=!0},p(e,t){t.fork?l?l.p(e,t):((l=Wt(t)).c(),l.m(o,r)):l&&(l.d(1),l=null),t.msg?u?u.p(e,t):((u=Jt(t)).c(),u.m(o,a)):u&&(u.d(1),u=null);var n=s;(s=h(t))===n?d[s].p(e,t):(Z(),te(()=>{d[n].d(1),d[n]=null}),c.o(1),ee(),(c=d[s])||(c=d[s]=m[s](t)).c(),c.i(1),c.m(o,null))},i(e){i||(c&&c.i(),i=!0)},o(e){c&&c.o(),i=!1},d(e){e&&y(t),l&&l.d(),u&&u.d(),d[s].d()}}}function sn(e,t,n){let o;i(e,oo,e=>{n("$routeParams",o=e)});let r=!1,a=!1,s=!1,c=!1,l=o.root,u=o.branch,m=o.channel||"",d=o.content||"",h=o.replyfeed||!1,p=o.fork,g=!1,f=hermiebox.modules.pullStream,b=hermiebox.modules.pullFileReader,v=hermiebox.sbot;document.title="Patchfox - compose",E(()=>{n("error",s=!1),n("msg",a=""),zt(document.getElementById("content"),e=>y(e))});const y=e=>{if(n("error",s=!1),n("msg",a=""),0==e.length)return n("fileOnTop",g=!1),console.log("this is not a file"),!1;var t=e[0];return console.log(t),t.type.startsWith("image")?t.size>=5e6?(n("error",s=!0),n("msg",a=`File too large: ${Math.floor(t.size/1048576,2)}mb when max size is 5mb`),!1):void f(b(t),v.blobs.add(function(e,o){e?(n("error",s=!0),n("msg",a="Couldn't attach file: "+e)):n("content",d+=` ![${t.name}](${o})`),n("fileOnTop",g=!1)})):(n("error",s=!0),n("msg",a=`You can only drag & drop image, this file is a ${t.type}`),!1)};return{showPreview:r,msg:a,error:s,posting:c,root:l,branch:u,channel:m,content:d,replyfeed:h,fork:p,fileOnTop:g,post:async e=>{if(e.stopPropagation(),e.preventDefault(),!c){n("posting",c=!0),m.startsWith("#")&&n("channel",m=m.slice(1));try{n("msg",a=await ssb.newPost({text:d,channel:m,root:l,branch:u,fork:p})),n("posting",c=!1),console.log("posted",a),window.scrollTo(0,0)}catch(e){n("error",s=!0),n("msg",a=`Couldn't post your message: ${e}`),window.scrollTo(0,0),"stream is closed"==a.message&&(n("msg",a+=". We lost connection to sbot. We'll try to restablish it..."),lo().then(()=>{n("showPreview",r=!1),n("posting",c=!1),n("error",s=!1),n("msg",a="Connection to sbot reestablished. Try posting again")}).catch(e=>{window.location.search=`?root=${encodeURIComponent(l)}&branch=${encodeURIComponent(u)}&content=${encodeURIComponent(d)}&channel=${encodeURIComponent(m)}`,n("msg",a=`Sorry, couldn't reconnect to sbot:${e}. Try reloading the page. Your content has been saved to the URL`)}))}}},preview:e=>{n("showPreview",r=!0)},avatarClick:e=>{let t=e.detail.feed,o=e.detail.name;d.length>0?n("content",d+=` [${o}](${t})`):n("content",d=`[${o}](${t})`)},dragOver:e=>{n("fileOnTop",g=!0)},dragLeave:e=>{n("fileOnTop",g=!1)},attachFileTrigger:()=>{document.getElementById("fileInput").click()},attachFile:e=>{const t=e.target.files;y(t)},ssb:ssb,encodeURIComponent:encodeURIComponent,input0_input_handler:function(){m=this.value,n("channel",m)},input_input_handler:function(){u=this.value,n("branch",u)},textarea_input_handler:function(){d=this.value,n("content",d)},click_handler:function(){const e=r=!1;return n("showPreview",r),e}}}function cn(e,t,n){const o=Object.create(e);return o.msg=t[n],o}function ln(e){var t,n,o,r,a,s,c;return{c(){t=w("div"),n=$("Couldn't load thead\r\n    "),o=w("a"),r=$(e.msgid),s=$("\r\n    : "),c=$(e.error),o.href=a="?thread="+e.msgid+"#/thread",t.className="toast toast-error"},m(e,a){v(e,t,a),b(t,n),b(t,o),b(o,r),b(t,s),b(t,c)},p(e,t){e.msgid&&M(r,t.msgid),e.msgid&&a!==(a="?thread="+t.msgid+"#/thread")&&(o.href=a),e.error&&M(c,t.error)},d(e){e&&y(t)}}}function un(e){var t,n,o=[],r=new Map,a=e.msgs;const s=e=>e.msg.key;for(var c=0;c<a.length;c+=1){let t=cn(e,a,c),n=s(t);r.set(n,o[c]=dn(n,t))}return{c(){for(c=0;c<o.length;c+=1)o[c].c();t=N()},m(e,r){for(c=0;c<o.length;c+=1)o[c].m(e,r);v(e,t,r),n=!0},p(e,n){const a=n.msgs;Z(),o=re(o,e,s,1,n,a,r,t.parentNode,oe,dn,t,cn),ee()},i(e){if(!n){for(var t=0;t<a.length;t+=1)o[t].i();n=!0}},o(e){for(c=0;c<o.length;c+=1)o[c].o();n=!1},d(e){for(c=0;c<o.length;c+=1)o[c].d(e);e&&y(t)}}}function mn(t){var n;return{c(){(n=w("div")).className="loading loading-lg"},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function dn(e,t){var n,o,r=new Lt({props:{msg:t.msg}});return{key:e,first:null,c(){n=N(),r.$$.fragment.c(),this.first=n},m(e,t){v(e,n,t),ae(r,e,t),o=!0},p(e,t){var n={};e.msgs&&(n.msg=t.msg),r.$set(n)},i(e){o||(r.$$.fragment.i(e),o=!0)},o(e){r.$$.fragment.o(e),o=!1},d(e){e&&y(n),r.$destroy(e)}}}function hn(e){var t,n,o,r,a,s,c,i,l,u,m,d=e.error&&ln(e),h=[mn,un],p=[];function g(e){return e.msgs||e.error?1:0}return i=g(e),l=p[i]=h[i](e),{c(){t=w("div"),n=w("h4"),o=$("Thread\r\n    "),r=w("small"),a=$(e.msgid),s=x(),d&&d.c(),c=x(),l.c(),u=N(),r.className="label hide-sm",t.className="container"},m(e,l){v(e,t,l),b(t,n),b(n,o),b(n,r),b(r,a),v(e,s,l),d&&d.m(e,l),v(e,c,l),p[i].m(e,l),v(e,u,l),m=!0},p(e,t){m&&!e.msgid||M(a,t.msgid),t.error?d?d.p(e,t):((d=ln(t)).c(),d.m(c.parentNode,c)):d&&(d.d(1),d=null);var n=i;(i=g(t))===n?p[i].p(e,t):(Z(),te(()=>{p[n].d(1),p[n]=null}),l.o(1),ee(),(l=p[i])||(l=p[i]=h[i](t)).c(),l.i(1),l.m(u.parentNode,u))},i(e){m||(l&&l.i(),m=!0)},o(e){l&&l.o(),m=!1},d(e){e&&(y(t),y(s)),d&&d.d(e),e&&y(c),p[i].d(e),e&&y(u)}}}function pn(e,t,n){let o;i(e,oo,e=>{n("$routeParams",o=e)});let r,a=!1,s=!1;return e.$$.update=((e={$routeParams:1,msgid:1})=>{if(e.$routeParams||e.msgid){n("msgid",r=o.thread),r.startsWith("ssb:")&&n("msgid",r=r.replace("ssb:","")),document.title=`Patchfox - Thread: ${r}`;ssb.thread(r).then(e=>{n("msgs",a=e),window.scrollTo(0,0)}).catch(e=>{console.dir(e),n("error",s=e.message)})}}),{msgs:a,error:s,msgid:r}}function gn(e,t,n){const o=Object.create(e);return o.msg=t[n],o}function fn(t){var n,o,r,a=t.n.message;return{c(){n=w("p"),o=$("Error: "),r=$(a)},m(e,t){v(e,n,t),b(n,o),b(n,r)},p:e,i:e,o:e,d(e){e&&y(n)}}}function bn(e){var t,o,r,a,s,c,i,l,u,m,d,h,p,g,f,k,N,C,_,T=e.ssb.markdown(e.description),P=e.feed!==e.ssb.feed&&vn(e);let R={ctx:e,current:null,pending:$n,then:kn,catch:yn,value:"data",error:"n",blocks:Array(3)};return ne(C=e.messagePromise,R),{c(){t=w("div"),o=w("div"),r=w("div"),a=w("img"),c=x(),i=w("div"),l=w("h1"),u=$(e.name),m=x(),d=w("pre"),h=$(e.feed),p=x(),P&&P.c(),g=x(),f=w("p"),k=x(),N=w("div"),R.block.c(),a.className="img-responsive",a.src=s="http://localhost:8989/blobs/get/"+e.image,a.alt=e.feed,r.className="container",o.className="column col-6",i.className="column col-6",t.className="columns"},m(e,n){v(e,t,n),b(t,o),b(o,r),b(r,a),b(t,c),b(t,i),b(i,l),b(l,u),b(i,m),b(i,d),b(d,h),b(i,p),P&&P.m(i,null),b(i,g),b(i,f),f.innerHTML=T,v(e,k,n),v(e,N,n),R.block.m(N,R.anchor=null),R.mount=(()=>N),R.anchor=null,_=!0},p(t,o){e=o,_&&!t.image||s===(s="http://localhost:8989/blobs/get/"+e.image)||(a.src=s),_&&!t.feed||(a.alt=e.feed),_&&!t.name||M(u,e.name),_&&!t.feed||M(h,e.feed),e.feed!==e.ssb.feed?P?P.p(t,e):((P=vn(e)).c(),P.m(i,g)):P&&(P.d(1),P=null),_&&!t.description||T===(T=e.ssb.markdown(e.description))||(f.innerHTML=T),R.ctx=e,"messagePromise"in t&&C!==(C=e.messagePromise)&&ne(C,R)||R.block.p(t,n(n({},e),R.resolved))},i(e){_||(R.block.i(),_=!0)},o(e){for(let e=0;e<3;e+=1){const t=R.blocks[e];t&&t.o()}_=!1},d(e){e&&y(t),P&&P.d(),e&&(y(k),y(N)),R.block.d(),R=null}}}function vn(e){var t,n,o,r,s,c,i,l,u,m,d,h,p,g,f,k,N,_;return{c(){t=w("div"),n=w("div"),o=x(),r=w("div"),s=w("label"),c=w("input"),i=x(),l=w("i"),u=$("\r\n                following"),m=x(),d=w("label"),h=w("input"),p=x(),g=w("i"),f=$("\r\n                blocking"),k=x(),N=w("div"),n.className="divider",P(c,"type","checkbox"),l.className="form-icon",s.className="form-switch form-inline",P(h,"type","checkbox"),g.className="form-icon",d.className="form-switch form-inline",r.className="form-group",N.className="divider",t.className="container",_=[C(c,"change",e.input0_change_handler),C(c,"change",e.followingChanged),C(h,"change",e.input1_change_handler),C(h,"change",e.blockingChanged)]},m(a,y){v(a,t,y),b(t,n),b(t,o),b(t,r),b(r,s),b(s,c),c.checked=e.following,b(s,i),b(s,l),b(s,u),b(r,m),b(r,d),b(d,h),h.checked=e.blocking,b(d,p),b(d,g),b(d,f),b(t,k),b(t,N)},p(e,t){e.following&&(c.checked=t.following),e.blocking&&(h.checked=t.blocking)},d(e){e&&y(t),a(_)}}}function yn(t){var n,o,r,a=t.n.message;return{c(){n=w("p"),o=$("Error fetching messages: "),r=$(a)},m(e,t){v(e,n,t),b(n,o),b(n,r)},p(e,t){e.messagePromise&&a!==(a=t.n.message)&&M(r,a)},i:e,o:e,d(e){e&&y(n)}}}function kn(e){var t,n,o,r,a,s,c=[],i=new Map,l=e.lastMsgs;const u=e=>e.msg.key;for(var m=0;m<l.length;m+=1){let t=gn(e,l,m),n=u(t);i.set(n,c[m]=wn(n,t))}return{c(){for(m=0;m<c.length;m+=1)c[m].c();t=x(),n=w("ul"),o=w("li"),(r=w("a")).innerHTML='<div class="page-item-subtitle">Load More</div>',r.href="#/public",o.className="page-item page-next",n.className="pagination",s=C(r,"click",T(_(e.click_handler)))},m(e,s){for(m=0;m<c.length;m+=1)c[m].m(e,s);v(e,t,s),v(e,n,s),b(n,o),b(o,r),a=!0},p(e,n){const o=n.lastMsgs;Z(),c=re(c,e,u,1,n,o,i,t.parentNode,oe,wn,t,gn),ee()},i(e){if(!a){for(var t=0;t<l.length;t+=1)c[t].i();a=!0}},o(e){for(m=0;m<c.length;m+=1)c[m].o();a=!1},d(e){for(m=0;m<c.length;m+=1)c[m].d(e);e&&(y(t),y(n)),s()}}}function wn(e,t){var n,o,r=new Lt({props:{msg:t.msg}});return{key:e,first:null,c(){n=N(),r.$$.fragment.c(),this.first=n},m(e,t){v(e,n,t),ae(r,e,t),o=!0},p(e,t){var n={};e.lastMsgs&&(n.msg=t.msg),r.$set(n)},i(e){o||(r.$$.fragment.i(e),o=!0)},o(e){r.$$.fragment.o(e),o=!1},d(e){e&&y(n),r.$destroy(e)}}}function $n(t){var n;return{c(){(n=w("div")).className="loading"},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function xn(t){var n;return{c(){(n=w("div")).className="loading loading-lg"},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Nn(e){var t,o,r;let a={ctx:e,current:null,pending:xn,then:bn,catch:fn,value:"null",error:"n",blocks:Array(3)};return ne(o=e.aboutPromise&&e.avatarPromise,a),{c(){t=w("div"),a.block.c(),t.className="container"},m(e,n){v(e,t,n),a.block.m(t,a.anchor=null),a.mount=(()=>t),a.anchor=null,r=!0},p(t,r){e=r,a.ctx=e,o!==(o=e.aboutPromise&&e.avatarPromise)&&ne(o,a)||a.block.p(t,n(n({},e),a.resolved))},i(e){r||(a.block.i(),r=!0)},o(e){for(let e=0;e<3;e+=1){const t=a.blocks[e];t&&t.o()}r=!1},d(e){e&&y(t),a.block.d(),a=null}}}function Cn(e,t,n){let o;i(e,oo,e=>{n("$routeParams",o=e)});let r,a,s,c=!1,l=!1,u=!1,m=[];n("feed",a=o.feed),a||n("feed",a=ssb.feed);let d=a;document.title=`Patchfox - Feed: ${a}`,console.log("fetching",a);let h=ssb.avatar(a).then(e=>{n("name",d=e.name),n("image",r=e.image),document.title=`Patchfox - Feed: ${d}`}),p=ssb.profile(a).then(e=>{s=e.about.reverse().find(e=>{return e.value.content.hasOwnProperty("description")});try{n("description",c=s.value.content.description)}catch(e){n("description",c="")}window.scrollTo(0,0)}),g=ssb.query({value:{author:a}},10).then(e=>{n("lastMsgs",m=e),window.scrollTo(0,0)});a!==ssb.feed&&(ssb.following(a).then(e=>{const t=l=e;return n("following",l),t}),ssb.blocking(a).then(e=>{const t=u=e;return n("blocking",u),t}));const f=e=>{n("messagePromise",g=ssb.query({value:{author:a,timestamp:{$lt:e}}},10).then(e=>{n("lastMsgs",m=e),window.scrollTo(0,0)}))};return{description:c,following:l,blocking:u,image:r,feed:a,lastMsgs:m,name:d,avatarPromise:h,aboutPromise:p,messagePromise:g,blockingChanged:e=>{e.target.checked?ssb.block(a).catch(()=>{const e=u=!1;return n("blocking",u),e}):ssb.unblock(a).catch(()=>{const e=u=!0;return n("blocking",u),e})},followingChanged:e=>{e.target.checked?ssb.follow(a).catch(()=>{const e=l=!1;return n("following",l),e}):ssb.unfollow(a).catch(()=>{const e=l=!0;return n("following",l),e})},loadMoreMessages:f,ssb:ssb,input0_change_handler:function(){l=this.checked,n("following",l)},input1_change_handler:function(){u=this.checked,n("blocking",u)},click_handler:function(){f(m[m.length-1].timestamp)}}}function _n(e){var t,n,o;return{c(){t=w("div"),n=$(e.msg),t.className=o="toast "+e.toastClass},m(e,o){v(e,t,o),b(t,n)},p(e,r){e.msg&&M(n,r.msg),e.toastClass&&o!==(o="toast "+r.toastClass)&&(t.className=o)},d(e){e&&y(t)}}}function Tn(e){var t,n,o,r,a=e.cta.label;return{c(){t=w("li"),n=w("a"),o=$(a),n.href="#",r=C(n,"click",T(_(e.cta.action)))},m(e,r){v(e,t,r),b(t,n),b(n,o)},p(e,t){e.cta&&a!==(a=t.cta.label)&&M(o,a)},d(e){e&&y(t),r()}}}function Pn(t){var n,o,r,a,s,c,i,l,u,m,d,h,p,g,f,k,N,C=t.toast&&_n(t),_=t.cta&&Tn(t);return{c(){n=w("div"),(o=w("h1")).textContent="ðŸ˜¿ An Error Has Occurred, sorry ðŸ˜­",r=x(),C&&C.c(),a=x(),(s=w("h4")).textContent="This is what we know about it",c=x(),i=w("pre"),l=w("code"),u=$(t.error),m=x(),(d=w("p")).textContent="You might want to:",h=x(),p=w("ul"),_&&_.c(),g=x(),(f=w("li")).innerHTML='<a href="/docs/index.html#/troubleshooting/" target="_blank">\n\t\t\t        Open our troubleshooting documentation.\n\t\t\t      </a>',k=x(),(N=w("li")).innerHTML='<a href="https://github.com/soapdog/patchfox/issues" target="_blank">\n\t\t\t        Add an issue\n\t\t\t      </a>\n\t\t\t      to the Patchfox repository.\n\t\t\t    ',i.className="code",n.className="container"},m(e,t){v(e,n,t),b(n,o),b(n,r),C&&C.m(n,null),b(n,a),b(n,s),b(n,c),b(n,i),b(i,l),b(l,u),b(n,m),b(n,d),b(n,h),b(n,p),_&&_.m(p,null),b(p,g),b(p,f),b(p,k),b(p,N)},p(e,t){t.toast?C?C.p(e,t):((C=_n(t)).c(),C.m(n,a)):C&&(C.d(1),C=null),e.error&&M(u,t.error),t.cta?_?_.p(e,t):((_=Tn(t)).c(),_.m(p,g)):_&&(_.d(1),_=null)},i:e,o:e,d(e){e&&y(n),C&&C.d(),_&&_.d()}}}function Mn(e,t,n){let o;i(e,oo,e=>{n("$routeParams",o=e)}),document.title="Patchfox - Error";let r,a=o.error,s={},c="",l=!1,u=!1;console.dir(a),"object"==typeof a&&n("error",a=(s=a).message);let m={"Error: stream is closed":{label:"Want to try to reconnect?",action:()=>{n("toast",l=!0),n("toastClass",c="toast-warning"),n("msg",r="Attempting to reconnect to sbot..."),lo().then(()=>{n("toastClass",c="toast-success"),n("toast",l=!0),n("msg",r="Connection to sbot reestablished. Try going to your public feed.")}).catch(e=>{n("toastClass",c="toast-error"),n("toast",l=!0),n("msg",r="Couldn't reconnect. Try reloading the page.")})}}};return m.hasOwnProperty(a)&&n("cta",u=m[a]),{error:a,toastClass:c,toast:l,msg:r,cta:u}}function Rn(e,t,n){const o=Object.create(e);return o.c=t[n],o}function Sn(e){for(var t,n=e.subscribedChannels,o=[],r=0;r<n.length;r+=1)o[r]=Un(Rn(e,n,r));return{c(){for(var e=0;e<o.length;e+=1)o[e].c();t=N()},m(e,n){for(var r=0;r<o.length;r+=1)o[r].m(e,n);v(e,t,n)},p(e,r){if(e.subscribedChannels){n=r.subscribedChannels;for(var a=0;a<n.length;a+=1){const s=Rn(r,n,a);o[a]?o[a].p(e,s):(o[a]=Un(s),o[a].c(),o[a].m(t.parentNode,t))}for(;a<o.length;a+=1)o[a].d(1);o.length=n.length}},d(e){!function(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}(o,e),e&&y(t)}}}function In(t){var n,o,r;return{c(){n=w("div"),o=x(),(r=w("p")).textContent="This is a complex query, it might take a while... Channels will appear as we find them",n.className="loading"},m(e,t){v(e,n,t),v(e,o,t),v(e,r,t)},p:e,d(e){e&&(y(n),y(o),y(r))}}}function Un(e){var t,n,o,r,a,s=e.c;function c(){return e.click_handler(e)}return{c(){t=w("span"),n=$("#"),o=$(s),r=x(),t.className="channel label label-secondary m-1 svelte-1or0a5q",a=C(t,"click",c)},m(e,a){v(e,t,a),b(t,n),b(t,o),b(t,r)},p(t,n){e=n,t.subscribedChannels&&s!==(s=e.c)&&M(o,s)},d(e){e&&y(t),a()}}}function Ln(t){var n,o,r;function a(e){return 0==e.subscribedChannels.length?In:Sn}var s=a(t),c=s(t);return{c(){(n=w("h4")).textContent="Subscribed Channels",o=x(),c.c(),r=N()},m(e,t){v(e,n,t),v(e,o,t),c.m(e,t),v(e,r,t)},p(e,t){s===(s=a(t))&&c?c.p(e,t):(c.d(1),(c=s(t))&&(c.c(),c.m(r.parentNode,r)))},i:e,o:e,d(e){e&&(y(n),y(o)),c.d(e),e&&y(r)}}}function On(e,t,n){let o=[],r=hermiebox.modules.pullStream,a=hermiebox.sbot;return(()=>{let e={$filter:{value:{author:a.id,content:{type:"channel"}}},$sort:[["value","timestamp"]]};r(a.query.read({query:[e],live:!0,reverse:!0,limit:500}),r.drain(e=>{e.sync?console.log("finished loading"):e.value.content.subscribed&&(o.push(e.value.content.channel),n("subscribedChannels",o))}))})(),{subscribedChannels:o,click_handler:function({c:e}){return ao("/channel",{channel:e})}}}function An(e,t,n){const o=Object.create(e);return o.msg=t[n],o}function Fn(t){var n,o,r;return{c(){n=w("div"),o=$("Error: "),r=$(t.error),n.className="toast toast-error"},m(e,t){v(e,n,t),b(n,o),b(n,r)},p:e,d(e){e&&y(n)}}}function En(e){var t,n,o,r,s,c,i,l,u,m=[],d=new Map,h=e.msgs;const p=e=>e.msg.key;for(var g=0;g<h.length;g+=1){let t=An(e,h,g),n=p(t);d.set(n,m[g]=Bn(n,t))}var f=null;return h.length||(f=jn(e)).c(),{c(){for(g=0;g<m.length;g+=1)m[g].c();t=x(),n=w("ul"),o=w("li"),(r=w("a")).innerHTML='<div class="page-item-subtitle">Previous</div>',s=x(),c=w("li"),(i=w("a")).innerHTML='<div class="page-item-subtitle">Next</div>',r.href="#/public",o.className="page-item page-previous",i.href="#/public",c.className="page-item page-next",n.className="pagination",u=[C(r,"click",T(_(e.goPrevious))),C(i,"click",T(_(e.goNext)))]},m(e,a){for(g=0;g<m.length;g+=1)m[g].m(e,a);f&&f.m(e,null),v(e,t,a),v(e,n,a),b(n,o),b(o,r),b(n,s),b(n,c),b(c,i),l=!0},p(e,n){const o=n.msgs;Z(),m=re(m,e,p,1,n,o,d,t.parentNode,oe,Bn,t,An),ee(),o.length?f&&(f.d(1),f=null):f||((f=jn(n)).c(),f.m(t.parentNode,t))},i(e){if(!l){for(var t=0;t<h.length;t+=1)m[t].i();l=!0}},o(e){for(g=0;g<m.length;g+=1)m[g].o();l=!1},d(e){for(g=0;g<m.length;g+=1)m[g].d(e);f&&f.d(e),e&&(y(t),y(n)),a(u)}}}function Hn(t){var n;return{c(){(n=w("div")).className="loading loading-lg"},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function jn(e){var t;return{c(){(t=w("p")).textContent="No messages."},m(e,n){v(e,t,n)},d(e){e&&y(t)}}}function Bn(e,t){var n,o,r=new Lt({props:{msg:t.msg}});return{key:e,first:null,c(){n=N(),r.$$.fragment.c(),this.first=n},m(e,t){v(e,n,t),ae(r,e,t),o=!0},p(e,t){var n={};e.msgs&&(n.msg=t.msg),r.$set(n)},i(e){o||(r.$$.fragment.i(e),o=!0)},o(e){r.$$.fragment.o(e),o=!1},d(e){e&&y(n),r.$destroy(e)}}}function qn(e){var t,n,o,r,s,c,i,l,u,m,d,h,p,g,f,k,_,T,M,R=e.error&&Fn(e),S=[Hn,En],I=[];function U(e){return e.msgs?1:0}return f=U(e),k=I[f]=S[f](e),{c(){t=w("div"),n=w("div"),o=w("h4"),r=$("Channel: #"),s=$(e.channel),c=x(),i=w("div"),l=w("label"),u=w("input"),m=x(),d=w("i"),h=$("\r\n        Subscribe"),p=x(),R&&R.c(),g=x(),k.c(),_=N(),o.className="column",P(u,"type","checkbox"),d.className="form-icon",l.className="form-switch float-right",i.className="column",n.className="columns",t.className="container",M=[C(u,"change",e.input_change_handler),C(u,"change",e.subscriptionChanged)]},m(a,y){v(a,t,y),b(t,n),b(n,o),b(o,r),b(o,s),b(n,c),b(n,i),b(i,l),b(l,u),u.checked=e.subscribed,b(l,m),b(l,d),b(l,h),v(a,p,y),R&&R.m(a,y),v(a,g,y),I[f].m(a,y),v(a,_,y),T=!0},p(e,t){e.subscribed&&(u.checked=t.subscribed),t.error?R?R.p(e,t):((R=Fn(t)).c(),R.m(g.parentNode,g)):R&&(R.d(1),R=null);var n=f;(f=U(t))===n?I[f].p(e,t):(Z(),te(()=>{I[n].d(1),I[n]=null}),k.o(1),ee(),(k=I[f])||(k=I[f]=S[f](t)).c(),k.i(1),k.m(_.parentNode,_))},i(e){T||(k&&k.i(),T=!0)},o(e){k&&k.o(),T=!1},d(e){e&&(y(t),y(p)),R&&R.d(e),e&&y(g),I[f].d(e),e&&y(_),a(M)}}}function Dn(e,t,n){let o;i(e,oo,e=>{n("$routeParams",o=e)});let r=!1,a=o.error||!1,s=o.channel||!1,c=!1;s||(console.log("can't navigate to unnamed channel, going back to public"),location="index.html#/public");let l={limit:o.limit||mo("limit",10),reverse:!0};ssb.channelSubscribed(s).then(e=>{const t=c=e;return n("subscribed",c),t});const u=()=>{ao("/channel",{channel:s,lt:r[r.length-1].rts})},m=()=>{history.back()};let d=keymage("p",()=>(m(),!1)),h=keymage("n",()=>(u(),!1));return H(()=>{d(),h()}),e.$$.update=((e={opts:1,$routeParams:1,channel:1,error:1})=>{if(e.opts||e.$routeParams||e.channel||e.error){Object.assign(l,o),document.title=`Patchfox - #${s}`,l.hasOwnProperty("lt")&&(l.lt=parseInt(l.lt),n("opts",l),n("$routeParams",o),n("channel",s),n("error",a)),l.hasOwnProperty("limit")&&(l.limit=parseInt(l.limit),n("opts",l),n("$routeParams",o),n("channel",s),n("error",a));ssb.channel(s,l).then(e=>{console.log("msg",e),n("msgs",r=e),window.scrollTo(0,0)}).catch(e=>{a||console.error("errrrooooor",e)})}}),{msgs:r,error:a,channel:s,subscribed:c,subscriptionChanged:e=>{e.target.checked?ssb.channelSubscribe(s).catch(()=>{const e=c=!1;return n("subscribed",c),e}):ssb.channelUnsubscribe(s).catch(()=>{const e=c=!0;return n("subscribed",c),e})},goNext:u,goPrevious:m,input_change_handler:function(){c=this.checked,n("subscribed",c)}}}function zn(t){var n,o,r,s,c,i,l,u,m,d,h,p,g,f,k,N,_,T,M,R,S,I,U,L,O,A,F,E,H,j,B,q,D,z,Y,V,W,J,K,G,Q,X,Z,ee,te,ne,oe,re,ae,se,ce,ie,le,ue,me,de,he,pe,ge,fe,be,ve,ye,ke,we,$e,xe,Ne,Ce,_e,Te,Pe,Me,Re,Se,Ie,Ue,Le,Oe,Ae,Fe,Ee,He,je,Be,qe,De,ze,Ye,Ve,We,Je,Ke,Ge,Qe,Xe,Ze,et,tt,nt,ot,rt,at,st,ct,it,lt,ut,mt,dt,ht,pt,gt,ft,bt,vt,yt,kt,wt,$t,xt,Nt,Ct,_t,Tt,Pt,Mt,Rt,St,It,Ut,Lt;return{c(){(n=w("h1")).textContent="Settings",o=x(),(r=w("p")).innerHTML="\n\t\t\t  Settings changes are saved as you make them except for identity and connection\n\t\t\t  changes, those require a full page reload and thus you need to press a save\n\t\t\t  button. The reason behind this is that Patchfox needs to disconnect and\n\t\t\t  reconnect to the\n\t\t\t  <i>ssb-server</i>\n\t\t\t  using the new info.\n\t\t\t",s=x(),(c=w("p")).innerHTML='<b>\n\t\t\t    You can\'t use Patchfox until you fill your\n\t\t\t    <i>Connection &amp; Identity</i>\n\t\t\t    information.\n\t\t\t    <a href="/docs/index.html#/troubleshooting/no-configuration" target="_blank">\n\t\t\t      If you want more help regarding connection and configuration click here\n\t\t\t    </a>\n\t\t\t    .\n\t\t\t  </b>',i=x(),(l=w("h4")).textContent="Connection & Identity",u=x(),m=w("form"),(d=w("label")).innerHTML="\n\t\t\t    Patchfox can infer the values for both\n\t\t\t    <i>remote</i>\n\t\t\t    and\n\t\t\t    <i>secret</i>\n\t\t\t    from your\n\t\t\t    <code>~/.ssb/secret</code>\n\t\t\t    file. You can use the button below to browse for it.\n\t\t\t  ",h=x(),p=w("input"),g=x(),(f=w("label")).textContent="Remote",k=x(),N=w("input"),_=x(),(T=w("label")).textContent="Secret",M=x(),R=w("textarea"),S=x(),I=w("br"),U=x(),(L=w("button")).textContent="Save Identity & Remote",O=x(),(A=w("p")).textContent="Saving identity and remote will cause a full page refresh.",F=x(),(E=w("h4")).textContent="Vieweing Experience",H=x(),j=w("form"),(B=w("label")).textContent="Messages per page",q=x(),D=w("input"),z=x(),Y=w("br"),V=x(),(W=w("span")).innerHTML='\n\t\t\t    Which message types you want to see?\n\t\t\t    <a target="_blank" href="/docs/index.html#/message_types/">\n\t\t\t      Click here for more information about\n\t\t\t      <i>Message Types</i></a>',J=x(),K=w("label"),G=w("input"),Q=x(),X=w("i"),Z=x(),(ee=w("b")).textContent="About",te=$("\r\n    (aka people setting avatars and descriptions; gatherings)"),ne=x(),oe=w("label"),re=w("input"),ae=x(),se=w("i"),ce=x(),(ie=w("b")).textContent="Blog",le=$("\r\n    (Longform text posts)"),ue=x(),me=w("label"),de=w("input"),he=x(),pe=w("i"),ge=x(),(fe=w("b")).textContent="Channel",be=$("\r\n    (People subscribing to channels)"),ve=x(),ye=w("label"),ke=w("input"),we=x(),$e=w("i"),xe=x(),(Ne=w("b")).textContent="Contact",Ce=$("\r\n    (People following each other)"),_e=x(),Te=w("label"),Pe=w("input"),Me=x(),Re=w("i"),Se=x(),(Ie=w("b")).textContent="Posts",Ue=$("\r\n    (Common content post, leave this on or it is not that fun)"),Le=x(),Oe=w("label"),Ae=w("input"),Fe=x(),Ee=w("i"),He=x(),(je=w("b")).textContent="Pub",Be=$("\r\n    (Pub servers announcements)"),qe=x(),De=w("label"),ze=w("input"),Ye=x(),Ve=w("i"),We=x(),(Je=w("b")).textContent="Private",Ke=$("\r\n    (Private messages; You won't be able to read them, but you'll see their\r\n    encrypted content passing by)"),Ge=x(),Qe=w("label"),Xe=w("input"),Ze=x(),et=w("i"),tt=x(),(nt=w("b")).textContent="Vote",ot=$("\r\n    (People liking/digging stuff)"),rt=x(),at=w("div"),st=x(),ct=w("label"),it=w("input"),lt=x(),ut=w("i"),mt=x(),(dt=w("b")).textContent="Unknown",ht=$("\r\n    (Show messages Patchfox doesn't understand as their raw content)"),pt=x(),gt=w("br"),ft=x(),(bt=w("label")).textContent="Feed column size. There is research that says that a short column size makes\r\n    for a more pleasant reading experience, still some users prefer to use the\r\n    full screen space. Your choice is between reading through long text lines or\r\n    short ones.",vt=x(),yt=w("label"),kt=w("input"),wt=x(),$t=w("i"),xt=$("\r\n    Short column"),Nt=x(),Ct=w("label"),_t=w("input"),Tt=x(),Pt=w("i"),Mt=$("\r\n    Long column"),Rt=x(),St=w("br"),It=x(),Ut=w("br"),d.className="form-label",d.htmlFor="secret-file",P(p,"type","file"),p.className="form-input",p.id="secret-file",f.className="form-label",f.htmlFor="remote",N.className="form-input",P(N,"type","text"),N.id="remote",N.placeholder="remote",T.className="form-label",T.htmlFor="secret",R.className="form-input",R.id="secret",R.placeholder="Your secret",R.rows="8",L.className="btn btn-primary float-right",m.className="form-group",B.className="form-label",B.htmlFor="limit",D.className="form-input",P(D,"type","number"),P(G,"type","checkbox"),X.className="form-icon",K.className="form-switch",P(re,"type","checkbox"),se.className="form-icon",oe.className="form-switch",P(de,"type","checkbox"),pe.className="form-icon",me.className="form-switch",P(ke,"type","checkbox"),$e.className="form-icon",ye.className="form-switch",P(Pe,"type","checkbox"),Re.className="form-icon",Te.className="form-switch",P(Ae,"type","checkbox"),Ee.className="form-icon",Oe.className="form-switch",P(ze,"type","checkbox"),Ve.className="form-icon",De.className="form-switch",P(Xe,"type","checkbox"),et.className="form-icon",Qe.className="form-switch",at.className="divider",P(it,"type","checkbox"),ut.className="form-icon",ct.className="form-switch",bt.className="form-label",t.$$binding_groups[0].push(kt),P(kt,"type","radio"),kt.name="column-size",kt.__value="short",kt.value=kt.__value,$t.className="form-icon",yt.className="form-radio",t.$$binding_groups[0].push(_t),P(_t,"type","radio"),_t.name="column-size",_t.__value="long",_t.value=_t.__value,Pt.className="form-icon",Ct.className="form-radio",j.className="form-group",Lt=[C(p,"change",t.selectedFile),C(N,"input",t.input1_input_handler),C(R,"input",t.textarea_input_handler),C(L,"click",t.saveConfiguration),C(D,"input",t.input2_input_handler),C(D,"change",t.change_handler),C(G,"change",t.input3_change_handler),C(G,"change",t.change_handler_1),C(re,"change",t.input4_change_handler),C(re,"change",t.change_handler_2),C(de,"change",t.input5_change_handler),C(de,"change",t.change_handler_3),C(ke,"change",t.input6_change_handler),C(ke,"change",t.change_handler_4),C(Pe,"change",t.input7_change_handler),C(Pe,"change",t.change_handler_5),C(Ae,"change",t.input8_change_handler),C(Ae,"change",t.change_handler_6),C(ze,"change",t.input9_change_handler),C(ze,"change",t.change_handler_7),C(Xe,"change",t.input10_change_handler),C(Xe,"change",t.change_handler_8),C(it,"change",t.input11_change_handler),C(it,"change",t.change_handler_9),C(kt,"change",t.input12_change_handler),C(kt,"change",t.change_handler_10),C(_t,"change",t.input13_change_handler),C(_t,"change",t.change_handler_11)]},m(e,a){v(e,n,a),v(e,o,a),v(e,r,a),v(e,s,a),v(e,c,a),v(e,i,a),v(e,l,a),v(e,u,a),v(e,m,a),b(m,d),b(m,h),b(m,p),b(m,g),b(m,f),b(m,k),b(m,N),N.value=t.remote,b(m,_),b(m,T),b(m,M),b(m,R),R.value=t.keys,b(m,S),b(m,I),b(m,U),b(m,L),b(m,O),b(m,A),v(e,F,a),v(e,E,a),v(e,H,a),v(e,j,a),b(j,B),b(j,q),b(j,D),D.value=t.limit,b(j,z),b(j,Y),b(j,V),b(j,W),b(j,J),b(j,K),b(K,G),G.checked=t.showTypeAbout,b(K,Q),b(K,X),b(K,Z),b(K,ee),b(K,te),b(j,ne),b(j,oe),b(oe,re),re.checked=t.showTypeBlog,b(oe,ae),b(oe,se),b(oe,ce),b(oe,ie),b(oe,le),b(j,ue),b(j,me),b(me,de),de.checked=t.showTypeChannel,b(me,he),b(me,pe),b(me,ge),b(me,fe),b(me,be),b(j,ve),b(j,ye),b(ye,ke),ke.checked=t.showTypeContact,b(ye,we),b(ye,$e),b(ye,xe),b(ye,Ne),b(ye,Ce),b(j,_e),b(j,Te),b(Te,Pe),Pe.checked=t.showTypePost,b(Te,Me),b(Te,Re),b(Te,Se),b(Te,Ie),b(Te,Ue),b(j,Le),b(j,Oe),b(Oe,Ae),Ae.checked=t.showTypePub,b(Oe,Fe),b(Oe,Ee),b(Oe,He),b(Oe,je),b(Oe,Be),b(j,qe),b(j,De),b(De,ze),ze.checked=t.showTypePrivate,b(De,Ye),b(De,Ve),b(De,We),b(De,Je),b(De,Ke),b(j,Ge),b(j,Qe),b(Qe,Xe),Xe.checked=t.showTypeVote,b(Qe,Ze),b(Qe,et),b(Qe,tt),b(Qe,nt),b(Qe,ot),b(j,rt),b(j,at),b(j,st),b(j,ct),b(ct,it),it.checked=t.showTypeUnknown,b(ct,lt),b(ct,ut),b(ct,mt),b(ct,dt),b(ct,ht),b(j,pt),b(j,gt),b(j,ft),b(j,bt),b(j,vt),b(j,yt),b(yt,kt),kt.checked=kt.__value===t.columnSize,b(yt,wt),b(yt,$t),b(yt,xt),b(j,Nt),b(j,Ct),b(Ct,_t),_t.checked=_t.__value===t.columnSize,b(Ct,Tt),b(Ct,Pt),b(Ct,Mt),v(e,Rt,a),v(e,St,a),v(e,It,a),v(e,Ut,a)},p(e,t){e.remote&&N.value!==t.remote&&(N.value=t.remote),e.keys&&(R.value=t.keys),e.limit&&(D.value=t.limit),e.showTypeAbout&&(G.checked=t.showTypeAbout),e.showTypeBlog&&(re.checked=t.showTypeBlog),e.showTypeChannel&&(de.checked=t.showTypeChannel),e.showTypeContact&&(ke.checked=t.showTypeContact),e.showTypePost&&(Pe.checked=t.showTypePost),e.showTypePub&&(Ae.checked=t.showTypePub),e.showTypePrivate&&(ze.checked=t.showTypePrivate),e.showTypeVote&&(Xe.checked=t.showTypeVote),e.showTypeUnknown&&(it.checked=t.showTypeUnknown),e.columnSize&&(kt.checked=kt.__value===t.columnSize),e.columnSize&&(_t.checked=_t.__value===t.columnSize)},i:e,o:e,d(e){e&&(y(n),y(o),y(r),y(s),y(c),y(i),y(l),y(u),y(m),y(F),y(E),y(H),y(j)),t.$$binding_groups[0].splice(t.$$binding_groups[0].indexOf(kt),1),t.$$binding_groups[0].splice(t.$$binding_groups[0].indexOf(_t),1),e&&(y(Rt),y(St),y(It),y(Ut)),a(Lt)}}}function Yn(e,t,n){let o={},r="",a=mo("limit",10),s=mo("columnSize","short");document.title="Patchfox - Settings";let c=mo("showTypeUnknown",!1),i=mo("showTypeAbout",!0),l=mo("showTypeBlog",!0),u=mo("showTypeChannel",!0),m=mo("showTypeContact",!0),d=mo("showTypePost",!0),h=mo("showTypePrivate",!0),p=mo("showTypePub",!0),g=mo("showTypeVote",!0);const f=e=>{console.log("saved data from settings",e),n("remote",r=e.remote||""),e.keys?n("keys",o=JSON.stringify(e.keys,null,2)):n("keys",o="")};browser.storage.local.get().then(f,e=>{console.error("error on settings",e)});return{keys:o,remote:r,limit:a,columnSize:s,showTypeUnknown:c,showTypeAbout:i,showTypeBlog:l,showTypeChannel:u,showTypeContact:m,showTypePost:d,showTypePrivate:h,showTypePub:p,showTypeVote:g,saveConfiguration:e=>{ho({remote:r,keys:JSON.parse(o),manifest:manifest}),ao("/public"),location.reload()},selectedFile:e=>{const t=e.target.files[0],o=new FileReader;o.onload=function(e){console.log(e.target.result);let t=e.target.result.split("\n").filter(function(e){return 0!=e.indexOf("#")});t=JSON.parse(t.join("\n")),n("remote",r=`ws://localhost:8989~shs:${t.id.slice(0,t.id.indexOf("=")+1)}`),f({keys:t,remote:r})},o.readAsText(t)},input1_input_handler:function(){r=this.value,n("remote",r)},textarea_input_handler:function(){o=this.value,n("keys",o)},input2_input_handler:function(){var e;e=this.value,n("limit",a=""===e?void 0:+e)},change_handler:function(){return po("limit",a)},input3_change_handler:function(){i=this.checked,n("showTypeAbout",i)},change_handler_1:function(e){po("showTypeAbout",i)},input4_change_handler:function(){l=this.checked,n("showTypeBlog",l)},change_handler_2:function(e){po("showTypeBlog",l)},input5_change_handler:function(){u=this.checked,n("showTypeChannel",u)},change_handler_3:function(e){po("showTypeChannel",u)},input6_change_handler:function(){m=this.checked,n("showTypeContact",m)},change_handler_4:function(e){po("showTypeContact",m)},input7_change_handler:function(){d=this.checked,n("showTypePost",d)},change_handler_5:function(e){po("showTypePost",d)},input8_change_handler:function(){p=this.checked,n("showTypePub",p)},change_handler_6:function(e){po("showTypePub",p)},input9_change_handler:function(){h=this.checked,n("showTypePrivate",h)},change_handler_7:function(e){po("showTypePrivate",h)},input10_change_handler:function(){g=this.checked,n("showTypeVote",g)},change_handler_8:function(e){po("showTypeVote",g)},input11_change_handler:function(){c=this.checked,n("showTypeUnknown",c)},change_handler_9:function(e){po("showTypeUnknown",c)},input12_change_handler:function(){s=this.__value,n("columnSize",s)},change_handler_10:function(){return po("columnSize",s)},input13_change_handler:function(){s=this.__value,n("columnSize",s)},change_handler_11:function(){return po("columnSize",s)},$$binding_groups:[[]]}}class Vn extends ie{constructor(e){super(),ce(this,e,Yn,zn,c,[])}}function Wn(e,t,n){const o=Object.create(e);return o.msg=t[n],o}function Jn(e){var t,n,o,r,s,c,i,l,u,m=[],d=new Map,h=e.msgs;const p=e=>e.msg.key;for(var g=0;g<h.length;g+=1){let t=Wn(e,h,g),n=p(t);d.set(n,m[g]=Gn(n,t))}return{c(){for(g=0;g<m.length;g+=1)m[g].c();t=x(),n=w("ul"),o=w("li"),(r=w("a")).innerHTML='<div class="page-item-subtitle">Previous</div>',s=x(),c=w("li"),(i=w("a")).innerHTML='<div class="page-item-subtitle">Next</div>',r.href="#/public",o.className="page-item page-previous",i.href="#/public",c.className="page-item page-next",n.className="pagination",u=[C(r,"click",T(_(e.click_handler))),C(i,"click",T(_(e.click_handler_1)))]},m(e,a){for(g=0;g<m.length;g+=1)m[g].m(e,a);v(e,t,a),v(e,n,a),b(n,o),b(o,r),b(n,s),b(n,c),b(c,i),l=!0},p(e,n){const o=n.msgs;Z(),m=re(m,e,p,1,n,o,d,t.parentNode,oe,Gn,t,Wn),ee()},i(e){if(!l){for(var t=0;t<h.length;t+=1)m[t].i();l=!0}},o(e){for(g=0;g<m.length;g+=1)m[g].o();l=!1},d(e){for(g=0;g<m.length;g+=1)m[g].d(e);e&&(y(t),y(n)),a(u)}}}function Kn(t){var n;return{c(){(n=w("div")).className="loading loading-lg"},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Gn(e,t){var n,o,r=new Lt({props:{msg:t.msg}});return{key:e,first:null,c(){n=N(),r.$$.fragment.c(),this.first=n},m(e,t){v(e,n,t),ae(r,e,t),o=!0},p(e,t){var n={};e.msgs&&(n.msg=t.msg),r.$set(n)},i(e){o||(r.$$.fragment.i(e),o=!0)},o(e){r.$$.fragment.o(e),o=!1},d(e){e&&y(n),r.$destroy(e)}}}function Qn(e){var t,n,o,r,a,s,c=[Kn,Jn],i=[];function l(e){return 0===e.msgs.length?0:1}return o=l(e),r=i[o]=c[o](e),{c(){(t=w("div")).innerHTML='<div class="columns"><h4 class="column">Mentions</h4>\n\t\t\t    <div class="column"></div></div>',n=x(),r.c(),a=N(),t.className="container"},m(e,r){v(e,t,r),v(e,n,r),i[o].m(e,r),v(e,a,r),s=!0},p(e,t){var n=o;(o=l(t))===n?i[o].p(e,t):(Z(),te(()=>{i[n].d(1),i[n]=null}),r.o(1),ee(),(r=i[o])||(r=i[o]=c[o](t)).c(),r.i(1),r.m(a.parentNode,a))},i(e){s||(r&&r.i(),s=!0)},o(e){r&&r.o(),s=!1},d(e){e&&(y(t),y(n)),i[o].d(e),e&&y(a)}}}function Xn(e,t,n){let o,r=[];document.title="Patchfox - Mentions";let a=!1;hermiebox.modules.pullStream,hermiebox.sbot;return H(()=>{o()}),E(()=>{o=oo.subscribe(e=>{if(console.log("params changed.",a,e.lt),e.lt){let t=parseInt(e.lt);t!==a&&(a=t)}else a=!1;console.log("Loading mentions...",a),window.scrollTo(0,0),n("msgs",r=[]),ssb.mentions(ssb.feed,a).then(e=>{const t=r=e;return n("msgs",r),t})})}),{msgs:r,click_handler:function(){return history.back()},click_handler_1:function(){ao("/mentions",{lt:r[r.length-1].rts})}}}let Zn={};const eo=()=>{return{data:Te.parse(window.location.search),location:window.location.hash.slice(1).replace("?","")}},to=le(!1),no=le(eo()),oo=ue(no,e=>e.data),ro=ue(no,e=>e.location),ao=(e,t)=>{t=t||{},no.set({location:e,data:t});let n=Te.stringify(t);history.pushState({location:e,data:t},`Patchfox - ${e}`,`/index.html?${n}#${e}`),console.log(`Navigate ${e}`,t)},so={"/thread":class extends ie{constructor(e){super(),ce(this,e,pn,hn,c,[])}},"/public":class extends ie{constructor(e){super(),ce(this,e,Bt,jt,c,[])}},"/compose":class extends ie{constructor(e){super(),ce(this,e,sn,an,c,[])}},"/profile":class extends ie{constructor(e){super(),ce(this,e,Cn,Nn,c,[])}},"/error":class extends ie{constructor(e){super(),ce(this,e,Mn,Pn,c,[])}},"/channels":class extends ie{constructor(e){super(),ce(this,e,On,Ln,c,[])}},"/channel":class extends ie{constructor(e){super(),ce(this,e,Dn,qn,c,[])}},"/settings":Vn,"/mentions":class extends ie{constructor(e){super(),ce(this,e,Xn,Qn,c,[])}},"*":class extends ie{constructor(e){super(),ce(this,e,null,qt,c,[])}}},co=ue([to,no],([e,t])=>{let n=t.location;return e?so.hasOwnProperty(n)?so[n]:(console.log("didn't find",n),so["*"]):"/settings"===n?Vn:so["*"]}),io=async()=>{console.log("Connecting to sbot..."),window.ssb=new pe;try{await ssb.connect(Zn.keys),to.set(!0)}catch(e){throw console.error("can't connect",e),to.set(!1),"Can't connect to sbot"}},lo=()=>new Promise((e,t)=>{browser.storage.local.get().then(n=>{window.ssb=new DriverHermiebox,ssb.connect(n.keys).then(t=>{console.log("connected"),to.set(!0),e()}).catch(e=>{console.error("can't reconnect",e),t(e)})},t)}),uo=()=>{let e=setInterval(()=>{hermiebox.sbot&&hermiebox.sbot.whoami((t,n)=>{t&&(console.error("can't call whoami",t),lo().catch(t=>{console.error("can't reconnect"),clearInterval(e),ao("/error",{error:t})}))})},5e3)},mo=(e,t)=>{if(Zn.hasOwnProperty("preferences")){let t=Zn.preferences;if(t.hasOwnProperty(e))return t[e]}return t},ho=({keys:e,remote:t,manifest:n})=>{Zn.keys=e,Zn.remote=t,Zn.manifest=n,browser.storage.local.set(Zn)},po=(e,t)=>{console.log(`setPref - ${e}`,t),Zn.preferences=Zn.preferences||{},Zn.preferences[e]=t,browser.storage.local.set(Zn)};function go(t){var n,o,r,s,c,i,l,u,m,d,h,p,g,f,k,$,N,P,M,R,S,I,U,L,O,A,F,E,H,j,B,q,D,z,Y,V,W,J,K,G,Q,X,Z,ee,te,ne,oe,re,ae,se,ce,ie,le,ue,me,de,he,pe,ge;return{c(){n=w("header"),o=w("section"),(r=w("a")).innerHTML='<i class="icon icon-minus text-black"></i>',s=x(),c=w("a"),i=w("figure"),l=w("img"),u=x(),m=w("i"),h=x(),(p=w("a")).textContent="Compose",g=x(),(f=w("a")).textContent="Public",k=x(),($=w("a")).textContent="Mentions",N=x(),(P=w("a")).textContent="Channels",M=x(),(R=w("a")).textContent="Settings",S=x(),(I=w("a")).textContent="Help",U=x(),L=w("section"),(O=w("button")).innerHTML='<i class="icon icon-back"></i>',A=x(),F=w("a"),E=w("figure"),H=w("img"),j=x(),B=w("i"),D=x(),z=w("div"),(Y=w("a")).innerHTML='\n\t\t\t        Menu\n\t\t\t        <i class="icon icon-caret"></i>',V=x(),W=w("ul"),J=w("li"),(K=w("a")).textContent="Compose",G=x(),Q=w("li"),(X=w("a")).textContent="Public",Z=x(),ee=w("li"),(te=w("a")).textContent="Channels",ne=x(),oe=w("li"),(re=w("a")).textContent="Mentions",ae=x(),se=w("li"),(ce=w("a")).textContent="Settings",ie=x(),(le=w("li")).innerHTML='<a href="/docs/index.html" class="btn btn-link">Help</a>',ue=x(),me=w("li"),(de=w("a")).textContent="Open as a Tab",he=x(),pe=w("div"),r.href="#/sidebar",r.className="btn btn-link",l.src=t.avatar,l.alt="L",m.className=d="avatar-presence "+(t.$connected?"online":"offline")+" svelte-14egiim",i.className="avatar avatar-lg",c.href="#",c.className="navbar-brand mr-2 p-1",p.href="#/compose",p.className="btn btn-link",f.href="#/public",f.className="btn btn-link",$.href="#/mentions",$.className="btn btn-link",P.href="#/channels",P.className="btn btn-link",R.href="#/settings",R.className="btn btn-link",I.href="/docs/index.html",I.className="btn btn-link",o.className="navbar-section hide-sm",O.className="btn btn-link",H.src=t.avatar,H.alt="L",B.className=q="avatar-presence "+(t.$connected?"online":"offline")+" svelte-14egiim",E.className="avatar",F.href="...",F.className="navbar-brand mr-2 p-1",Y.href="?",Y.className="btn btn-link dropdown-toggle",Y.tabIndex="0",K.href="#/compose",K.className="btn btn-link",J.className="menu-item",X.href="#/public",X.className="btn btn-link",Q.className="menu-item",te.href="#/channels",te.className="btn btn-link",ee.className="menu-item",re.href="#/mentions",re.className="btn btn-link",oe.className="menu-item",ce.href="#/settings",ce.className="btn btn-link",se.className="menu-item",le.className="menu-item",de.href="#/sidebar",de.className="btn btn-link",me.className="menu-item",W.className="menu",z.className="dropdown float-right",L.className="navbar-section show-sm bg-gray above svelte-14egiim",pe.className="blocker show-sm svelte-14egiim",n.className="navbar",ge=[C(r,"click",t.openSidebar),C(c,"click",t.openMyProfile),C(p,"click",T(_(t.goCompose))),C(f,"click",T(_(t.goPublic))),C($,"click",T(_(t.goMentions))),C(P,"click",T(_(t.goChannels))),C(R,"click",t.goSettings),C(O,"click",t.click_handler),C(Y,"click",T(_(fo))),C(K,"click",T(_(t.goCompose))),C(X,"click",T(_(t.goPublic))),C(te,"click",T(_(t.goChannels))),C(re,"click",T(_(t.goMentions))),C(ce,"click",t.goSettings),C(de,"click",t.closeSidebar)]},m(e,t){v(e,n,t),b(n,o),b(o,r),b(o,s),b(o,c),b(c,i),b(i,l),b(i,u),b(i,m),b(o,h),b(o,p),b(o,g),b(o,f),b(o,k),b(o,$),b(o,N),b(o,P),b(o,M),b(o,R),b(o,S),b(o,I),b(n,U),b(n,L),b(L,O),b(L,A),b(L,F),b(F,E),b(E,H),b(E,j),b(E,B),b(L,D),b(L,z),b(z,Y),b(z,V),b(z,W),b(W,J),b(J,K),b(W,G),b(W,Q),b(Q,X),b(W,Z),b(W,ee),b(ee,te),b(W,ne),b(W,oe),b(oe,re),b(W,ae),b(W,se),b(se,ce),b(W,ie),b(W,le),b(W,ue),b(W,me),b(me,de),b(n,he),b(n,pe)},p(e,t){e.avatar&&(l.src=t.avatar),e.$connected&&d!==(d="avatar-presence "+(t.$connected?"online":"offline")+" svelte-14egiim")&&(m.className=d),e.avatar&&(H.src=t.avatar),e.$connected&&q!==(q="avatar-presence "+(t.$connected?"online":"offline")+" svelte-14egiim")&&(B.className=q)},i:e,o:e,d(e){e&&y(n),a(ge)}}}function fo(){return""}function bo(e,t,n){let o;i(e,to,e=>{n("$connected",o=e)});let r="/images/icon.png";return e.$$.update=((e={$connected:1})=>{e.$connected&&o&&ssb.avatar(ssb.feed).then(e=>{n("avatar",r=`http://localhost:8989/blobs/get/${e.image}`)})}),{avatar:r,goSettings:e=>ao("/settings"),goCompose:()=>ao("/compose"),goPublic:()=>ao("/public"),goChannels:()=>ao("/channels"),goMentions:()=>ao("/mentions"),openSidebar:async e=>{let t=window.location.href;browser.sidebarAction.setPanel({panel:t}),browser.sidebarAction.open()},closeSidebar:async e=>{let t=await browser.sidebarAction.getPanel({});await browser.tabs.create({url:t}),await browser.sidebarAction.close()},openMyProfile:e=>{e.stopPropagation(),e.preventDefault(),ssb.feed&&ao("/profile",{feed:ssb.feed})},$connected:o,click_handler:function(){return history.back()}}}class vo extends ie{constructor(e){super(),ce(this,e,bo,go,c,[])}}function yo(e){var t,n,o,r,s,c,i=new vo({}),l=e.$currentView;if(l)var u=new l({});return{c(){t=w("div"),n=w("div"),o=w("div"),i.$$.fragment.c(),r=x(),u&&u.$$.fragment.c(),o.className="column svelte-64hhw0",R(o,"reduced-line-length",e.useShortColumn),n.className="columns",t.className="container bg-gray",c=[C(window,"popstate",e.popState),C(window,"error",e.handleUncaughtException),C(window,"hashchange",e.hashChange)]},m(e,a){v(e,t,a),b(t,n),b(n,o),ae(i,o,null),b(o,r),u&&ae(u,o,null),s=!0},p(e,t){if(l!==(l=t.$currentView)){if(u){Z();const e=u;te(()=>{e.$destroy()}),e.$$.fragment.o(1),ee()}l?((u=new l({})).$$.fragment.c(),u.$$.fragment.i(1),ae(u,o,null)):u=null}e.useShortColumn&&R(o,"reduced-line-length",t.useShortColumn)},i(e){s||(i.$$.fragment.i(e),u&&u.$$.fragment.i(e),s=!0)},o(e){i.$$.fragment.o(e),u&&u.$$.fragment.o(e),s=!1},d(e){e&&y(t),i.$destroy(),u&&u.$destroy(),a(c)}}}function ko(e,t,n){let o,r;i(e,ro,e=>{n("$routeLocation",o=e)}),i(e,co,e=>{n("$currentView",r=e)});let a="short"==mo("columnSize","short");E(async()=>{try{await io(),uo()}catch(e){switch(console.error("connect error",e),e){case"Can't connect to sbot":"/settings"!==o&&(window.location="/docs/index.html#/troubleshooting/no-connection");break;default:ao("/error",{error:e})}}});return{useShortColumn:a,popState:e=>{if(null!==e.state){console.dir("pop",e.state);let{location:t,data:n}=e.state;no.set({location:t,data:n})}},handleUncaughtException:e=>{console.error("Uncaught exception",e),ao("/error",{error:e.message})},hashChange:e=>{console.dir("hash change",e)},$currentView:r}}class wo extends ie{constructor(e){super(),ce(this,e,ko,yo,c,[])}}(async()=>{window.ssb=!1,(()=>{let e=eo();if("/intercept"==e.location&&e.data.query){let t=e.data.query.replace("ssb:","");switch(t[0]){case"%":window.location=`/index.html?thread=${encodeURIComponent(t)}#/thread`;break;case"&":window.location=`http://localhost:8989/blobs/get/${t}`;break;case"@":window.location=`/index.html?feed=${encodeURIComponent(t)}#/profile`}}})();try{await(async()=>{console.log("Loading configuration...");try{let e=await browser.storage.local.get();if(!e.hasOwnProperty("keys"))throw"Configuration is missing";Zn=e}catch(e){throw"Configuration is missing"}})()}catch(e){switch(console.error("initialization error",e),e){case"Configuration is missing":ao("/settings");break;default:ao("/error",{error:e})}}new wo({target:document.body})})()}();
//# sourceMappingURL=bundle.js.map
