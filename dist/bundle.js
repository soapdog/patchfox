!function(){"use strict";function e(){}const t=e=>e;function n(e,t){for(const n in t)e[n]=t[n];return e}function o(e){return e()}function r(){return Object.create(null)}function a(e){e.forEach(o)}function s(e){return"function"==typeof e}function c(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function i(e,t,n){const o=t.subscribe(n);e.$$.on_destroy.push(o.unsubscribe?()=>o.unsubscribe():o)}const l="undefined"!=typeof window;let u=l?()=>window.performance.now():()=>Date.now(),m=l?requestAnimationFrame:e;const d=new Set;let h,p=!1;function g(){d.forEach(e=>{e[0](u())||(d.delete(e),e[1]())}),(p=d.size>0)&&m(g)}function f(e){let t;return p||(p=!0,m(g)),{promise:new Promise(n=>{d.add(t=[e,n])}),abort(){d.delete(t)}}}function b(e,t){e.appendChild(t)}function v(e,t,n){e.insertBefore(t,n||null)}function y(e){e.parentNode.removeChild(e)}function k(e,t){for(;e.nextSibling&&e.nextSibling!==t;)e.parentNode.removeChild(e.nextSibling)}function w(e){return document.createElement(e)}function $(e){return document.createTextNode(e)}function x(){return $(" ")}function N(){return $("")}function _(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function C(e){return function(t){return t.preventDefault(),e.call(this,t)}}function P(e){return function(t){return t.stopPropagation(),e.call(this,t)}}function T(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function M(e,t){t=""+t,e.data!==t&&(e.data=t)}function R(e,t,n){e.classList[n?"add":"remove"](t)}let S,O=0,I={};function U(e,t,n,o,r,a,s,c=0){const i=16.666/o;let l="{\n";for(let e=0;e<=1;e+=i){const o=t+(n-t)*a(e);l+=100*e+`%{${s(o,1-o)}}\n`}const u=l+`100% {${s(n,1-n)}}\n}`,m=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${c}`;if(!I[m]){if(!h){const e=w("style");document.head.appendChild(e),h=e.sheet}I[m]=!0,h.insertRule(`@keyframes ${m} ${u}`,h.cssRules.length)}const d=e.style.animation||"";return e.style.animation=`${d?`${d}, `:""}${m} ${o}ms linear ${r}ms 1 both`,O+=1,m}function L(e,t){e.style.animation=(e.style.animation||"").split(", ").filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")).join(", "),t&&!--O&&m(()=>{if(O)return;let e=h.cssRules.length;for(;e--;)h.deleteRule(e);I={}})}function F(e){S=e}function A(){if(!S)throw new Error("Function called outside component initialization");return S}function E(e){A().$$.on_mount.push(e)}function H(e){A().$$.on_destroy.push(e)}function j(){const e=S;return(t,n)=>{const o=e.$$.callbacks[t];if(o){const r=function(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}(t,n);o.slice().forEach(t=>{t.call(e,r)})}}}const B=[],q=Promise.resolve();let D=!1;const z=[],Y=[],V=[];function W(e){Y.push(e)}function J(){const e=new Set;do{for(;B.length;){const e=B.shift();F(e),K(e.$$)}for(;z.length;)z.shift()();for(;Y.length;){const t=Y.pop();e.has(t)||(t(),e.add(t))}}while(B.length);for(;V.length;)V.pop()();D=!1}function K(e){e.fragment&&(e.update(e.dirty),a(e.before_render),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_render.forEach(W))}let G,Q;function X(){return G||(G=Promise.resolve()).then(()=>{G=null}),G}function Z(){Q={remaining:0,callbacks:[]}}function ee(){Q.remaining||a(Q.callbacks)}function te(e){Q.callbacks.push(e)}function ne(e,t){const o=t.token={};function r(e,r,a,s){if(t.token!==o)return;t.resolved=a&&{[a]:s};const c=n(n({},t.ctx),t.resolved),i=e&&(t.current=e)(c);t.block&&(t.blocks?t.blocks.forEach((e,n)=>{n!==r&&e&&(Z(),te(()=>{e.d(1),t.blocks[n]=null}),e.o(1),ee())}):t.block.d(1),i.c(),i.i&&i.i(1),i.m(t.mount(),t.anchor),J()),t.block=i,t.blocks&&(t.blocks[r]=i)}if((a=e)&&"function"==typeof a.then){if(e.then(e=>{r(t.then,1,t.value,e)},e=>{r(t.catch,2,t.error,e)}),t.current!==t.pending)return r(t.pending,0),!0}else{if(t.current!==t.then)return r(t.then,1,t.value,e),!0;t.resolved={[t.value]:e}}var a}function oe(e,t){te(()=>{!function(e,t){e.d(1),t.delete(e.key)}(e,t)}),e.o(1)}function re(e,t,n,o,r,a,s,c,i,l,u,m){let d=e.length,h=a.length,p=d;const g={};for(;p--;)g[e[p].key]=p;const f=[],b=new Map,v=new Map;for(p=h;p--;){const e=m(r,a,p),c=n(e);let i=s.get(c);i?o&&i.p(t,e):(i=l(c,e)).c(),b.set(c,f[p]=i),c in g&&v.set(c,Math.abs(p-g[c]))}const y=new Set,k=new Set;function w(e){e.i&&e.i(1),e.m(c,u),s.set(e.key,e),u=e.first,h--}for(;d&&h;){const t=f[h-1],n=e[d-1],o=t.key,r=n.key;t===n?(u=t.first,d--,h--):b.has(r)?!s.has(o)||y.has(o)?w(t):k.has(r)?d--:v.get(o)>v.get(r)?(k.add(o),w(t)):(y.add(r),d--):(i(n,s),d--)}for(;d--;){const t=e[d];b.has(t.key)||i(t,s)}for(;h;)w(f[h-1]);return f}function ae(e,t,n){const{fragment:r,on_mount:c,on_destroy:i,after_render:l}=e.$$;r.m(t,n),W(()=>{const t=c.map(o).filter(s);i?i.push(...t):a(t),e.$$.on_mount=[]}),l.forEach(W)}function se(e,t){e.$$.dirty||(B.push(e),D||(D=!0,q.then(J)),e.$$.dirty=r()),e.$$.dirty[t]=!0}function ce(t,n,o,s,c,i){const l=S;F(t);const u=n.props||{},m=t.$$={fragment:null,ctx:null,props:i,update:e,not_equal:c,bound:r(),on_mount:[],on_destroy:[],before_render:[],after_render:[],context:new Map(l?l.$$.context:[]),callbacks:r(),dirty:null};let d=!1;var h;m.ctx=o?o(t,u,(e,n)=>{m.ctx&&c(m.ctx[e],m.ctx[e]=n)&&(m.bound[e]&&m.bound[e](n),d&&se(t,e))}):u,m.update(),d=!0,a(m.before_render),m.fragment=s(m.ctx),n.target&&(n.hydrate?m.fragment.l((h=n.target,Array.from(h.childNodes))):m.fragment.c(),n.intro&&t.$$.fragment.i&&t.$$.fragment.i(),ae(t,n.target,n.anchor),J()),F(l)}class ie{$destroy(){var t,n;n=!0,(t=this).$$&&(a(t.$$.on_destroy),t.$$.fragment.d(n),t.$$.on_destroy=t.$$.fragment=null,t.$$.ctx={}),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}function le(t,n=e){let o;const r=[];function a(e){if(c(t,e)){if(t=e,!o)return;r.forEach(e=>e[1]()),r.forEach(e=>e[0](t))}}return{set:a,update:function(e){a(e(t))},subscribe:function(s,c=e){const i=[s,c];return r.push(i),1===r.length&&(o=n(a)||e),s(t),()=>{const e=r.indexOf(i);-1!==e&&r.splice(e,1),0===r.length&&o()}}}}function ue(t,n,o){const r=!Array.isArray(t),c=r?[t]:t,i=n.length<2;return{subscribe:le(o,t=>{let o=!1;const l=[];let u=0,m=e;const d=()=>{if(u)return;m();const o=n(r?l[0]:l,t);i?t(o):m=s(o)?o:e},h=c.map((e,t)=>e.subscribe(e=>{l[t]=e,u&=~(1<<t),o&&d()},()=>{u|=1<<t}));return o=!0,d(),function(){a(h),m()}}).subscribe}}class me{constructor(){this.name="Driver for Hermiebox"}log(e,t=""){console.log(`[Driver Hermiebox] - ${e}`,t)}async connect(e){var t=await hermiebox.api.connect(e);this.log("you are",t.id),this.feed=t.id}async public(e){return await hermiebox.api.pullPublic(e,{})}async thread(e){return await hermiebox.api.thread(e)}async profile(e){try{return await hermiebox.api.profile(e)}catch(e){return console.error(e),!1}}async get(e){return await hermiebox.api.get(e)}async setAvatarCache(e,t){let n={};return n[`avatar-${e}`]=t,browser.storage.local.set(n)}async getCachedAvatar(e){return browser.storage.local.get(`avatar-${e}`)}async avatar(e){try{let t=await hermiebox.api.avatar(e);return await this.setAvatarCache(e,t),t}catch(e){throw e}}async blurbFromMsg(e,t){let n=e;try{let o=await ssb.get(e);return"post"==o.content.type&&(n=this.plainTextFromMarkdown(o.content.text.slice(0,t)+"...")),n}catch(e){return n}}plainTextFromMarkdown(e){let t=this.markdown(e),n=document.createElement("div");return n.innerHTML=t,n.innerText}markdown(e){let t=hermiebox.modules.ssbMarkdown.block(e);return t=t.replace("<pre>",'<pre class="code">').replace(/<a href="#([^"]*)/gi,function(e,t,n,o){return`<a class="channel-link" href="?channel=${encodeURIComponent(t)}#/channel`}).replace(/<a href="@([^"]*)/gi,function(e,t,n,o){return'<a class="profile-link" href="?feed='+encodeURIComponent(`@${t}`)+"#/profile"}).replace(/target="_blank"/gi,"").replace(/<a href="%([^"]*)/gi,function(e,t,n,o){return`<a class="thread-link" href="?thread=${encodeURIComponent(`%${t}`)}#/thread`}).replace(/<img src="&([^"]*)/gi,function(e,t,n,o){return'<img class="is-image-from-blob" src="http://localhost:8989/blobs/get/&'+encodeURIComponent(t)}).replace(/<a href="&([^"]*)/gi,function(e,t,n,o){return'<a class="image-link" target="_blank" href="http://localhost:8989/blobs/get/&'+encodeURIComponent(t)})}ref(){return hermiebox.modules.ssbRef}getTimestamp(e){const t=e.timestamp,n=e.value.timestamp;return Math.min(t,n)}getRootMsgId(e){if(e&&e.value&&e.value.content){const t=e.value.content.root;if(hermiebox.modules.ssbRef.isMsgId(t))return t}}newPost(e){return new Promise((t,n)=>{const o=hermiebox.modules.ssbMsgSchemas,r=e.text,a=e.hasOwnProperty("root")?e.root:void 0,s=e.hasOwnProperty("branch")?e.branch:void 0,c=hermiebox.modules.ssbMentions(e.text),i=e.hasOwnProperty("recps")?e.recps:void 0,l=e.hasOwnProperty("channel")?e.channel:void 0,u=e.hasOwnProperty("fork")?e.fork:void 0,m=hermiebox.sbot||!1;0==c.length&&(c=void 0);const d=o.post(r,a,s,c,i,l);u&&(d.fork=u),console.log("posting",d),m&&m.publish(d,function(e,o){e?n(e):t(o)})})}follow(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1;o&&o.publish({type:"contact",contact:e,following:!0},(e,o)=>{e?n(e):t(o)})})}getBlob(e){return hermiebox.api.getBlob(e)}votes(e){return new Promise((t,n)=>{let o=hermiebox.modules.pullStream,r=hermiebox.sbot;r&&o(r.links({dest:e,rel:"vote",values:!0}),o.collect((e,o)=>{e?n(e):t(o)}))})}like(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"vote",vote:{link:e,value:1,expression:"Like"}};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}unlike(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"vote",vote:{link:e,value:0,expression:"Unlike"}};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}channels(){return new Promise((e,t)=>{let n=hermiebox.modules.pullStream,o=hermiebox.sbot||!1;o?(console.log("querying channels"),n(o.query.read({query:[{$filter:{value:{content:{channel:{$is:"string"},type:"post"}}}},{$reduce:{channel:["value","content","channel"],count:{$count:!0},timestamp:{$max:["value","timestamp"]}}},{$sort:[["timestamp"],["count"]]}],limit:20}),n.collect(function(n,o){console.log("channels",o),n?t(n):e(o)}))):t("no sbot")})}channel(e,t){return new Promise((n,o)=>{let r=hermiebox.modules.pullStream,a=hermiebox.sbot||!1,s={$filter:{value:{content:{channel:e}}}};t.lt&&(s.$filter.value.timestamp={$lt:t.lt}),console.dir(s),a?r(a.query.read({query:[s],limit:t.limit,reverse:!0}),r.collect(function(e,t){e?o(e):n(t)})):o("no sbot")})}channelSubscribe(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"channel",channel:e,subscribed:!0};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}channelUnsubscribe(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"channel",channel:e,subscribed:!1};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}channelSubscribed(e,t){return new Promise((n,o)=>{let r=hermiebox.modules.pullStream,a=hermiebox.sbot||!1;if(a){t||(t=a.id);let s={$filter:{value:{author:t,content:{type:"channel",channel:e}}}};r(a.query.read({query:[s],reverse:!0}),r.collect(function(e,t){e?o(e):t.length>0?n(t[0].value.content.subscribed||!1):n(!1)}))}else o("no sbot")})}subscribedChannels(e,t){return new Promise((e,n)=>{let o=hermiebox.modules.pullStream,r=hermiebox.sbot||!1;if(r){t||(t=r.id);let a={$filter:{value:{author:t,content:{type:"channel"}}},$map:{channel:["value","content","channel"],subscribed:["value","content","subscribed"]},$sort:[["value","timestamp"]]};o(r.query.read({query:[a],reverse:!0}),o.collect(function(t,o){t?n(t):e(o)}))}else n("no sbot")})}follow(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"contact",contact:e,following:!0};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}unfollow(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"contact",contact:e,following:!1};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}block(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"contact",contact:e,blocking:!0};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}unblock(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"contact",contact:e,blocking:!1};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}following(e,t){return new Promise((n,o)=>{let r=hermiebox.modules.pullStream,a=hermiebox.sbot||!1;if(a){t||(t=a.id);let s={$filter:{value:{author:t,content:{type:"contact",contact:e,following:{$is:"boolean"}}}}};r(a.query.read({query:[s],reverse:!0}),r.collect(function(e,t){e?o(e):t.length>0?n(t[0].value.content.following||!1):n(!1)}))}else o("no sbot")})}blocking(e,t){return new Promise((n,o)=>{let r=hermiebox.modules.pullStream,a=hermiebox.sbot||!1;if(a){t||(t=a.id);let s={$filter:{value:{author:t,content:{type:"contact",contact:e,blocking:{$is:"boolean"}}}}};r(a.query.read({query:[s],reverse:!0}),r.collect(function(e,t){e?o(e):t.length>0?n(t[0].value.content.blocking||!1):n(!1)}))}else o("no sbot")})}query(e,t,n,o,r){return new Promise((a,s)=>{let c=hermiebox.modules.pullStream,i=hermiebox.sbot||!1;if(i){let l={$filter:e};o&&(l.$map=o),r&&(l.$reduce=r),void 0===n&&(n=!0),console.log(`query call with limit: ${t} and reverse: ${n}`,l),c(i.query.read({query:[l],reverse:n,limit:t}),c.collect(function(e,t){e?s(e):a(t)}))}else s("no sbot")})}}var de=e=>encodeURIComponent(e).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),he=new RegExp("%[a-f0-9]{2}","gi"),pe=new RegExp("(%[a-f0-9]{2})+","gi");function ge(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var n=e.slice(0,t),o=e.slice(t);return Array.prototype.concat.call([],ge(n),ge(o))}function fe(e){try{return decodeURIComponent(e)}catch(o){for(var t=e.match(he),n=1;n<t.length;n++)t=(e=ge(t,n).join("")).match(he);return e}}var be=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"ï¿½ï¿½","%FF%FE":"ï¿½ï¿½"},n=pe.exec(e);n;){try{t[n[0]]=decodeURIComponent(n[0])}catch(e){var o=fe(n[0]);o!==n[0]&&(t[n[0]]=o)}n=pe.exec(e)}t["%C2"]="ï¿½";for(var r=Object.keys(t),a=0;a<r.length;a++){var s=r[a];e=e.replace(new RegExp(s,"g"),t[s])}return e}(e)}},ve=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const n=e.indexOf(t);return-1===n?[e]:[e.slice(0,n),e.slice(n+t.length)]};function ye(e,t){return t.encode?t.strict?de(e):encodeURIComponent(e):e}function ke(e,t){return t.decode?be(e):e}function we(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function $e(e){const t=(e=we(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function xe(e,t){const n=function(e){let t;switch(e.arrayFormat){case"index":return(e,n,o)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===o[e]&&(o[e]={}),o[e][t[1]]=n):o[e]=n};case"bracket":return(e,n,o)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==o[e]?o[e]=[].concat(o[e],n):o[e]=[n]:o[e]=n};case"comma":return(e,t,n)=>{const o="string"==typeof t&&t.split("").indexOf(",")>-1?t.split(","):t;n[e]=o};default:return(e,t,n)=>{void 0!==n[e]?n[e]=[].concat(n[e],t):n[e]=t}}}(t=Object.assign({decode:!0,arrayFormat:"none"},t)),o=Object.create(null);if("string"!=typeof e)return o;if(!(e=e.trim().replace(/^[?#&]/,"")))return o;for(const r of e.split("&")){let[e,a]=ve(r.replace(/\+/g," "),"=");a=void 0===a?null:ke(a,t),n(ke(e,t),a,o)}return Object.keys(o).sort().reduce((e,t)=>{const n=o[t];return Boolean(n)&&"object"==typeof n&&!Array.isArray(n)?e[t]=function e(t){return Array.isArray(t)?t.sort():"object"==typeof t?e(Object.keys(t)).sort((e,t)=>Number(e)-Number(t)).map(e=>t[e]):t}(n):e[t]=n,e},Object.create(null))}var Ne={extract:$e,parse:xe,stringify:(e,t)=>{if(!e)return"";const n=function(e){switch(e.arrayFormat){case"index":return t=>(n,o)=>{const r=n.length;return void 0===o?n:null===o?[...n,[ye(t,e),"[",r,"]"].join("")]:[...n,[ye(t,e),"[",ye(r,e),"]=",ye(o,e)].join("")]};case"bracket":return t=>(n,o)=>void 0===o?n:null===o?[...n,[ye(t,e),"[]"].join("")]:[...n,[ye(t,e),"[]=",ye(o,e)].join("")];case"comma":return t=>(n,o,r)=>null==o||0===o.length?n:0===r?[[ye(t,e),"=",ye(o,e)].join("")]:[[n,ye(o,e)].join(",")];default:return t=>(n,o)=>void 0===o?n:null===o?[...n,ye(t,e)]:[...n,[ye(t,e),"=",ye(o,e)].join("")]}}(t=Object.assign({encode:!0,strict:!0,arrayFormat:"none"},t)),o=Object.keys(e);return!1!==t.sort&&o.sort(t.sort),o.map(o=>{const r=e[o];return void 0===r?"":null===r?ye(o,t):Array.isArray(r)?r.reduce(n(o),[]).join("&"):ye(o,t)+"="+ye(r,t)}).filter(e=>e.length>0).join("&")},parseUrl:(e,t)=>({url:we(e).split("?")[0]||"",query:xe($e(e),t)})};function _e(e){var t,n,o,r,a;return{c(){t=w("span"),n=w("a"),o=$("(root)"),n.href=r="?thread="+encodeURIComponent(e.msg.value.content.root)+"#/thread",a=_(n,"click",C(e.goRoot))},m(e,r){v(e,t,r),b(t,n),b(n,o)},p(e,t){e.msg&&r!==(r="?thread="+encodeURIComponent(t.msg.value.content.root)+"#/thread")&&(n.href=r)},d(e){e&&y(t),a()}}}function Ce(e){var t,n,o,r,a;return{c(){t=w("span"),n=w("a"),o=$("(in reply to)"),n.href=r="?thread="+encodeURIComponent(e.msg.value.content.branch)+"#/thread",a=_(n,"click",C(e.goBranch))},m(e,r){v(e,t,r),b(t,n),b(n,o)},p(e,t){e.msg&&r!==(r="?thread="+encodeURIComponent(t.msg.value.content.branch)+"#/thread")&&(n.href=r)},d(e){e&&y(t),a()}}}function Pe(t){var n,o,r,s,c,i,l,u,m,d,h,p,g,f,k,N,C,P,M=t.msg.value.content.root&&_e(t),R=t.msg.value.content.branch&&Ce(t);return{c(){n=w("div"),o=x(),r=w("div"),s=w("div"),c=w("div"),i=w("label"),l=w("input"),u=x(),m=w("i"),d=$("\n        Like"),h=x(),M&&M.c(),p=x(),R&&R.c(),g=x(),f=w("div"),(k=w("button")).textContent="Fork",N=x(),(C=w("button")).textContent="Reply",n.className="card-body svelte-10kjcnj",T(l,"type","checkbox"),l.checked=t.liked,m.className="form-icon",i.className="form-switch d-inline",c.className="column col-6",k.className="btn",C.className="btn",f.className="column col-6 text-right",s.className="columns col-gapless",r.className="card-footer",P=[_(l,"change",t.likeChanged),_(k,"click",t.fork),_(C,"click",t.reply)]},m(e,a){v(e,n,a),n.innerHTML=t.content,v(e,o,a),v(e,r,a),b(r,s),b(s,c),b(c,i),b(i,l),b(i,u),b(i,m),b(i,d),b(c,h),M&&M.m(c,null),b(c,p),R&&R.m(c,null),b(s,g),b(s,f),b(f,k),b(f,N),b(f,C)},p(e,t){e.liked&&(l.checked=t.liked),t.msg.value.content.root?M?M.p(e,t):((M=_e(t)).c(),M.m(c,p)):M&&(M.d(1),M=null),t.msg.value.content.branch?R?R.p(e,t):((R=Ce(t)).c(),R.m(c,null)):R&&(R.d(1),R=null)},i:e,o:e,d(e){e&&(y(n),y(o),y(r)),M&&M.d(),R&&R.d(),a(P)}}}function Te(e,t,n){let{msg:o}=t,r=ssb.markdown(o.value.content.text),a=!1;ssb.votes(o.key).then(e=>{e.forEach(e=>{e.value.author===ssb.feed&&1===e.value.content.vote.value&&n("liked",a=!0)})});return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,content:r,liked:a,likeChanged:e=>{e.target.checked?ssb.like(o.key).then(()=>console.log("liked",o.key)).catch(()=>{const e=a=!1;return n("liked",a),e}):ssb.unlike(o.key).then(()=>console.log("unliked",o.key)).catch(()=>{const e=a=!0;return n("liked",a),e})},reply:e=>{let t=o.value.content.root||o.key,n=o.value.content.channel,r=o.value.author;eo("/compose",{root:t,branch:o.key,channel:n,replyfeed:r})},fork:e=>{let t=o.value.content.root||o.key,n=o.value.content.channel,r=o.value.author;eo("/compose",{root:o.key,branch:o.key,fork:t,channel:n,replyfeed:r})},goRoot:e=>{let t=o.value.content.root||o.key;eo("/thread",{thread:t})},goBranch:e=>{let t=o.value.content.branch||o.key;eo("/thread",{thread:t})}}}class Me extends ie{constructor(e){super(),ce(this,e,Te,Pe,c,["msg"])}}function Re(t){var n,o,r,a;return{c(){n=w("div"),o=w("pre"),r=w("code"),a=$(t.rawContent),o.className="code svelte-1c3kv1x",n.className="card-body"},m(e,t){v(e,n,t),b(n,o),b(o,r),b(r,a)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Se(e,t,n){let{msg:o}=t,r=JSON.stringify(o,null,2);return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,rawContent:r}}class Oe extends ie{constructor(e){super(),ce(this,e,Se,Re,c,["msg"])}}function Ie(t){var n,o,r,a,s,c,i,l;return{c(){n=w("div"),o=$(t.person),r=x(),a=$(t.expression),s=x(),c=w("a"),i=$(t.label),c.href="/index.html?thread="+t.encodedid+"#/thread",n.className="card-body",l=_(c,"click",t.goThread)},m(e,t){v(e,n,t),b(n,o),b(n,r),b(n,a),b(n,s),b(n,c),b(c,i)},p(e,t){e.person&&M(o,t.person),e.label&&M(i,t.label)},i:e,o:e,d(e){e&&y(n),l()}}}function Ue(e,t,n){let{msg:o}=t,r=o.value.content.vote.expression,a=o.value.content.vote.link,s=encodeURIComponent(a),c=a,i=o.value.author;ssb.blurbFromMsg(a,100).then(e=>{n("label",c=e)}),ssb.avatar(o.value.author).then(e=>{const t=i=e.name;return n("person",i),t});return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,expression:r,encodedid:s,label:c,person:i,goThread:e=>{e.stopPropagation(),e.preventDefault(),e.ctrlKey?window.open(`?thread=${encodeURIComponent(a)}#/thread`):eo("/thread",{thread:a})}}}class Le extends ie{constructor(e){super(),ce(this,e,Ue,Ie,c,["msg"])}}function Fe(t){var n;return{c(){(n=w("div")).innerHTML="<p>ðŸ”’ PRIVATE</p>",n.className="card-body"},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Ae(e,t,n){let{msg:o}=t;return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o}}class Ee extends ie{constructor(e){super(),ce(this,e,Ae,Fe,c,["msg"])}}function He(t){var n,o,r,a,s,c,i,l;return{c(){n=w("div"),o=$(t.person),r=x(),a=$(t.verb),s=x(),c=w("a"),i=$(t.otherPersonName),c.href="?feed="+t.otherPersonFeed+"#/profile",n.className="card-body",l=_(c,"click",t.goProfile)},m(e,t){v(e,n,t),b(n,o),b(n,r),b(n,a),b(n,s),b(n,c),b(c,i)},p(e,t){e.person&&M(o,t.person),e.verb&&M(a,t.verb),e.otherPersonName&&M(i,t.otherPersonName)},i:e,o:e,d(e){e&&y(n),l()}}}function je(e,t,n){let{msg:o}=t,r=o.value.author,a=encodeURIComponent(o.value.content.contact),s=a,c=o.value.content.following?"followed":"unfollowed";o.value.content.blocking&&n("verb",c="blocked"),ssb.avatar(o.value.author).then(e=>{const t=r=e.name;return n("person",r),t}),ssb.avatar(o.value.content.contact).then(e=>{n("otherPersonName",s=e.name)}).catch(e=>console.log(e));return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,person:r,otherPersonFeed:a,otherPersonName:s,verb:c,goProfile:e=>{e.stopPropagation(),e.preventDefault(),eo("/profile",{feed:o.value.content.contact})}}}class Be extends ie{constructor(e){super(),ce(this,e,je,He,c,["msg"])}}function qe(t){var n,o,r,a,s,c,i,l,u;return{c(){n=w("div"),o=$(t.person),r=x(),a=$(t.verb),s=x(),c=w("a"),i=$("#"),l=$(t.channel),c.href="?channel="+t.channel+"#/channel",n.className="card-body",u=_(c,"click",t.goChannel)},m(e,t){v(e,n,t),b(n,o),b(n,r),b(n,a),b(n,s),b(n,c),b(c,i),b(c,l)},p(e,t){e.person&&M(o,t.person)},i:e,o:e,d(e){e&&y(n),u()}}}function De(e,t,n){let{msg:o}=t,r=o.value.author,a=o.value.content.subscribed?"subscribed":"unsubscribed",s=encodeURIComponent(o.value.content.channel);ssb.avatar(o.value.author).then(e=>{const t=r=e.name;return n("person",r),t});return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,person:r,verb:a,channel:s,goChannel:e=>{e.stopPropagation(),e.preventDefault(),eo("/channel",{channel:o.value.content.channel})}}}class ze extends ie{constructor(e){super(),ce(this,e,De,qe,c,["msg"])}}function Ye(e){var t,n,o;return{c(){t=w("div"),n=$(e.person),o=$(" is doing something related to a gathering but gatherings are not\n      supported yet, sorry."),t.className="toast"},m(e,r){v(e,t,r),b(t,n),b(t,o)},p(e,t){e.person&&M(n,t.person)},d(e){e&&y(t)}}}function Ve(e){var t,n,o,r,a,s,c;function i(e){return e.image?Je:We}var l=i(e),u=l(e),m=e.msg.value.content.description&&Ke(e);return{c(){t=$(e.person),n=x(),o=$(e.verb),r=x(),a=w("a"),u.c(),s=x(),m&&m.c(),c=N(),a.href="?feed="+e.otherLink+"#/profile"},m(e,i){v(e,t,i),v(e,n,i),v(e,o,i),v(e,r,i),v(e,a,i),u.m(a,null),v(e,s,i),m&&m.m(e,i),v(e,c,i)},p(e,n){e.person&&M(t,n.person),e.verb&&M(o,n.verb),l===(l=i(n))&&u?u.p(e,n):(u.d(1),(u=l(n))&&(u.c(),u.m(a,null))),n.msg.value.content.description?m?m.p(e,n):((m=Ke(n)).c(),m.m(c.parentNode,c)):m&&(m.d(1),m=null)},d(e){e&&(y(t),y(n),y(o),y(r),y(a)),u.d(),e&&y(s),m&&m.d(e),e&&y(c)}}}function We(e){var t,n;return{c(){t=w("span"),n=$(e.otherName),t.className="chip"},m(e,o){v(e,t,o),b(t,n)},p(e,t){e.otherName&&M(n,t.otherName)},d(e){e&&y(t)}}}function Je(e){var t,n,o,r;return{c(){t=w("div"),n=w("img"),o=x(),r=$(e.otherName),n.src=e.image,n.className="avatar avatar-sm",n.alt=e.otherName,t.className="chip"},m(e,a){v(e,t,a),b(t,n),b(t,o),b(t,r)},p(e,t){e.otherName&&(n.alt=t.otherName,M(r,t.otherName))},d(e){e&&y(t)}}}function Ke(e){var t,n=e.ssb.markdown(e.msg.value.content.description);return{c(){t=w("blockquote")},m(e,o){v(e,t,o),t.innerHTML=n},p(e,o){e.msg&&n!==(n=o.ssb.markdown(o.msg.value.content.description))&&(t.innerHTML=n)},d(e){e&&y(t)}}}function Ge(t){var n;function o(e){return e.isThisAboutFeeds?Ve:Ye}var r=o(t),a=r(t);return{c(){n=w("div"),a.c(),n.className="card-body"},m(e,t){v(e,n,t),a.m(n,null)},p(e,t){r===(r=o(t))&&a?a.p(e,t):(a.d(1),(a=r(t))&&(a.c(),a.m(n,null)))},i:e,o:e,d(e){e&&y(n),a.d()}}}function Qe(e,t,n){let{msg:o}=t,r=o.value.author,a=encodeURIComponent(o.value.content.about),s=o.value.content.name||o.value.content.about,c=!0,i=o.value.content.about===o.value.author?"self-identifies":"identifies";ssb.avatar(o.value.author).then(e=>{const t=r=e.name;return n("person",r),t}),s===o.value.content.about&&ssb.avatar(o.value.content.about).then(e=>{const t=s=e.name;return n("otherName",s),t});let l=!!o.value.content.image&&`http://localhost:8989/blobs/get/${encodeURIComponent(o.value.content.image)}`;return o.value.content.description&&n("verb",i+=" with description"),o.value.content.about.startsWith("%")&&n("isThisAboutFeeds",c=!1),e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,person:r,otherLink:a,otherName:s,isThisAboutFeeds:c,verb:i,image:l,ssb:ssb}}class Xe extends ie{constructor(e){super(),ce(this,e,Qe,Ge,c,["msg"])}}function Ze(t){var n,o,r,a,s,c,i,l;return{c(){n=w("div"),o=$(t.person),r=$(" announced pub\n  "),a=w("a"),s=$(t.host),c=$(":"),i=$(t.port),a.href="/index.html?feed="+t.encodedid+"#/profile",n.className="card-body",l=_(a,"click",t.goProfile)},m(e,t){v(e,n,t),b(n,o),b(n,r),b(n,a),b(a,s),b(a,c),b(a,i)},p(e,t){e.person&&M(o,t.person)},i:e,o:e,d(e){e&&y(n),l()}}}function et(e,t,n){let{msg:o}=t,r=encodeURIComponent(o.value.content.address.key),a=o.value.author,s=o.value.content.address.host,c=o.value.content.address.port;ssb.avatar(o.value.author).then(e=>{const t=a=e.name;return n("person",a),t});return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,encodedid:r,person:a,host:s,port:c,goProfile:e=>{e.stopPropagation(),e.preventDefault(),eo("/profile",{feed:o.value.content.address.key})}}}class tt extends ie{constructor(e){super(),ce(this,e,et,Ze,c,["msg"])}}function nt(t){var n,o;return{c(){n=w("div"),(o=w("img")).src="http://localhost:8989/blobs/get/"+encodeURIComponent(t.thumbnail),o.className="img-responsive",o.alt=t.title,n.className="card-image"},m(e,t){v(e,n,t),b(n,o)},p:e,d(e){e&&y(n)}}}function ot(t){var n,o;return{c(){n=w("h1"),o=$(t.title),n.className="card-title h5"},m(e,t){v(e,n,t),b(n,o)},p:e,d(e){e&&y(n)}}}function rt(e){var t,n,o;return{c(){t=w("div"),n=$("Can't load blogpost: "),o=$(e.toastMsg),t.className="toast toast-error"},m(e,r){v(e,t,r),b(t,n),b(t,o)},p(e,t){e.toastMsg&&M(o,t.toastMsg)},d(e){e&&y(t)}}}function at(t){var n,o;return{c(){n=w("noscript"),o=w("noscript")},m(e,r){v(e,n,r),n.insertAdjacentHTML("afterend",t.summary),v(e,o,r)},p:e,d(e){e&&(k(n,o),y(n),y(o))}}}function st(e){var t,n;return{c(){t=w("noscript"),n=w("noscript")},m(o,r){v(o,t,r),t.insertAdjacentHTML("afterend",e.post),v(o,n,r)},p(e,o){e.post&&(k(t,n),t.insertAdjacentHTML("afterend",o.post))},d(e){e&&(k(t,n),y(t),y(n))}}}function ct(e){var t,n,o,r,a;return{c(){t=w("span"),n=w("a"),o=$("(root)"),n.href=r="?thread="+encodeURIComponent(e.msg.value.content.root)+"#/thread",a=_(n,"click",C(e.goRoot))},m(e,r){v(e,t,r),b(t,n),b(n,o)},p(e,t){e.msg&&r!==(r="?thread="+encodeURIComponent(t.msg.value.content.root)+"#/thread")&&(n.href=r)},d(e){e&&y(t),a()}}}function it(e){var t,n,o,r,a;return{c(){t=w("span"),n=w("a"),o=$("(in reply to)"),n.href=r="?thread="+encodeURIComponent(e.msg.value.content.branch)+"#/thread",a=_(n,"click",C(e.goBranch))},m(e,r){v(e,t,r),b(t,n),b(n,o)},p(e,t){e.msg&&r!==(r="?thread="+encodeURIComponent(t.msg.value.content.branch)+"#/thread")&&(n.href=r)},d(e){e&&y(t),a()}}}function lt(e){var t,n;return{c(){(t=w("button")).textContent="Close Blogpost",t.className="btn btn-primary",R(t,"locating",e.loading),n=_(t,"click",e.click_handler)},m(e,n){v(e,t,n)},p(e,n){e.loading&&R(t,"locating",n.loading)},d(e){e&&y(t),n()}}}function ut(e){var t,n;return{c(){(t=w("button")).textContent="Read Blogpost",t.className="btn btn-primary",R(t,"locating",e.loading),n=_(t,"click",e.displayBlogPost)},m(e,n){v(e,t,n)},p(e,n){e.loading&&R(t,"locating",n.loading)},d(e){e&&y(t),n()}}}function mt(t){var n,o,r,s,c,i,l,u,m,d,h,p,g,f,k,N,C,P,M,R,S=t.thumbnail&&nt(t),O=t.title&&ot(t),I=t.toast&&rt(t);function U(e){return e.showBlogpost?st:at}var L=U(t),F=L(t),A=t.msg.value.content.root&&ct(t),E=t.msg.value.content.branch&&it(t);function H(e){return e.showBlogpost?lt:ut}var j=H(t),B=j(t);return{c(){S&&S.c(),n=x(),o=w("div"),O&&O.c(),r=x(),I&&I.c(),s=x(),F.c(),c=x(),i=w("div"),l=w("div"),u=w("div"),m=w("label"),d=w("input"),h=x(),p=w("i"),g=$("\n        Like"),f=x(),A&&A.c(),k=x(),E&&E.c(),N=x(),C=w("div"),(P=w("button")).textContent="Reply",M=x(),B.c(),o.className="card-body",T(d,"type","checkbox"),d.checked=t.liked,p.className="form-icon",m.className="form-switch d-inline",u.className="column col-6",P.className="btn",C.className="column col-6 text-right",l.className="columns col-gapless",i.className="card-footer",R=[_(d,"change",t.likeChanged),_(P,"click",t.reply)]},m(e,t){S&&S.m(e,t),v(e,n,t),v(e,o,t),O&&O.m(o,null),b(o,r),I&&I.m(o,null),b(o,s),F.m(o,null),v(e,c,t),v(e,i,t),b(i,l),b(l,u),b(u,m),b(m,d),b(m,h),b(m,p),b(m,g),b(u,f),A&&A.m(u,null),b(u,k),E&&E.m(u,null),b(l,N),b(l,C),b(C,P),b(C,M),B.m(C,null)},p(e,t){t.thumbnail?S?S.p(e,t):((S=nt(t)).c(),S.m(n.parentNode,n)):S&&(S.d(1),S=null),t.title?O?O.p(e,t):((O=ot(t)).c(),O.m(o,r)):O&&(O.d(1),O=null),t.toast?I?I.p(e,t):((I=rt(t)).c(),I.m(o,s)):I&&(I.d(1),I=null),L===(L=U(t))&&F?F.p(e,t):(F.d(1),(F=L(t))&&(F.c(),F.m(o,null))),e.liked&&(d.checked=t.liked),t.msg.value.content.root?A?A.p(e,t):((A=ct(t)).c(),A.m(u,k)):A&&(A.d(1),A=null),t.msg.value.content.branch?E?E.p(e,t):((E=it(t)).c(),E.m(u,null)):E&&(E.d(1),E=null),j===(j=H(t))&&B?B.p(e,t):(B.d(1),(B=j(t))&&(B.c(),B.m(C,null)))},i:e,o:e,d(e){S&&S.d(e),e&&(y(n),y(o)),O&&O.d(),I&&I.d(),F.d(),e&&(y(c),y(i)),A&&A.d(),E&&E.d(),B.d(),a(R)}}}function dt(e,t,n){let o;i(e,Zn,e=>{n("$routeLocation",o=e)});let{msg:r}=t,a=r.value.content,s=ssb.markdown(a.summary),c=a.thumbnail||!1,l=a.title||!1,u=!1,m=!1,d=!1,h="",p=s,g=!1;ssb.votes(r.key).then(e=>{e.forEach(e=>{e.value.author===ssb.feed&&1===e.value.content.vote.value&&n("liked",g=!0)})});const f=e=>{n("loading",m=!0),console.log("loading blogpost",a.blog),ssb.getBlob(a.blog).then(e=>{n("post",p=ssb.markdown(e)),n("showBlogpost",u=!0)}).catch(e=>{console.error("can't load blog post",e),n("toast",d=!0),n("toastMsg",h=e)})};return"/thread"==o&&setTimeout(f,100),e.$set=(e=>{"msg"in e&&n("msg",r=e.msg)}),{msg:r,summary:s,thumbnail:c,title:l,showBlogpost:u,loading:m,toast:d,toastMsg:h,post:p,liked:g,likeChanged:e=>{e.target.checked?ssb.like(r.key).then(()=>console.log("liked",r.key)).catch(()=>{const e=g=!1;return n("liked",g),e}):ssb.unlike(r.key).then(()=>console.log("unliked",r.key)).catch(()=>{const e=g=!0;return n("liked",g),e})},displayBlogPost:f,reply:e=>{let t=r.value.content.root||r.key,n=r.value.content.channel;eo("/compose",{root:t,branch:r.key,channel:n})},goRoot:e=>{let t=r.value.content.root||r.key;eo("/thread",{thread:t})},goBranch:e=>{let t=r.value.content.branch||r.key;eo("/thread",{thread:t})},click_handler:function(){const e=u=!1;return n("showBlogpost",u),e}}}class ht extends ie{constructor(e){super(),ce(this,e,dt,mt,c,["msg"])}}function pt(e){var t,n,o;return{c(){t=w("span"),n=$(e.name),t.className="chip",o=_(t,"click",e.avatarClick)},m(e,o){v(e,t,o),b(t,n)},p(e,t){e.name&&M(n,t.name)},d(e){e&&y(t),o()}}}function gt(e){var t,n,o,r,a;return{c(){t=w("div"),n=w("img"),o=x(),r=$(e.name),n.src=e.image,n.className="avatar avatar-sm",t.className="chip",a=_(t,"click",e.avatarClick)},m(e,a){v(e,t,a),b(t,n),b(t,o),b(t,r)},p(e,t){e.image&&(n.src=t.image),e.name&&M(r,t.name)},d(e){e&&y(t),a()}}}function ft(t){var n;function o(e){return e.image?gt:pt}var r=o(t),a=r(t);return{c(){a.c(),n=N()},m(e,t){a.m(e,t),v(e,n,t)},p(e,t){r===(r=o(t))&&a?a.p(e,t):(a.d(1),(a=r(t))&&(a.c(),a.m(n.parentNode,n)))},i:e,o:e,d(e){a.d(e),e&&y(n)}}}function bt(e,t,n){let{feed:o}=t,r=!1,a=o;const s=j();return ssb.avatar(o).then(e=>{null!==e.image&&n("image",r=`http://localhost:8989/blobs/get/${e.image}`),n("name",a=e.name)}),e.$set=(e=>{"feed"in e&&n("feed",o=e.feed)}),{feed:o,image:r,name:a,avatarClick:function(){s("avatarClick",{feed:o,name:a})}}}class vt extends ie{constructor(e){super(),ce(this,e,bt,ft,c,["feed"])}}var yt=function(){};yt.prototype.simple=function(e){var t=Date.now(),n=Date.parse(e);try{if(n!=n)throw"timeago-simple: Please check date and time format! Unable to parse the date & time: "+e}catch(t){return console.error(t),e}return n-t<0?function(e){var t=Date.now();e=Date.parse(e);var n=(t-e)/1e3,o=n/60,r=n/3600;if(n<60&&o<1)return 1===n?Math.round(n)+" second ago":Math.round(n)+" seconds ago";if(o<60&&r<1)return 1===o?Math.round(o)+" minute ago":Math.round(o)+" minutes ago";if(r>24){var a=r/24;if(a>30){var s=a/30;if(s>12){var c=s/12;if(c>0)return 1===c?Math.ceil(c)+" year ago":Math.ceil(c)+" years ago"}return Math.round(s)+" month ago"}return 1===a?Math.round(a)+" day ago":Math.round(a)+" days ago"}return 1===r?Math.round(r)+" hour ago":Math.round(r)+" hours ago"}(e):function(e){var t=Date.now(),n=((e=Date.parse(e))-t)/1e3,o=n/60,r=n/3600;if(n<60&&o<1)return 1===n?"in "+Math.round(n)+" second":"in "+Math.round(n)+" seconds";if(o<60&&r<1)return 1===o?"in "+Math.round(o)+" minute":"in "+Math.round(o)+" minutes";if(r>24){var a=r/24;if(a>30){var s=a/30;if(s>12){var c=s/12;if(c>0)return 1===c?"in "+Math.ceil(c)+" year":"in "+Math.ceil(c)+" years"}return"in "+Math.round(s)+" month"}return 1===a?"in "+Math.round(a)+" day":"in "+Math.round(a)+" days"}return 1===r?"in "+Math.round(r)+" hour":"in "+Math.round(r)+" hours"}(e)},yt.prototype.future=function(e){console.warn("timeago-simple: .future function is depricated! Please use .simple for both past and future dates.");var t=Date.now();try{if(Date.parse(e)!=Date.parse(e))throw"timeago-simple: Please check date and time format! Unable to parse the date & time: "+e;if(Date.parse(e)-t<0)throw"timeago-simple: Looks like it's more relevant case for timeago.simple"}catch(t){return console.error(t),e}var n=((e=Date.parse(e))-t)/1e3,o=n/60,r=n/3600;if(n<60&&o<1)return 1===n?"in "+Math.round(n)+" second":"in "+Math.round(n)+" seconds";if(o<60&&r<1)return 1===o?"in "+Math.round(o)+" minute":"in "+Math.round(o)+" minutes";if(r>24){var a=r/24;if(a>30){var s=a/30;if(s>12){var c=s/12;if(c>0)return 1===c?"in "+Math.ceil(c)+" year":"in "+Math.ceil(c)+" years"}return"in "+Math.round(s)+" month"}return 1===a?"in "+Math.round(a)+" day":"in "+Math.round(a)+" days"}return 1===r?"in "+Math.round(r)+" hour":"in "+Math.round(r)+" hours"};var kt=new yt;const wt=e=>kt.simple(new Date(e));function $t(e){var t;return{c(){(t=w("span")).textContent="PRIVATE",t.className="label"},m(e,n){v(e,t,n)},d(e){e&&y(t)}}}function xt(e){var t,n,o=e.msg.value.content.channel;return{c(){t=$("#"),n=$(o)},m(e,o){v(e,t,o),v(e,n,o)},p(e,t){e.msg&&o!==(o=t.msg.value.content.channel)&&M(n,o)},d(e){e&&(y(t),y(n))}}}function Nt(e){var t;return{c(){t=$("Close raw message")},m(e,n){v(e,t,n)},d(e){e&&y(t)}}}function _t(e){var t;return{c(){t=$("Show raw message")},m(e,n){v(e,t,n)},d(e){e&&y(t)}}}function Ct(t){var n,o,r,a,s,c,i,l,u,m,d,h,p,g,f,k,N,_,C,P,T;return{c(){n=w("div"),o=w("div"),r=w("div"),a=w("pre"),s=w("code"),c=$(t.rawContent),i=x(),l=w("div"),u=w("p"),m=$("This is a message of type\n            "),d=w("em"),h=$(t.type),p=$("\n            ."),g=x(),f=w("p"),k=$("To learn more about it, go to\n            "),N=w("a"),_=$("the documentation about messages with type "),C=$(t.type),T=$("\n            ."),a.className="code",r.className="column col-9",N.target="_blank",N.href=P="/docs/index.html#/message_types/"+t.type,l.className="column col-3",o.className="columns",n.className="card-body"},m(e,t){v(e,n,t),b(n,o),b(o,r),b(r,a),b(a,s),b(s,c),b(o,i),b(o,l),b(l,u),b(u,m),b(u,d),b(d,h),b(u,p),b(l,g),b(l,f),b(f,k),b(f,N),b(N,_),b(N,C),b(f,T)},p(e,t){e.type&&(M(h,t.type),M(C,t.type)),e.type&&P!==(P="/docs/index.html#/message_types/"+t.type)&&(N.href=P)},i:e,o:e,d(e){e&&y(n)}}}function Pt(e){var t,n,o=e.selectedRenderer;function r(e){return{props:{msg:e.msg}}}if(o)var a=new o(r(e));return{c(){a&&a.$$.fragment.c(),t=N()},m(e,o){a&&ae(a,e,o),v(e,t,o),n=!0},p(e,n){var s={};if(e.msg&&(s.msg=n.msg),o!==(o=n.selectedRenderer)){if(a){Z();const e=a;te(()=>{e.$destroy()}),e.$$.fragment.o(1),ee()}o?((a=new o(r(n))).$$.fragment.c(),a.$$.fragment.i(1),ae(a,t.parentNode,t)):a=null}else o&&a.$set(s)},i(e){n||(a&&a.$$.fragment.i(e),n=!0)},o(e){a&&a.$$.fragment.o(e),n=!1},d(e){e&&y(t),a&&a.$destroy(e)}}}function Tt(e){var t,n,o,r,s,c,i,l,u,m,d,h,p,g,f,k,N,P,T,S,O,I,U,L,F,A,E,H,j,B,q,D,z,Y,V,W,J,K,G,Q,X,ne,oe,re,ae,se,ce,ie=wt(e.msg.value.timestamp),le=e.privateMsgForYou&&$t(),ue=e.msg.value.content.channel&&xt(e);function me(e){return e.showRaw?Nt:_t}var de=me(e),he=de(e),pe=[Pt,Ct],ge=[];function fe(e){return e.showRaw?1:0}return re=fe(e),ae=ge[re]=pe[re](e),{c(){t=w("div"),n=w("div"),o=w("div"),r=w("div"),s=w("div"),c=w("div"),i=w("div"),l=w("img"),u=x(),m=w("div"),d=w("div"),h=$(e.name),p=x(),g=w("small"),f=$(ie),k=x(),le&&le.c(),N=x(),P=w("div"),T=w("span"),ue&&ue.c(),S=x(),O=w("div"),(I=w("span")).innerHTML='<i class="icon icon-more-vert"></i>',U=x(),L=w("ul"),F=w("li"),A=w("a"),E=w("i"),H=$("\n              Open in new tab"),B=x(),q=w("li"),(D=w("a")).innerHTML='<i class="icon icon-copy"></i>\n\t\t\t              Copy permalink to clipboard\n\t\t\t            ',z=x(),Y=w("li"),(V=w("a")).innerHTML='<i class="icon icon-copy"></i>\n\t\t\t              Copy message id to clipboard\n\t\t\t            ',W=x(),J=w("li"),K=x(),G=w("li"),Q=w("a"),X=w("i"),ne=x(),he.c(),oe=x(),ae.c(),l.src=e.image,l.className="avatar avatar-lg",l.alt=e.feed,i.className="example-tile-icon",c.className="tile-icon",d.className="tile-title",g.className="tile-subtitle text-gray",m.className="tile-content",s.className="tile tile-centered feed-display svelte-m5ll6n",r.className="card-title",o.className="float-left",T.className="text-gray channel-display svelte-m5ll6n",I.className="btn btn-link dropdown-toggle",I.tabIndex="0",R(I,"active",e.dropdownActive),E.className="icon icon-share",A.href=j="?thread="+e.encodeURIComponent(e.msg.key)+"#/thread",A.target="_blank",F.className="menu-item",D.href="#",q.className="menu-item",V.href="#",Y.className="menu-item",J.className="divider",J.dataset.content="FOR THE CURIOUS",X.className="icon icon-message",Q.href="#",G.className="menu-item",L.className="menu menu-right svelte-m5ll6n",O.className="dropdown",P.className="float-right",n.className="card-header",t.className="card m-2 svelte-m5ll6n",R(t,"private",e.privateMsgForYou),ce=[_(s,"click",e.goProfile),_(T,"click",e.click_handler),_(I,"click",e.click_handler_1),_(D,"click",C(e.copyPermalink)),_(V,"click",C(e.copyHash)),_(Q,"click",C(e.toggleRawMessage))]},m(e,a){v(e,t,a),b(t,n),b(n,o),b(o,r),b(r,s),b(s,c),b(c,i),b(i,l),b(s,u),b(s,m),b(m,d),b(d,h),b(m,p),b(m,g),b(g,f),b(n,k),le&&le.m(n,null),b(n,N),b(n,P),b(P,T),ue&&ue.m(T,null),b(P,S),b(P,O),b(O,I),b(O,U),b(O,L),b(L,F),b(F,A),b(A,E),b(A,H),b(L,B),b(L,q),b(q,D),b(L,z),b(L,Y),b(Y,V),b(L,W),b(L,J),b(L,K),b(L,G),b(G,Q),b(Q,X),b(Q,ne),he.m(Q,null),b(t,oe),ge[re].m(t,null),se=!0},p(e,o){se&&!e.image||(l.src=o.image),se&&!e.name||M(h,o.name),se&&!e.msg||ie===(ie=wt(o.msg.value.timestamp))||M(f,ie),o.privateMsgForYou?le||((le=$t()).c(),le.m(n,N)):le&&(le.d(1),le=null),o.msg.value.content.channel?ue?ue.p(e,o):((ue=xt(o)).c(),ue.m(T,null)):ue&&(ue.d(1),ue=null),e.dropdownActive&&R(I,"active",o.dropdownActive),se&&!e.msg||j===(j="?thread="+o.encodeURIComponent(o.msg.key)+"#/thread")||(A.href=j),de!==(de=me(o))&&(he.d(1),(he=de(o))&&(he.c(),he.m(Q,null)));var r=re;(re=fe(o))===r?ge[re].p(e,o):(Z(),te(()=>{ge[r].d(1),ge[r]=null}),ae.o(1),ee(),(ae=ge[re])||(ae=ge[re]=pe[re](o)).c(),ae.i(1),ae.m(t,null)),e.privateMsgForYou&&R(t,"private",o.privateMsgForYou)},i(e){se||(ae&&ae.i(),se=!0)},o(e){ae&&ae.o(),se=!1},d(e){e&&y(t),le&&le.d(),ue&&ue.d(),he.d(),ge[re].d(),a(ce)}}}function Mt(e,t,n){let o,r,{msg:a}=t,s=a.value.author,c=!1,i=JSON.stringify(a,null,2),l=!1,u=!1,m={"*":Oe,post:Me,vote:Le,private:Ee,contact:Be,channel:ze,about:Xe,pub:tt,blog:ht};"string"==typeof a.value.content?n("type",o="private"):n("type",o=a.value.content.type),a.value.private&&n("privateMsgForYou",u=!0),m.hasOwnProperty(o)?n("selectedRenderer",r=m[o]):n("selectedRenderer",r=m["*"]);let d="images/icon.png",h=s;ssb.avatar(s).then(e=>{null!==e.image&&n("image",d=`http://localhost:8989/blobs/get/${e.image}`),n("name",h=e.name)});return e.$set=(e=>{"msg"in e&&n("msg",a=e.msg)}),{msg:a,type:o,feed:s,showRaw:c,rawContent:i,dropdownActive:l,privateMsgForYou:u,selectedRenderer:r,image:d,name:h,toggleRawMessage:()=>{n("showRaw",c=!c),n("dropdownActive",l=!1)},copyPermalink:()=>{navigator.clipboard.writeText(`ssb:${a.key}`).then(()=>console.log("permalink copied")).catch(e=>console.error("can't copy permalink",e)),n("dropdownActive",l=!1)},copyHash:()=>{navigator.clipboard.writeText(`${a.key}`).then(()=>console.log("hash copied")).catch(e=>console.error("can't copy hash",e)),n("dropdownActive",l=!1)},goProfile:e=>{e.ctrlKey?window.open(`?feed=${encodeURIComponent(s)}#/profile`):eo("/profile",{feed:s})},encodeURIComponent:encodeURIComponent,click_handler:function(){return eo("/channel",{channel:a.value.content.channel})},click_handler_1:function(){const e=l=!l;return n("dropdownActive",l),e}}}class Rt extends ie{constructor(e){super(),ce(this,e,Mt,Tt,c,["msg"])}}function St(e,t,n){const o=Object.create(e);return o.msg=t[n],o}function Ot(t){var n,o,r;return{c(){n=w("div"),o=$("Error: "),r=$(t.error),n.className="toast toast-error"},m(e,t){v(e,n,t),b(n,o),b(n,r)},p:e,d(e){e&&y(n)}}}function It(e){var t,n,o,r,s,c,i,l,u,m=[],d=new Map,h=e.msgs;const p=e=>e.msg.key;for(var g=0;g<h.length;g+=1){let t=St(e,h,g),n=p(t);d.set(n,m[g]=Lt(n,t))}return{c(){for(g=0;g<m.length;g+=1)m[g].c();t=x(),n=w("ul"),o=w("li"),(r=w("a")).innerHTML='<div class="page-item-subtitle">Previous</div>',s=x(),c=w("li"),(i=w("a")).innerHTML='<div class="page-item-subtitle">Next</div>',r.href="#/public",o.className="page-item page-previous",i.href="#/public",c.className="page-item page-next",n.className="pagination",u=[_(r,"click",P(C(e.goPrevious))),_(i,"click",P(C(e.goNext)))]},m(e,a){for(g=0;g<m.length;g+=1)m[g].m(e,a);v(e,t,a),v(e,n,a),b(n,o),b(o,r),b(n,s),b(n,c),b(c,i),l=!0},p(e,n){const o=n.msgs;Z(),m=re(m,e,p,1,n,o,d,t.parentNode,oe,Lt,t,St),ee()},i(e){if(!l){for(var t=0;t<h.length;t+=1)m[t].i();l=!0}},o(e){for(g=0;g<m.length;g+=1)m[g].o();l=!1},d(e){for(g=0;g<m.length;g+=1)m[g].d(e);e&&(y(t),y(n)),a(u)}}}function Ut(t){var n;return{c(){(n=w("div")).className="loading loading-lg"},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Lt(e,t){var n,o,r=new Rt({props:{msg:t.msg}});return{key:e,first:null,c(){n=N(),r.$$.fragment.c(),this.first=n},m(e,t){v(e,n,t),ae(r,e,t),o=!0},p(e,t){var n={};e.msgs&&(n.msg=t.msg),r.$set(n)},i(e){o||(r.$$.fragment.i(e),o=!0)},o(e){r.$$.fragment.o(e),o=!1},d(e){e&&y(n),r.$destroy(e)}}}function Ft(e){var t,n,o,r,a,s,c,i=e.error&&Ot(e),l=[Ut,It],u=[];function m(e){return e.msgs?1:0}return r=m(e),a=u[r]=l[r](e),{c(){(t=w("div")).innerHTML='<div class="columns"><h4 class="column">Public Feed</h4>\n\t\t\t    <div class="column"></div></div>',n=x(),i&&i.c(),o=x(),a.c(),s=N(),t.className="container"},m(e,a){v(e,t,a),v(e,n,a),i&&i.m(e,a),v(e,o,a),u[r].m(e,a),v(e,s,a),c=!0},p(e,t){t.error?i?i.p(e,t):((i=Ot(t)).c(),i.m(o.parentNode,o)):i&&(i.d(1),i=null);var n=r;(r=m(t))===n?u[r].p(e,t):(Z(),te(()=>{u[n].d(1),u[n]=null}),a.o(1),ee(),(a=u[r])||(a=u[r]=l[r](t)).c(),a.i(1),a.m(s.parentNode,s))},i(e){c||(a&&a.i(),c=!0)},o(e){a&&a.o(),c=!1},d(e){e&&(y(t),y(n)),i&&i.d(e),e&&y(o),u[r].d(e),e&&y(s)}}}function At(e,t,n){let o;i(e,Xn,e=>{n("$routeParams",o=e)});let r=!1,a=o.error||!1,s={limit:o.limit||so("limit",10),reverse:!0};const c=()=>{eo("/public",{lt:r[r.length-1].rts})},l=()=>{history.back()};let u=keymage("p",()=>(l(),!1)),m=keymage("n",()=>(c(),!1));return H(()=>{u(),m()}),e.$$.update=((e={opts:1,$routeParams:1,error:1})=>{if(e.opts||e.$routeParams||e.error){Object.assign(s,o),document.title="Patchfox - Public",s.hasOwnProperty("lt")&&(s.lt=parseInt(s.lt),n("opts",s),n("$routeParams",o),n("error",a)),s.hasOwnProperty("limit")&&(s.limit=parseInt(s.limit),n("opts",s),n("$routeParams",o),n("error",a));ssb.public(s).then(e=>{n("msgs",r=e),window.scrollTo(0,0)}).catch(e=>{a||console.error("errrrooooor",e)})}}),{msgs:r,error:a,goNext:c,goPrevious:l}}function Et(t){var n;return{c(){(n=w("div")).className="empty"},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Ht(e){return e.stopPropagation(),e.preventDefault(),!1}var jt=function(e,t){e.addEventListener("dragenter",Ht,!1),e.addEventListener("dragover",Ht,!1),e.addEventListener("drop",function(e,t){t.stopPropagation(),t.preventDefault(),e(Array.prototype.slice.call(t.dataTransfer.files))}.bind(void 0,t),!1)};function Bt(e){const t=e-1;return t*t*t+1}function qt(e,{delay:t=0,duration:n=400,easing:o=Bt}){const r=getComputedStyle(e),a=+r.opacity,s=parseFloat(r.height),c=parseFloat(r.paddingTop),i=parseFloat(r.paddingBottom),l=parseFloat(r.marginTop),u=parseFloat(r.marginBottom),m=parseFloat(r.borderTopWidth),d=parseFloat(r.borderBottomWidth);return{delay:t,duration:n,easing:o,css:e=>"overflow: hidden;"+`opacity: ${Math.min(20*e,1)*a};`+`height: ${e*s}px;`+`padding-top: ${e*c}px;`+`padding-bottom: ${e*i}px;`+`margin-top: ${e*l}px;`+`margin-bottom: ${e*u}px;`+`border-top-width: ${e*m}px;`+`border-bottom-width: ${e*d}px;`}}function Dt(t){var n,o,r;return{c(){n=w("div"),o=$("You are forking: "),r=$(t.fork),n.className="toast toast-warning"},m(e,t){v(e,n,t),b(n,o),b(n,r)},p:e,d(e){e&&y(n)}}}function zt(e){var t;function n(e){return e.error?Vt:Yt}var o=n(e),r=o(e);return{c(){r.c(),t=N()},m(e,n){r.m(e,n),v(e,t,n)},p(e,a){o===(o=n(a))&&r?r.p(e,a):(r.d(1),(r=o(a))&&(r.c(),r.m(t.parentNode,t)))},d(e){r.d(e),e&&y(t)}}}function Yt(e){var t,n,o,r,a;return{c(){t=w("div"),n=$("Your message has been posted. Do you want to\n            "),o=w("a"),r=$("Check it out?"),o.target="_blank",o.href=a="?thread="+e.encodeURIComponent(e.msg.key)+"#/thread",t.className="toast toast-success"},m(e,a){v(e,t,a),b(t,n),b(t,o),b(o,r)},p(e,t){e.msg&&a!==(a="?thread="+t.encodeURIComponent(t.msg.key)+"#/thread")&&(o.href=a)},d(e){e&&y(t)}}}function Vt(e){var t,n;return{c(){t=w("div"),n=$(e.msg),t.className="toast toast-error"},m(e,o){v(e,t,o),b(t,n)},p(e,t){e.msg&&M(n,t.msg)},d(e){e&&y(t)}}}function Wt(t){var n,o,r,s,c,i,l,u,m,d,h,p,g,f,$,N,C,P=t.ssb.markdown(t.content),T=(t.channel||t.root||t.branch)&&Kt(t);return{c(){n=w("div"),(o=w("h2")).textContent="Post preview",r=x(),T&&T.c(),s=x(),c=w("noscript"),i=w("noscript"),l=x(),u=w("div"),m=x(),d=w("div"),(h=w("div")).innerHTML='<span class="label label-warning">\n\t\t\t                This message will be public and can\'t be edited or deleted\n\t\t\t              </span>',p=x(),g=w("div"),(f=w("button")).textContent="Go Back",$=x(),(N=w("button")).textContent="Post",u.className="divider",h.className="column col-md-12 col-lg-10",f.className="btn",N.className="btn btn-primary",R(N,"loading",t.posting),g.className="column col-md-12 col-lg-2",d.className="columns",n.className="column col-md-12",C=[_(f,"click",t.click_handler),_(N,"click",t.post)]},m(e,t){v(e,n,t),b(n,o),b(n,r),T&&T.m(n,null),b(n,s),b(n,c),c.insertAdjacentHTML("afterend",P),b(n,i),b(n,l),b(n,u),b(n,m),b(n,d),b(d,h),b(d,p),b(d,g),b(g,f),b(g,$),b(g,N)},p(e,t){t.channel||t.root||t.branch?T?T.p(e,t):((T=Kt(t)).c(),T.m(n,s)):T&&(T.d(1),T=null),e.content&&P!==(P=t.ssb.markdown(t.content))&&(k(c,i),c.insertAdjacentHTML("afterend",P)),e.posting&&R(N,"loading",t.posting)},i:e,o:e,d(e){e&&y(n),T&&T.d(),a(C)}}}function Jt(n){var o,r,s,c,i,l,m,d,h,p,g,k,$,N,M,S,O,I,F,A,E,H,j=n.branch&&Zt(n),B=n.replyfeed&&en(n);return{c(){o=w("div"),(r=w("label")).textContent="Channel",s=x(),c=w("input"),i=x(),j&&j.c(),l=x(),B&&B.c(),m=x(),(d=w("label")).textContent="Message",h=x(),p=w("textarea"),g=x(),k=w("br"),$=x(),N=w("input"),M=x(),(S=w("button")).textContent="Attach File",O=x(),(I=w("button")).textContent="Preview",r.className="form-label",r.htmlFor="channel",c.className="form-input",T(c,"type","text"),c.id="channel",c.placeholder="channel",d.className="form-label",d.htmlFor="content",p.className="form-input svelte-1kmc4x",p.id="content",p.placeholder="Type in your post",p.rows="10",R(p,"file-on-top",n.fileOnTop),T(N,"type","file"),N.id="fileInput",N.className="svelte-1kmc4x",S.className="btn",I.className="btn btn-primary float-right",o.className="form-group",H=[_(c,"input",n.input0_input_handler),_(p,"input",n.textarea_input_handler),_(p,"dragover",P(C(n.dragOver))),_(p,"dragleave",P(C(n.dragLeave))),_(N,"input",n.attachFile),_(S,"click",n.attachFileTrigger),_(I,"click",n.preview)]},m(e,t){v(e,o,t),b(o,r),b(o,s),b(o,c),c.value=n.channel,b(o,i),j&&j.m(o,null),b(o,l),B&&B.m(o,null),b(o,m),b(o,d),b(o,h),b(o,p),p.value=n.content,b(o,g),b(o,k),b(o,$),b(o,N),b(o,M),b(o,S),b(o,O),b(o,I),E=!0},p(e,t){e.channel&&c.value!==t.channel&&(c.value=t.channel),t.branch?j?j.p(e,t):((j=Zt(t)).c(),j.m(o,l)):j&&(j.d(1),j=null),t.replyfeed?B?(B.p(e,t),B.i(1)):((B=en(t)).c(),B.i(1),B.m(o,m)):B&&(Z(),te(()=>{B.d(1),B=null}),B.o(1),ee()),e.content&&(p.value=t.content),e.fileOnTop&&R(p,"file-on-top",t.fileOnTop)},i(n){E||(B&&B.i(),W(()=>{A&&A.end(1),F||(F=function(n,o,r){let a,s,c=o(n,r),i=!1,l=0;function m(){a&&L(n,a)}function d(){const{delay:o=0,duration:r=300,easing:d=t,tick:h=e,css:p}=c;p&&(a=U(n,0,1,r,o,d,p,l++)),h(0,1);const g=u()+o,b=g+r;s&&s.abort(),i=!0,s=f(e=>{if(i){if(e>=b)return h(1,0),m(),i=!1;if(e>=g){const t=d((e-g)/r);h(t,1-t)}}return i})}let h=!1;return{start(){h||(L(n),"function"==typeof c?(c=c(),X().then(d)):d())},invalidate(){h=!1},end(){i&&(m(),i=!1)}}}(o,qt,{})),F.start()}),E=!0)},o(n){B&&B.o(),F&&F.invalidate(),n&&(A=function(n,o,r){let s,c=o(n,r),i=!0;const l=Q;function m(){const{delay:o=0,duration:r=300,easing:m=t,tick:d=e,css:h}=c;h&&(s=U(n,1,0,r,o,m,h));const p=u()+o,g=p+r;f(e=>{if(i){if(e>=g)return d(0,1),--l.remaining||a(l.callbacks),!1;if(e>=p){const t=m((e-p)/r);d(1-t,t)}}return i})}return l.remaining+=1,"function"==typeof c?X().then(()=>{c=c(),m()}):m(),{end(e){e&&c.tick&&c.tick(1,0),i&&(s&&L(n,s),i=!1)}}}(o,qt,{})),E=!1},d(e){e&&y(o),j&&j.d(),B&&B.d(),e&&A&&A.end(),a(H)}}}function Kt(e){var t,n,o,r=e.channel&&Gt(e),a=e.root&&Qt(e),s=e.branch&&Xt(e);return{c(){t=w("blockquote"),r&&r.c(),n=x(),a&&a.c(),o=x(),s&&s.c()},m(e,c){v(e,t,c),r&&r.m(t,null),b(t,n),a&&a.m(t,null),b(t,o),s&&s.m(t,null)},p(e,c){c.channel?r?r.p(e,c):((r=Gt(c)).c(),r.m(t,n)):r&&(r.d(1),r=null),c.root?a?a.p(e,c):((a=Qt(c)).c(),a.m(t,o)):a&&(a.d(1),a=null),c.branch?s?s.p(e,c):((s=Xt(c)).c(),s.m(t,null)):s&&(s.d(1),s=null)},d(e){e&&y(t),r&&r.d(),a&&a.d(),s&&s.d()}}}function Gt(e){var t,n,o,r,a=e.channel.startsWith("#")?e.channel.slice(1):e.channel;return{c(){t=w("p"),(n=w("b")).textContent="Channel:",o=x(),r=$(a)},m(e,a){v(e,t,a),b(t,n),b(t,o),b(t,r)},p(e,t){e.channel&&a!==(a=t.channel.startsWith("#")?t.channel.slice(1):t.channel)&&M(r,a)},d(e){e&&y(t)}}}function Qt(t){var n,o,r,a;return{c(){n=w("p"),(o=w("b")).textContent="Root:",r=x(),a=$(t.root)},m(e,t){v(e,n,t),b(n,o),b(n,r),b(n,a)},p:e,d(e){e&&y(n)}}}function Xt(e){var t,n,o,r;return{c(){t=w("p"),(n=w("b")).textContent="In Reply To:",o=x(),r=$(e.branch)},m(e,a){v(e,t,a),b(t,n),b(t,o),b(t,r)},p(e,t){e.branch&&M(r,t.branch)},d(e){e&&y(t)}}}function Zt(e){var t,n,o,r;return{c(){(t=w("label")).textContent="In reply to",n=x(),o=w("input"),t.className="form-label",t.htmlFor="reply-to",o.className="form-input",T(o,"type","text"),o.id="reply-to",o.placeholder="in reply to",r=_(o,"input",e.input_input_handler)},m(r,a){v(r,t,a),v(r,n,a),v(r,o,a),o.value=e.branch},p(e,t){e.branch&&o.value!==t.branch&&(o.value=t.branch)},d(e){e&&(y(t),y(n),y(o)),r()}}}function en(e){var t,n,o,r,a=new vt({props:{feed:e.replyfeed}});return a.$on("avatarClick",e.avatarClick),{c(){t=w("div"),n=w("span"),o=$("Click the avatar to add a link to the message:\n                "),a.$$.fragment.c(),t.className="mt-2"},m(e,s){v(e,t,s),b(t,n),b(n,o),ae(a,n,null),r=!0},p(e,t){var n={};e.replyfeed&&(n.feed=t.replyfeed),a.$set(n)},i(e){r||(a.$$.fragment.i(e),r=!0)},o(e){a.$$.fragment.o(e),r=!1},d(e){e&&y(t),a.$destroy()}}}function tn(e){var t,n,o,r,a,s,c,i,l=e.fork&&Dt(e),u=e.msg&&zt(e),m=[Jt,Wt],d=[];function h(e){return e.showPreview?1:0}return s=h(e),c=d[s]=m[s](e),{c(){t=w("div"),n=w("div"),o=w("div"),l&&l.c(),r=x(),u&&u.c(),a=x(),c.c(),o.className="column",n.className="columns",t.className="container"},m(e,c){v(e,t,c),b(t,n),b(n,o),l&&l.m(o,null),b(o,r),u&&u.m(o,null),b(o,a),d[s].m(o,null),i=!0},p(e,t){t.fork?l?l.p(e,t):((l=Dt(t)).c(),l.m(o,r)):l&&(l.d(1),l=null),t.msg?u?u.p(e,t):((u=zt(t)).c(),u.m(o,a)):u&&(u.d(1),u=null);var n=s;(s=h(t))===n?d[s].p(e,t):(Z(),te(()=>{d[n].d(1),d[n]=null}),c.o(1),ee(),(c=d[s])||(c=d[s]=m[s](t)).c(),c.i(1),c.m(o,null))},i(e){i||(c&&c.i(),i=!0)},o(e){c&&c.o(),i=!1},d(e){e&&y(t),l&&l.d(),u&&u.d(),d[s].d()}}}function nn(e,t,n){let o;i(e,Xn,e=>{n("$routeParams",o=e)});let r=!1,a=!1,s=!1,c=!1,l=o.root,u=o.branch,m=o.channel||"",d=o.content||"",h=o.replyfeed||!1,p=o.fork,g=!1,f=hermiebox.modules.pullStream,b=hermiebox.modules.pullFileReader,v=hermiebox.sbot;document.title="Patchfox - compose",E(()=>{n("error",s=!1),n("msg",a=""),jt(document.getElementById("content"),e=>y(e))});const y=e=>{if(n("error",s=!1),n("msg",a=""),0==e.length)return n("fileOnTop",g=!1),console.log("this is not a file"),!1;var t=e[0];return console.log(t),t.type.startsWith("image")?t.size>=5e6?(n("error",s=!0),n("msg",a=`File too large: ${Math.floor(t.size/1048576,2)}mb when max size is 5mb`),!1):void f(b(t),v.blobs.add(function(e,o){e?(n("error",s=!0),n("msg",a="Couldn't attach file: "+e)):n("content",d+=` ![${t.name}](${o})`),n("fileOnTop",g=!1)})):(n("error",s=!0),n("msg",a=`You can only drag & drop image, this file is a ${t.type}`),!1)};return{showPreview:r,msg:a,error:s,posting:c,root:l,branch:u,channel:m,content:d,replyfeed:h,fork:p,fileOnTop:g,post:async e=>{if(e.stopPropagation(),e.preventDefault(),!c){n("posting",c=!0),m.startsWith("#")&&n("channel",m=m.slice(1));try{n("msg",a=await ssb.newPost({text:d,channel:m,root:l,branch:u,fork:p})),n("posting",c=!1),console.log("posted",a),window.scrollTo(0,0)}catch(e){n("error",s=!0),n("msg",a=`Couldn't post your message: ${e}`),window.scrollTo(0,0),"stream is closed"==a.message&&(n("msg",a+=". We lost connection to sbot. We'll try to restablish it..."),ro().then(()=>{n("showPreview",r=!1),n("posting",c=!1),n("error",s=!1),n("msg",a="Connection to sbot reestablished. Try posting again")}).catch(e=>{window.location.search=`?root=${encodeURIComponent(l)}&branch=${encodeURIComponent(u)}&content=${encodeURIComponent(d)}&channel=${encodeURIComponent(m)}`,n("msg",a=`Sorry, couldn't reconnect to sbot:${e}. Try reloading the page. Your content has been saved to the URL`)}))}}},preview:e=>{n("showPreview",r=!0)},avatarClick:e=>{let t=e.detail.feed,o=e.detail.name;d.length>0?n("content",d+=` [${o}](${t})`):n("content",d=`[${o}](${t})`)},dragOver:e=>{n("fileOnTop",g=!0)},dragLeave:e=>{n("fileOnTop",g=!1)},attachFileTrigger:()=>{document.getElementById("fileInput").click()},attachFile:e=>{const t=e.target.files;y(t)},ssb:ssb,encodeURIComponent:encodeURIComponent,input0_input_handler:function(){m=this.value,n("channel",m)},input_input_handler:function(){u=this.value,n("branch",u)},textarea_input_handler:function(){d=this.value,n("content",d)},click_handler:function(){const e=r=!1;return n("showPreview",r),e}}}function on(e,t,n){const o=Object.create(e);return o.msg=t[n],o}function rn(e){var t,n,o,r,a,s,c;return{c(){t=w("div"),n=$("Couldn't load thead\n    "),o=w("a"),r=$(e.msgid),s=$("\n    : "),c=$(e.error),o.href=a="?thread="+e.msgid+"#/thread",t.className="toast toast-error"},m(e,a){v(e,t,a),b(t,n),b(t,o),b(o,r),b(t,s),b(t,c)},p(e,t){e.msgid&&M(r,t.msgid),e.msgid&&a!==(a="?thread="+t.msgid+"#/thread")&&(o.href=a),e.error&&M(c,t.error)},d(e){e&&y(t)}}}function an(e){var t,n,o=[],r=new Map,a=e.msgs;const s=e=>e.msg.key;for(var c=0;c<a.length;c+=1){let t=on(e,a,c),n=s(t);r.set(n,o[c]=cn(n,t))}return{c(){for(c=0;c<o.length;c+=1)o[c].c();t=N()},m(e,r){for(c=0;c<o.length;c+=1)o[c].m(e,r);v(e,t,r),n=!0},p(e,n){const a=n.msgs;Z(),o=re(o,e,s,1,n,a,r,t.parentNode,oe,cn,t,on),ee()},i(e){if(!n){for(var t=0;t<a.length;t+=1)o[t].i();n=!0}},o(e){for(c=0;c<o.length;c+=1)o[c].o();n=!1},d(e){for(c=0;c<o.length;c+=1)o[c].d(e);e&&y(t)}}}function sn(t){var n;return{c(){(n=w("div")).className="loading loading-lg"},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function cn(e,t){var n,o,r=new Rt({props:{msg:t.msg}});return{key:e,first:null,c(){n=N(),r.$$.fragment.c(),this.first=n},m(e,t){v(e,n,t),ae(r,e,t),o=!0},p(e,t){var n={};e.msgs&&(n.msg=t.msg),r.$set(n)},i(e){o||(r.$$.fragment.i(e),o=!0)},o(e){r.$$.fragment.o(e),o=!1},d(e){e&&y(n),r.$destroy(e)}}}function ln(e){var t,n,o,r,a,s,c,i,l,u,m,d=e.error&&rn(e),h=[sn,an],p=[];function g(e){return e.msgs||e.error?1:0}return i=g(e),l=p[i]=h[i](e),{c(){t=w("div"),n=w("h4"),o=$("Thread\n    "),r=w("small"),a=$(e.msgid),s=x(),d&&d.c(),c=x(),l.c(),u=N(),r.className="label hide-sm",t.className="container"},m(e,l){v(e,t,l),b(t,n),b(n,o),b(n,r),b(r,a),v(e,s,l),d&&d.m(e,l),v(e,c,l),p[i].m(e,l),v(e,u,l),m=!0},p(e,t){m&&!e.msgid||M(a,t.msgid),t.error?d?d.p(e,t):((d=rn(t)).c(),d.m(c.parentNode,c)):d&&(d.d(1),d=null);var n=i;(i=g(t))===n?p[i].p(e,t):(Z(),te(()=>{p[n].d(1),p[n]=null}),l.o(1),ee(),(l=p[i])||(l=p[i]=h[i](t)).c(),l.i(1),l.m(u.parentNode,u))},i(e){m||(l&&l.i(),m=!0)},o(e){l&&l.o(),m=!1},d(e){e&&(y(t),y(s)),d&&d.d(e),e&&y(c),p[i].d(e),e&&y(u)}}}function un(e,t,n){let o;i(e,Xn,e=>{n("$routeParams",o=e)});let r,a=!1,s=!1;return e.$$.update=((e={$routeParams:1,msgid:1})=>{if(e.$routeParams||e.msgid){n("msgid",r=o.thread),r.startsWith("ssb:")&&n("msgid",r=r.replace("ssb:","")),document.title=`Patchfox - Thread: ${r}`;ssb.thread(r).then(e=>{n("msgs",a=e),window.scrollTo(0,0)}).catch(e=>{console.dir(e),n("error",s=e.message)})}}),{msgs:a,error:s,msgid:r}}function mn(e,t,n){const o=Object.create(e);return o.msg=t[n],o}function dn(t){var n,o,r,a=t.n.message;return{c(){n=w("p"),o=$("Error: "),r=$(a)},m(e,t){v(e,n,t),b(n,o),b(n,r)},p:e,i:e,o:e,d(e){e&&y(n)}}}function hn(e){var t,o,r,a,s,c,i,l,u,m,d,h,p,g,f,k,N=e.ssb.markdown(e.description),_=e.feed!==e.ssb.feed&&pn(e);let C={ctx:e,current:null,pending:vn,then:fn,catch:gn,value:"data",error:"n",blocks:Array(3)};return ne(f=e.messagePromise,C),{c(){t=w("div"),o=w("div"),r=w("div"),a=w("img"),c=x(),i=w("div"),l=w("h1"),u=$(e.name),m=x(),_&&_.c(),d=x(),h=w("p"),p=x(),g=w("div"),C.block.c(),a.className="img-responsive",a.src=s="http://localhost:8989/blobs/get/"+e.image,a.alt=e.feed,r.className="container",o.className="column col-6",i.className="column col-6",t.className="columns"},m(e,n){v(e,t,n),b(t,o),b(o,r),b(r,a),b(t,c),b(t,i),b(i,l),b(l,u),b(i,m),_&&_.m(i,null),b(i,d),b(i,h),h.innerHTML=N,v(e,p,n),v(e,g,n),C.block.m(g,C.anchor=null),C.mount=(()=>g),C.anchor=null,k=!0},p(t,o){e=o,k&&!t.image||s===(s="http://localhost:8989/blobs/get/"+e.image)||(a.src=s),k&&!t.feed||(a.alt=e.feed),k&&!t.name||M(u,e.name),e.feed!==e.ssb.feed?_?_.p(t,e):((_=pn(e)).c(),_.m(i,d)):_&&(_.d(1),_=null),k&&!t.description||N===(N=e.ssb.markdown(e.description))||(h.innerHTML=N),C.ctx=e,"messagePromise"in t&&f!==(f=e.messagePromise)&&ne(f,C)||C.block.p(t,n(n({},e),C.resolved))},i(e){k||(C.block.i(),k=!0)},o(e){for(let e=0;e<3;e+=1){const t=C.blocks[e];t&&t.o()}k=!1},d(e){e&&y(t),_&&_.d(),e&&(y(p),y(g)),C.block.d(),C=null}}}function pn(e){var t,n,o,r,s,c,i,l,u,m,d,h,p,g,f,k,N,C;return{c(){t=w("div"),n=w("div"),o=x(),r=w("div"),s=w("label"),c=w("input"),i=x(),l=w("i"),u=$("\n                following"),m=x(),d=w("label"),h=w("input"),p=x(),g=w("i"),f=$("\n                blocking"),k=x(),N=w("div"),n.className="divider",T(c,"type","checkbox"),l.className="form-icon",s.className="form-switch form-inline",T(h,"type","checkbox"),g.className="form-icon",d.className="form-switch form-inline",r.className="form-group",N.className="divider",t.className="container",C=[_(c,"change",e.input0_change_handler),_(c,"change",e.followingChanged),_(h,"change",e.input1_change_handler),_(h,"change",e.blockingChanged)]},m(a,y){v(a,t,y),b(t,n),b(t,o),b(t,r),b(r,s),b(s,c),c.checked=e.following,b(s,i),b(s,l),b(s,u),b(r,m),b(r,d),b(d,h),h.checked=e.blocking,b(d,p),b(d,g),b(d,f),b(t,k),b(t,N)},p(e,t){e.following&&(c.checked=t.following),e.blocking&&(h.checked=t.blocking)},d(e){e&&y(t),a(C)}}}function gn(t){var n,o,r,a=t.n.message;return{c(){n=w("p"),o=$("Error fetching messages: "),r=$(a)},m(e,t){v(e,n,t),b(n,o),b(n,r)},p(e,t){e.messagePromise&&a!==(a=t.n.message)&&M(r,a)},i:e,o:e,d(e){e&&y(n)}}}function fn(e){var t,n,o,r,a,s,c=[],i=new Map,l=e.lastMsgs;const u=e=>e.msg.key;for(var m=0;m<l.length;m+=1){let t=mn(e,l,m),n=u(t);i.set(n,c[m]=bn(n,t))}return{c(){for(m=0;m<c.length;m+=1)c[m].c();t=x(),n=w("ul"),o=w("li"),(r=w("a")).innerHTML='<div class="page-item-subtitle">Load More</div>',r.href="#/public",o.className="page-item page-next",n.className="pagination",s=_(r,"click",P(C(e.click_handler)))},m(e,s){for(m=0;m<c.length;m+=1)c[m].m(e,s);v(e,t,s),v(e,n,s),b(n,o),b(o,r),a=!0},p(e,n){const o=n.lastMsgs;Z(),c=re(c,e,u,1,n,o,i,t.parentNode,oe,bn,t,mn),ee()},i(e){if(!a){for(var t=0;t<l.length;t+=1)c[t].i();a=!0}},o(e){for(m=0;m<c.length;m+=1)c[m].o();a=!1},d(e){for(m=0;m<c.length;m+=1)c[m].d(e);e&&(y(t),y(n)),s()}}}function bn(e,t){var n,o,r=new Rt({props:{msg:t.msg}});return{key:e,first:null,c(){n=N(),r.$$.fragment.c(),this.first=n},m(e,t){v(e,n,t),ae(r,e,t),o=!0},p(e,t){var n={};e.lastMsgs&&(n.msg=t.msg),r.$set(n)},i(e){o||(r.$$.fragment.i(e),o=!0)},o(e){r.$$.fragment.o(e),o=!1},d(e){e&&y(n),r.$destroy(e)}}}function vn(t){var n;return{c(){(n=w("div")).className="loading"},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function yn(t){var n;return{c(){(n=w("div")).className="loading loading-lg"},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function kn(e){var t,o,r;let a={ctx:e,current:null,pending:yn,then:hn,catch:dn,value:"null",error:"n",blocks:Array(3)};return ne(o=e.aboutPromise&&e.avatarPromise,a),{c(){t=w("div"),a.block.c(),t.className="container"},m(e,n){v(e,t,n),a.block.m(t,a.anchor=null),a.mount=(()=>t),a.anchor=null,r=!0},p(t,r){e=r,a.ctx=e,o!==(o=e.aboutPromise&&e.avatarPromise)&&ne(o,a)||a.block.p(t,n(n({},e),a.resolved))},i(e){r||(a.block.i(),r=!0)},o(e){for(let e=0;e<3;e+=1){const t=a.blocks[e];t&&t.o()}r=!1},d(e){e&&y(t),a.block.d(),a=null}}}function wn(e,t,n){let o;i(e,Xn,e=>{n("$routeParams",o=e)});let r,a,s,c=!1,l=!1,u=!1,m=[];n("feed",a=o.feed),a||n("feed",a=ssb.feed);let d=a;document.title=`Patchfox - Feed: ${a}`,console.log("fetching",a);let h=ssb.avatar(a).then(e=>{n("name",d=e.name),n("image",r=e.image),document.title=`Patchfox - Feed: ${d}`}),p=ssb.profile(a).then(e=>{s=e.about.reverse().find(e=>{return e.value.content.hasOwnProperty("description")});try{n("description",c=s.value.content.description)}catch(e){n("description",c="")}window.scrollTo(0,0)}),g=ssb.query({value:{author:a}},10).then(e=>{n("lastMsgs",m=e),window.scrollTo(0,0)});a!==ssb.feed&&(ssb.following(a).then(e=>{const t=l=e;return n("following",l),t}),ssb.blocking(a).then(e=>{const t=u=e;return n("blocking",u),t}));const f=e=>{n("messagePromise",g=ssb.query({value:{author:a,timestamp:{$lt:e}}},10).then(e=>{n("lastMsgs",m=e),window.scrollTo(0,0)}))};return{description:c,following:l,blocking:u,image:r,feed:a,lastMsgs:m,name:d,avatarPromise:h,aboutPromise:p,messagePromise:g,blockingChanged:e=>{e.target.checked?ssb.block(a).catch(()=>{const e=u=!1;return n("blocking",u),e}):ssb.unblock(a).catch(()=>{const e=u=!0;return n("blocking",u),e})},followingChanged:e=>{e.target.checked?ssb.follow(a).catch(()=>{const e=l=!1;return n("following",l),e}):ssb.unfollow(a).catch(()=>{const e=l=!0;return n("following",l),e})},loadMoreMessages:f,ssb:ssb,input0_change_handler:function(){l=this.checked,n("following",l)},input1_change_handler:function(){u=this.checked,n("blocking",u)},click_handler:function(){f(m[m.length-1].timestamp)}}}function $n(e){var t,n,o;return{c(){t=w("div"),n=$(e.msg),t.className=o="toast "+e.toastClass},m(e,o){v(e,t,o),b(t,n)},p(e,r){e.msg&&M(n,r.msg),e.toastClass&&o!==(o="toast "+r.toastClass)&&(t.className=o)},d(e){e&&y(t)}}}function xn(e){var t,n,o,r,a=e.cta.label;return{c(){t=w("li"),n=w("a"),o=$(a),n.href="#",r=_(n,"click",P(C(e.cta.action)))},m(e,r){v(e,t,r),b(t,n),b(n,o)},p(e,t){e.cta&&a!==(a=t.cta.label)&&M(o,a)},d(e){e&&y(t),r()}}}function Nn(t){var n,o,r,a,s,c,i,l,u,m,d,h,p,g,f,k,N,_=t.toast&&$n(t),C=t.cta&&xn(t);return{c(){n=w("div"),(o=w("h1")).textContent="ðŸ˜¿ An Error Has Occurred, sorry ðŸ˜­",r=x(),_&&_.c(),a=x(),(s=w("h4")).textContent="This is what we know about it",c=x(),i=w("pre"),l=w("code"),u=$(t.error),m=x(),(d=w("p")).textContent="You might want to:",h=x(),p=w("ul"),C&&C.c(),g=x(),(f=w("li")).innerHTML='<a href="/docs/index.html#/troubleshooting/" target="_blank">\n\t\t\t        Open our troubleshooting documentation.\n\t\t\t      </a>',k=x(),(N=w("li")).innerHTML='<a href="https://github.com/soapdog/patchfox/issues" target="_blank">\n\t\t\t        Add an issue\n\t\t\t      </a>\n\t\t\t      to the Patchfox repository.\n\t\t\t    ',i.className="code",n.className="container"},m(e,t){v(e,n,t),b(n,o),b(n,r),_&&_.m(n,null),b(n,a),b(n,s),b(n,c),b(n,i),b(i,l),b(l,u),b(n,m),b(n,d),b(n,h),b(n,p),C&&C.m(p,null),b(p,g),b(p,f),b(p,k),b(p,N)},p(e,t){t.toast?_?_.p(e,t):((_=$n(t)).c(),_.m(n,a)):_&&(_.d(1),_=null),e.error&&M(u,t.error),t.cta?C?C.p(e,t):((C=xn(t)).c(),C.m(p,g)):C&&(C.d(1),C=null)},i:e,o:e,d(e){e&&y(n),_&&_.d(),C&&C.d()}}}function _n(e,t,n){let o;i(e,Xn,e=>{n("$routeParams",o=e)}),document.title="Patchfox - Error";let r,a=o.error,s={},c="",l=!1,u=!1;"object"==typeof a&&n("error",a=(s=a).message);let m={"Error: stream is closed":{label:"Want to try to reconnect?",action:()=>{n("toast",l=!0),n("toastClass",c="toast-warning"),n("msg",r="Attempting to reconnect to sbot..."),ro().then(()=>{n("toastClass",c="toast-success"),n("toast",l=!0),n("msg",r="Connection to sbot reestablished. Try going to your public feed.")}).catch(e=>{n("toastClass",c="toast-error"),n("toast",l=!0),n("msg",r="Couldn't reconnect. Try reloading the page.")})}}};return m.hasOwnProperty(a)&&n("cta",u=m[a]),{error:a,toastClass:c,toast:l,msg:r,cta:u}}function Cn(e,t,n){const o=Object.create(e);return o.c=t[n],o}function Pn(e){for(var t,n=e.subscribedChannels,o=[],r=0;r<n.length;r+=1)o[r]=Mn(Cn(e,n,r));return{c(){for(var e=0;e<o.length;e+=1)o[e].c();t=N()},m(e,n){for(var r=0;r<o.length;r+=1)o[r].m(e,n);v(e,t,n)},p(e,r){if(e.subscribedChannels){n=r.subscribedChannels;for(var a=0;a<n.length;a+=1){const s=Cn(r,n,a);o[a]?o[a].p(e,s):(o[a]=Mn(s),o[a].c(),o[a].m(t.parentNode,t))}for(;a<o.length;a+=1)o[a].d(1);o.length=n.length}},d(e){!function(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}(o,e),e&&y(t)}}}function Tn(t){var n,o,r;return{c(){n=w("div"),o=x(),(r=w("p")).textContent="This is a complex query, it might take a while... Channels will appear as we find them",n.className="loading"},m(e,t){v(e,n,t),v(e,o,t),v(e,r,t)},p:e,d(e){e&&(y(n),y(o),y(r))}}}function Mn(e){var t,n,o,r,a,s=e.c;function c(){return e.click_handler(e)}return{c(){t=w("span"),n=$("#"),o=$(s),r=x(),t.className="channel label label-secondary m-1 svelte-wpma9q",a=_(t,"click",c)},m(e,a){v(e,t,a),b(t,n),b(t,o),b(t,r)},p(t,n){e=n,t.subscribedChannels&&s!==(s=e.c)&&M(o,s)},d(e){e&&y(t),a()}}}function Rn(t){var n,o,r;function a(e){return 0==e.subscribedChannels.length?Tn:Pn}var s=a(t),c=s(t);return{c(){(n=w("h4")).textContent="Subscribed Channels",o=x(),c.c(),r=N()},m(e,t){v(e,n,t),v(e,o,t),c.m(e,t),v(e,r,t)},p(e,t){s===(s=a(t))&&c?c.p(e,t):(c.d(1),(c=s(t))&&(c.c(),c.m(r.parentNode,r)))},i:e,o:e,d(e){e&&(y(n),y(o)),c.d(e),e&&y(r)}}}function Sn(e,t,n){let o=[],r=hermiebox.modules.pullStream,a=hermiebox.sbot;return(()=>{let e={$filter:{value:{author:a.id,content:{type:"channel"}}},$sort:[["value","timestamp"]]};r(a.query.read({query:[e],live:!0,reverse:!0,limit:500}),r.drain(e=>{e.sync?console.log("finished loading"):e.value.content.subscribed&&(o.push(e.value.content.channel),n("subscribedChannels",o))}))})(),{subscribedChannels:o,click_handler:function({c:e}){return eo("/channel",{channel:e})}}}function On(e,t,n){const o=Object.create(e);return o.msg=t[n],o}function In(t){var n,o,r;return{c(){n=w("div"),o=$("Error: "),r=$(t.error),n.className="toast toast-error"},m(e,t){v(e,n,t),b(n,o),b(n,r)},p:e,d(e){e&&y(n)}}}function Un(e){var t,n,o,r,s,c,i,l,u,m=[],d=new Map,h=e.msgs;const p=e=>e.msg.key;for(var g=0;g<h.length;g+=1){let t=On(e,h,g),n=p(t);d.set(n,m[g]=An(n,t))}var f=null;return h.length||(f=Fn(e)).c(),{c(){for(g=0;g<m.length;g+=1)m[g].c();t=x(),n=w("ul"),o=w("li"),(r=w("a")).innerHTML='<div class="page-item-subtitle">Previous</div>',s=x(),c=w("li"),(i=w("a")).innerHTML='<div class="page-item-subtitle">Next</div>',r.href="#/public",o.className="page-item page-previous",i.href="#/public",c.className="page-item page-next",n.className="pagination",u=[_(r,"click",P(C(e.goPrevious))),_(i,"click",P(C(e.goNext)))]},m(e,a){for(g=0;g<m.length;g+=1)m[g].m(e,a);f&&f.m(e,null),v(e,t,a),v(e,n,a),b(n,o),b(o,r),b(n,s),b(n,c),b(c,i),l=!0},p(e,n){const o=n.msgs;Z(),m=re(m,e,p,1,n,o,d,t.parentNode,oe,An,t,On),ee(),o.length?f&&(f.d(1),f=null):f||((f=Fn(n)).c(),f.m(t.parentNode,t))},i(e){if(!l){for(var t=0;t<h.length;t+=1)m[t].i();l=!0}},o(e){for(g=0;g<m.length;g+=1)m[g].o();l=!1},d(e){for(g=0;g<m.length;g+=1)m[g].d(e);f&&f.d(e),e&&(y(t),y(n)),a(u)}}}function Ln(t){var n;return{c(){(n=w("div")).className="loading loading-lg"},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Fn(e){var t;return{c(){(t=w("p")).textContent="No messages."},m(e,n){v(e,t,n)},d(e){e&&y(t)}}}function An(e,t){var n,o,r=new Rt({props:{msg:t.msg}});return{key:e,first:null,c(){n=N(),r.$$.fragment.c(),this.first=n},m(e,t){v(e,n,t),ae(r,e,t),o=!0},p(e,t){var n={};e.msgs&&(n.msg=t.msg),r.$set(n)},i(e){o||(r.$$.fragment.i(e),o=!0)},o(e){r.$$.fragment.o(e),o=!1},d(e){e&&y(n),r.$destroy(e)}}}function En(e){var t,n,o,r,s,c,i,l,u,m,d,h,p,g,f,k,C,P,M,R=e.error&&In(e),S=[Ln,Un],O=[];function I(e){return e.msgs?1:0}return f=I(e),k=O[f]=S[f](e),{c(){t=w("div"),n=w("div"),o=w("h4"),r=$("Channel: #"),s=$(e.channel),c=x(),i=w("div"),l=w("label"),u=w("input"),m=x(),d=w("i"),h=$("\n        Subscribe"),p=x(),R&&R.c(),g=x(),k.c(),C=N(),o.className="column",T(u,"type","checkbox"),d.className="form-icon",l.className="form-switch float-right",i.className="column",n.className="columns",t.className="container",M=[_(u,"change",e.input_change_handler),_(u,"change",e.subscriptionChanged)]},m(a,y){v(a,t,y),b(t,n),b(n,o),b(o,r),b(o,s),b(n,c),b(n,i),b(i,l),b(l,u),u.checked=e.subscribed,b(l,m),b(l,d),b(l,h),v(a,p,y),R&&R.m(a,y),v(a,g,y),O[f].m(a,y),v(a,C,y),P=!0},p(e,t){e.subscribed&&(u.checked=t.subscribed),t.error?R?R.p(e,t):((R=In(t)).c(),R.m(g.parentNode,g)):R&&(R.d(1),R=null);var n=f;(f=I(t))===n?O[f].p(e,t):(Z(),te(()=>{O[n].d(1),O[n]=null}),k.o(1),ee(),(k=O[f])||(k=O[f]=S[f](t)).c(),k.i(1),k.m(C.parentNode,C))},i(e){P||(k&&k.i(),P=!0)},o(e){k&&k.o(),P=!1},d(e){e&&(y(t),y(p)),R&&R.d(e),e&&y(g),O[f].d(e),e&&y(C),a(M)}}}function Hn(e,t,n){let o;i(e,Xn,e=>{n("$routeParams",o=e)});let r=!1,a=o.error||!1,s=o.channel||!1,c=!1;s||(console.log("can't navigate to unnamed channel, going back to public"),location="index.html#/public");let l={limit:o.limit||so("limit",10),reverse:!0};ssb.channelSubscribed(s).then(e=>{const t=c=e;return n("subscribed",c),t});const u=()=>{eo("/channel",{channel:s,lt:r[r.length-1].rts})},m=()=>{history.back()};let d=keymage("p",()=>(m(),!1)),h=keymage("n",()=>(u(),!1));return H(()=>{d(),h()}),e.$$.update=((e={opts:1,$routeParams:1,channel:1,error:1})=>{if(e.opts||e.$routeParams||e.channel||e.error){Object.assign(l,o),document.title=`Patchfox - #${s}`,l.hasOwnProperty("lt")&&(l.lt=parseInt(l.lt),n("opts",l),n("$routeParams",o),n("channel",s),n("error",a)),l.hasOwnProperty("limit")&&(l.limit=parseInt(l.limit),n("opts",l),n("$routeParams",o),n("channel",s),n("error",a));ssb.channel(s,l).then(e=>{console.log("msg",e),n("msgs",r=e),window.scrollTo(0,0)}).catch(e=>{a||console.error("errrrooooor",e)})}}),{msgs:r,error:a,channel:s,subscribed:c,subscriptionChanged:e=>{e.target.checked?ssb.channelSubscribe(s).catch(()=>{const e=c=!1;return n("subscribed",c),e}):ssb.channelUnsubscribe(s).catch(()=>{const e=c=!0;return n("subscribed",c),e})},goNext:u,goPrevious:m,input_change_handler:function(){c=this.checked,n("subscribed",c)}}}function jn(t){var n,o,r,s,c,i,l,u,m,d,h,p,g,f,k,N,C,P,M,R,S,O,I,U,L,F,A,E,H,j,B,q,D,z,Y,V,W,J,K,G,Q,X,Z,ee,te,ne,oe,re,ae,se,ce,ie,le,ue,me,de,he,pe,ge,fe,be,ve,ye,ke,we,$e,xe,Ne,_e,Ce,Pe,Te,Me,Re,Se,Oe,Ie,Ue,Le,Fe,Ae,Ee,He,je,Be,qe,De,ze,Ye,Ve,We,Je,Ke,Ge,Qe,Xe,Ze,et,tt,nt,ot,rt,at,st,ct,it,lt,ut,mt,dt,ht,pt,gt,ft,bt,vt,yt,kt,wt,$t,xt,Nt,_t,Ct,Pt,Tt,Mt,Rt,St,Ot,It,Ut;return{c(){(n=w("h1")).textContent="Settings",o=x(),(r=w("p")).innerHTML="\n\t\t\t  Settings changes are saved as you make them except for identity and connection\n\t\t\t  changes, those require a full page reload and thus you need to press a save\n\t\t\t  button. The reason behind this is that Patchfox needs to disconnect and\n\t\t\t  reconnect to the\n\t\t\t  <i>ssb-server</i>\n\t\t\t  using the new info.\n\t\t\t",s=x(),(c=w("p")).innerHTML='<b>\n\t\t\t    You can\'t use Patchfox until you fill your\n\t\t\t    <i>Connection &amp; Identity</i>\n\t\t\t    information.\n\t\t\t    <a href="/docs/index.html#/troubleshooting/no-configuration" target="_blank">\n\t\t\t      If you want more help regarding connection and configuration click here\n\t\t\t    </a>\n\t\t\t    .\n\t\t\t  </b>',i=x(),(l=w("h4")).textContent="Connection & Identity",u=x(),m=w("form"),(d=w("label")).innerHTML="\n\t\t\t    Patchfox can infer the values for both\n\t\t\t    <i>remote</i>\n\t\t\t    and\n\t\t\t    <i>secret</i>\n\t\t\t    from your\n\t\t\t    <code>~/.ssb/secret</code>\n\t\t\t    file. You can use the button below to browse for it.\n\t\t\t  ",h=x(),p=w("input"),g=x(),(f=w("label")).textContent="Remote",k=x(),N=w("input"),C=x(),(P=w("label")).textContent="Secret",M=x(),R=w("textarea"),S=x(),O=w("br"),I=x(),(U=w("button")).textContent="Save Identity & Remote",L=x(),(F=w("p")).textContent="Saving identity and remote will cause a full page refresh.",A=x(),(E=w("h4")).textContent="Vieweing Experience",H=x(),j=w("form"),(B=w("label")).textContent="Messages per page",q=x(),D=w("input"),z=x(),Y=w("br"),V=x(),(W=w("span")).innerHTML='\n\t\t\t    Which message types you want to see?\n\t\t\t    <a target="_blank" href="/docs/index.html#/message_types/">\n\t\t\t      Click here for more information about\n\t\t\t      <i>Message Types</i></a>',J=x(),K=w("label"),G=w("input"),Q=x(),X=w("i"),Z=x(),(ee=w("b")).textContent="About",te=$("\n    (aka people setting avatars and descriptions; gatherings)"),ne=x(),oe=w("label"),re=w("input"),ae=x(),se=w("i"),ce=x(),(ie=w("b")).textContent="Blog",le=$("\n    (Longform text posts)"),ue=x(),me=w("label"),de=w("input"),he=x(),pe=w("i"),ge=x(),(fe=w("b")).textContent="Channel",be=$("\n    (People subscribing to channels)"),ve=x(),ye=w("label"),ke=w("input"),we=x(),$e=w("i"),xe=x(),(Ne=w("b")).textContent="Contact",_e=$("\n    (People following each other)"),Ce=x(),Pe=w("label"),Te=w("input"),Me=x(),Re=w("i"),Se=x(),(Oe=w("b")).textContent="Posts",Ie=$("\n    (Common content post, leave this on or it is not that fun)"),Ue=x(),Le=w("label"),Fe=w("input"),Ae=x(),Ee=w("i"),He=x(),(je=w("b")).textContent="Pub",Be=$("\n    (Pub servers announcements)"),qe=x(),De=w("label"),ze=w("input"),Ye=x(),Ve=w("i"),We=x(),(Je=w("b")).textContent="Private",Ke=$("\n    (Private messages; You won't be able to read them, but you'll see their\n    encrypted content passing by)"),Ge=x(),Qe=w("label"),Xe=w("input"),Ze=x(),et=w("i"),tt=x(),(nt=w("b")).textContent="Vote",ot=$("\n    (People liking/digging stuff)"),rt=x(),at=w("div"),st=x(),ct=w("label"),it=w("input"),lt=x(),ut=w("i"),mt=x(),(dt=w("b")).textContent="Unknown",ht=$("\n    (Show messages Patchfox doesn't understand as their raw content)"),pt=x(),gt=w("br"),ft=x(),(bt=w("label")).textContent="Feed column size. There is research that says that a short column size makes\n    for a more pleasant reading experience, still some users prefer to use the\n    full screen space. Your choice is between reading through long text lines or\n    short ones.",vt=x(),yt=w("label"),kt=w("input"),wt=x(),$t=w("i"),xt=$("\n    Short column"),Nt=x(),_t=w("label"),Ct=w("input"),Pt=x(),Tt=w("i"),Mt=$("\n    Long column"),Rt=x(),St=w("br"),Ot=x(),It=w("br"),d.className="form-label",d.htmlFor="secret-file",T(p,"type","file"),p.className="form-input",p.id="secret-file",f.className="form-label",f.htmlFor="remote",N.className="form-input",T(N,"type","text"),N.id="remote",N.placeholder="remote",P.className="form-label",P.htmlFor="secret",R.className="form-input",R.id="secret",R.placeholder="Your secret",R.rows="8",U.className="btn btn-primary float-right",m.className="form-group",B.className="form-label",B.htmlFor="limit",D.className="form-input",T(D,"type","number"),T(G,"type","checkbox"),X.className="form-icon",K.className="form-switch",T(re,"type","checkbox"),se.className="form-icon",oe.className="form-switch",T(de,"type","checkbox"),pe.className="form-icon",me.className="form-switch",T(ke,"type","checkbox"),$e.className="form-icon",ye.className="form-switch",T(Te,"type","checkbox"),Re.className="form-icon",Pe.className="form-switch",T(Fe,"type","checkbox"),Ee.className="form-icon",Le.className="form-switch",T(ze,"type","checkbox"),Ve.className="form-icon",De.className="form-switch",T(Xe,"type","checkbox"),et.className="form-icon",Qe.className="form-switch",at.className="divider",T(it,"type","checkbox"),ut.className="form-icon",ct.className="form-switch",bt.className="form-label",t.$$binding_groups[0].push(kt),T(kt,"type","radio"),kt.name="column-size",kt.__value="short",kt.value=kt.__value,$t.className="form-icon",yt.className="form-radio",t.$$binding_groups[0].push(Ct),T(Ct,"type","radio"),Ct.name="column-size",Ct.__value="long",Ct.value=Ct.__value,Tt.className="form-icon",_t.className="form-radio",j.className="form-group",Ut=[_(p,"change",t.selectedFile),_(N,"input",t.input1_input_handler),_(R,"input",t.textarea_input_handler),_(U,"click",t.saveConfiguration),_(D,"input",t.input2_input_handler),_(D,"change",t.change_handler),_(G,"change",t.input3_change_handler),_(G,"change",t.change_handler_1),_(re,"change",t.input4_change_handler),_(re,"change",t.change_handler_2),_(de,"change",t.input5_change_handler),_(de,"change",t.change_handler_3),_(ke,"change",t.input6_change_handler),_(ke,"change",t.change_handler_4),_(Te,"change",t.input7_change_handler),_(Te,"change",t.change_handler_5),_(Fe,"change",t.input8_change_handler),_(Fe,"change",t.change_handler_6),_(ze,"change",t.input9_change_handler),_(ze,"change",t.change_handler_7),_(Xe,"change",t.input10_change_handler),_(Xe,"change",t.change_handler_8),_(it,"change",t.input11_change_handler),_(it,"change",t.change_handler_9),_(kt,"change",t.input12_change_handler),_(kt,"change",t.change_handler_10),_(Ct,"change",t.input13_change_handler),_(Ct,"change",t.change_handler_11)]},m(e,a){v(e,n,a),v(e,o,a),v(e,r,a),v(e,s,a),v(e,c,a),v(e,i,a),v(e,l,a),v(e,u,a),v(e,m,a),b(m,d),b(m,h),b(m,p),b(m,g),b(m,f),b(m,k),b(m,N),N.value=t.remote,b(m,C),b(m,P),b(m,M),b(m,R),R.value=t.keys,b(m,S),b(m,O),b(m,I),b(m,U),b(m,L),b(m,F),v(e,A,a),v(e,E,a),v(e,H,a),v(e,j,a),b(j,B),b(j,q),b(j,D),D.value=t.limit,b(j,z),b(j,Y),b(j,V),b(j,W),b(j,J),b(j,K),b(K,G),G.checked=t.showTypeAbout,b(K,Q),b(K,X),b(K,Z),b(K,ee),b(K,te),b(j,ne),b(j,oe),b(oe,re),re.checked=t.showTypeBlog,b(oe,ae),b(oe,se),b(oe,ce),b(oe,ie),b(oe,le),b(j,ue),b(j,me),b(me,de),de.checked=t.showTypeChannel,b(me,he),b(me,pe),b(me,ge),b(me,fe),b(me,be),b(j,ve),b(j,ye),b(ye,ke),ke.checked=t.showTypeContact,b(ye,we),b(ye,$e),b(ye,xe),b(ye,Ne),b(ye,_e),b(j,Ce),b(j,Pe),b(Pe,Te),Te.checked=t.showTypePost,b(Pe,Me),b(Pe,Re),b(Pe,Se),b(Pe,Oe),b(Pe,Ie),b(j,Ue),b(j,Le),b(Le,Fe),Fe.checked=t.showTypePub,b(Le,Ae),b(Le,Ee),b(Le,He),b(Le,je),b(Le,Be),b(j,qe),b(j,De),b(De,ze),ze.checked=t.showTypePrivate,b(De,Ye),b(De,Ve),b(De,We),b(De,Je),b(De,Ke),b(j,Ge),b(j,Qe),b(Qe,Xe),Xe.checked=t.showTypeVote,b(Qe,Ze),b(Qe,et),b(Qe,tt),b(Qe,nt),b(Qe,ot),b(j,rt),b(j,at),b(j,st),b(j,ct),b(ct,it),it.checked=t.showTypeUnknown,b(ct,lt),b(ct,ut),b(ct,mt),b(ct,dt),b(ct,ht),b(j,pt),b(j,gt),b(j,ft),b(j,bt),b(j,vt),b(j,yt),b(yt,kt),kt.checked=kt.__value===t.columnSize,b(yt,wt),b(yt,$t),b(yt,xt),b(j,Nt),b(j,_t),b(_t,Ct),Ct.checked=Ct.__value===t.columnSize,b(_t,Pt),b(_t,Tt),b(_t,Mt),v(e,Rt,a),v(e,St,a),v(e,Ot,a),v(e,It,a)},p(e,t){e.remote&&N.value!==t.remote&&(N.value=t.remote),e.keys&&(R.value=t.keys),e.limit&&(D.value=t.limit),e.showTypeAbout&&(G.checked=t.showTypeAbout),e.showTypeBlog&&(re.checked=t.showTypeBlog),e.showTypeChannel&&(de.checked=t.showTypeChannel),e.showTypeContact&&(ke.checked=t.showTypeContact),e.showTypePost&&(Te.checked=t.showTypePost),e.showTypePub&&(Fe.checked=t.showTypePub),e.showTypePrivate&&(ze.checked=t.showTypePrivate),e.showTypeVote&&(Xe.checked=t.showTypeVote),e.showTypeUnknown&&(it.checked=t.showTypeUnknown),e.columnSize&&(kt.checked=kt.__value===t.columnSize),e.columnSize&&(Ct.checked=Ct.__value===t.columnSize)},i:e,o:e,d(e){e&&(y(n),y(o),y(r),y(s),y(c),y(i),y(l),y(u),y(m),y(A),y(E),y(H),y(j)),t.$$binding_groups[0].splice(t.$$binding_groups[0].indexOf(kt),1),t.$$binding_groups[0].splice(t.$$binding_groups[0].indexOf(Ct),1),e&&(y(Rt),y(St),y(Ot),y(It)),a(Ut)}}}function Bn(e,t,n){let o={},r="",a=so("limit",10),s=so("columnSize","short");document.title="Patchfox - Settings";let c=so("showTypeUnknown",!0),i=so("showTypeAbout",!0),l=so("showTypeBlog",!0),u=so("showTypeChannel",!0),m=so("showTypeContact",!0),d=so("showTypePost",!0),h=so("showTypePrivate",!0),p=so("showTypePub",!0),g=so("showTypeVote",!0);const f=e=>{console.log("saved data from settings",e),n("remote",r=e.remote||""),e.keys?n("keys",o=JSON.stringify(e.keys,null,2)):n("keys",o="")};browser.storage.local.get().then(f,e=>{console.error("error on settings",e)});return{keys:o,remote:r,limit:a,columnSize:s,showTypeUnknown:c,showTypeAbout:i,showTypeBlog:l,showTypeChannel:u,showTypeContact:m,showTypePost:d,showTypePrivate:h,showTypePub:p,showTypeVote:g,saveConfiguration:e=>{co({remote:r,keys:JSON.parse(o),manifest:manifest}),eo("/public"),location.reload()},selectedFile:e=>{const t=e.target.files[0],o=new FileReader;o.onload=function(e){console.log(e.target.result);let t=e.target.result.split("\n").filter(function(e){return 0!=e.indexOf("#")});t=JSON.parse(t.join("\n")),n("remote",r=`ws://localhost:8989~shs:${t.id.slice(0,t.id.indexOf("=")+1)}`),f({keys:t,remote:r})},o.readAsText(t)},input1_input_handler:function(){r=this.value,n("remote",r)},textarea_input_handler:function(){o=this.value,n("keys",o)},input2_input_handler:function(){var e;e=this.value,n("limit",a=""===e?void 0:+e)},change_handler:function(){return io("limit",a)},input3_change_handler:function(){i=this.checked,n("showTypeAbout",i)},change_handler_1:function(e){io("showTypeAbout",i)},input4_change_handler:function(){l=this.checked,n("showTypeBlog",l)},change_handler_2:function(e){io("showTypeBlog",l)},input5_change_handler:function(){u=this.checked,n("showTypeChannel",u)},change_handler_3:function(e){io("showTypeChannel",u)},input6_change_handler:function(){m=this.checked,n("showTypeContact",m)},change_handler_4:function(e){io("showTypeContact",m)},input7_change_handler:function(){d=this.checked,n("showTypePost",d)},change_handler_5:function(e){io("showTypePost",d)},input8_change_handler:function(){p=this.checked,n("showTypePub",p)},change_handler_6:function(e){io("showTypePub",p)},input9_change_handler:function(){h=this.checked,n("showTypePrivate",h)},change_handler_7:function(e){io("showTypePrivate",h)},input10_change_handler:function(){g=this.checked,n("showTypeVote",g)},change_handler_8:function(e){io("showTypeVote",g)},input11_change_handler:function(){c=this.checked,n("showTypeUnknown",c)},change_handler_9:function(e){io("showTypeUnknown",c)},input12_change_handler:function(){s=this.__value,n("columnSize",s)},change_handler_10:function(){return io("columnSize",s)},input13_change_handler:function(){s=this.__value,n("columnSize",s)},change_handler_11:function(){return io("columnSize",s)},$$binding_groups:[[]]}}class qn extends ie{constructor(e){super(),ce(this,e,Bn,jn,c,[])}}function Dn(e,t,n){const o=Object.create(e);return o.msg=t[n],o}function zn(e){var t,n,o,r,s,c,i,l,u,m=[],d=new Map,h=e.msgs;const p=e=>e.msg.key;for(var g=0;g<h.length;g+=1){let t=Dn(e,h,g),n=p(t);d.set(n,m[g]=Vn(n,t))}return{c(){for(g=0;g<m.length;g+=1)m[g].c();t=x(),n=w("ul"),o=w("li"),(r=w("a")).innerHTML='<div class="page-item-subtitle">Previous</div>',s=x(),c=w("li"),(i=w("a")).innerHTML='<div class="page-item-subtitle">Next</div>',r.href="#/public",o.className="page-item page-previous",i.href="#/public",c.className="page-item page-next",n.className="pagination",u=[_(r,"click",P(C(e.click_handler))),_(i,"click",P(C(e.click_handler_1)))]},m(e,a){for(g=0;g<m.length;g+=1)m[g].m(e,a);v(e,t,a),v(e,n,a),b(n,o),b(o,r),b(n,s),b(n,c),b(c,i),l=!0},p(e,n){const o=n.msgs;Z(),m=re(m,e,p,1,n,o,d,t.parentNode,oe,Vn,t,Dn),ee()},i(e){if(!l){for(var t=0;t<h.length;t+=1)m[t].i();l=!0}},o(e){for(g=0;g<m.length;g+=1)m[g].o();l=!1},d(e){for(g=0;g<m.length;g+=1)m[g].d(e);e&&(y(t),y(n)),a(u)}}}function Yn(t){var n;return{c(){(n=w("div")).className="loading loading-lg"},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Vn(e,t){var n,o,r=new Rt({props:{msg:t.msg}});return{key:e,first:null,c(){n=N(),r.$$.fragment.c(),this.first=n},m(e,t){v(e,n,t),ae(r,e,t),o=!0},p(e,t){var n={};e.msgs&&(n.msg=t.msg),r.$set(n)},i(e){o||(r.$$.fragment.i(e),o=!0)},o(e){r.$$.fragment.o(e),o=!1},d(e){e&&y(n),r.$destroy(e)}}}function Wn(e){var t,n,o,r,a,s,c=[Yn,zn],i=[];function l(e){return 0===e.msgs.length?0:1}return o=l(e),r=i[o]=c[o](e),{c(){(t=w("div")).innerHTML='<div class="columns"><h4 class="column">Mentions</h4>\n\t\t\t    <div class="column"></div></div>',n=x(),r.c(),a=N(),t.className="container"},m(e,r){v(e,t,r),v(e,n,r),i[o].m(e,r),v(e,a,r),s=!0},p(e,t){var n=o;(o=l(t))===n?i[o].p(e,t):(Z(),te(()=>{i[n].d(1),i[n]=null}),r.o(1),ee(),(r=i[o])||(r=i[o]=c[o](t)).c(),r.i(1),r.m(a.parentNode,a))},i(e){s||(r&&r.i(),s=!0)},o(e){r&&r.o(),s=!1},d(e){e&&(y(t),y(n)),i[o].d(e),e&&y(a)}}}function Jn(e,t,n){let o,r=[];document.title="Patchfox - Mentions";let a=!1;const s=hermiebox.modules.pullStream,c=hermiebox.sbot,i=()=>{console.log("Loading mentions...",a),window.scrollTo(0,0),n("msgs",r=[]),s((e=>{var t={$filter:{dest:e}};return a&&(t.$filter.value={timestamp:{$lt:a}}),c.backlinks.read({query:[t],index:"DTA",live:!0,reverse:!0,limit:so("limit","10")})})(c.id),s.filter(e=>!e.sync),(e=>s.filter(e=>{if(e.key,"post"!==e.value.content.type)return!0;let t=e.value.content.root||!1;return!t||!r.some(e=>e.value.content.root===t)}))(),(e=>s.filter(e=>"post"!==e.value.content.type||!!(e.value.content.mentions||[]).some(e=>e.link==c.id)))(),s.drain(e=>{r.push(e),n("msgs",r)}))};return H(()=>{o()}),E(()=>{o=Xn.subscribe(e=>{if(console.log("params changed.",a,e.lt),e.lt){let t=parseInt(e.lt);t!==a&&(a=t)}else a=!1;i()})}),{msgs:r,click_handler:function(){return history.back()},click_handler_1:function(){eo("/mentions",{lt:r[r.length-1].rts})}}}let Kn={};const Gn=le(!1),Qn=le({data:Ne.parse(window.location.search),location:window.location.hash.slice(1).replace("?","")}),Xn=ue(Qn,e=>e.data),Zn=ue(Qn,e=>e.location),eo=(e,t)=>{t=t||{},Qn.set({location:e,data:t});let n=Ne.stringify(t);history.pushState({location:e,data:t},`Patchfox - ${e}`,`/index.html?${n}#${e}`),console.log(`Navigate ${e}`,t)},to={"/thread":class extends ie{constructor(e){super(),ce(this,e,un,ln,c,[])}},"/public":class extends ie{constructor(e){super(),ce(this,e,At,Ft,c,[])}},"/compose":class extends ie{constructor(e){super(),ce(this,e,nn,tn,c,[])}},"/profile":class extends ie{constructor(e){super(),ce(this,e,wn,kn,c,[])}},"/error":class extends ie{constructor(e){super(),ce(this,e,_n,Nn,c,[])}},"/channels":class extends ie{constructor(e){super(),ce(this,e,Sn,Rn,c,[])}},"/channel":class extends ie{constructor(e){super(),ce(this,e,Hn,En,c,[])}},"/settings":qn,"/mentions":class extends ie{constructor(e){super(),ce(this,e,Jn,Wn,c,[])}},"*":class extends ie{constructor(e){super(),ce(this,e,null,Et,c,[])}}},no=ue([Gn,Qn],([e,t])=>{let n=t.location;return e?to.hasOwnProperty(n)?to[n]:(console.log("didn't find",n),to["*"]):"/settings"===n?qn:to["*"]}),oo=async()=>{console.log("Connecting to sbot..."),window.ssb=new me;try{await ssb.connect(Kn.keys),Gn.set(!0)}catch(e){throw console.error("can't connect",e),Gn.set(!1),"Can't connect to sbot"}},ro=()=>new Promise((e,t)=>{browser.storage.local.get().then(n=>{window.ssb=new me,ssb.connect(n.keys).then(t=>{console.log("connected"),Gn.set(!0),e()}).catch(e=>{console.error("can't reconnect",e),t(e)})},t)}),ao=()=>{let e=setInterval(()=>{hermiebox.sbot&&hermiebox.sbot.whoami((t,n)=>{t&&(console.error("can't call whoami",t),ro().catch(t=>{console.error("can't reconnect"),clearInterval(e),eo("/error",{error:t})}))})},5e3)},so=(e,t)=>{if(Kn.hasOwnProperty("preferences")){let t=Kn.preferences;if(t.hasOwnProperty(e))return console.log(`getPref - ${e}`,t[e]),t[e]}return t},co=({keys:e,remote:t,manifest:n})=>{Kn.keys=e,Kn.remote=t,Kn.manifest=n,browser.storage.local.set(Kn)},io=(e,t)=>{console.log(`setPref - ${e}`,t),Kn.preferences=Kn.preferences||{},Kn.preferences[e]=t,browser.storage.local.set(Kn)};function lo(t){var n,o,r,s,c,i,l,u,m,d,h,p,g,f,k,$,N,T,M,R,S,O,I,U,L,F,A,E,H,j,B,q,D,z,Y,V,W,J,K,G,Q,X,Z,ee,te,ne,oe,re,ae,se,ce,ie,le;return{c(){n=w("header"),o=w("section"),(r=w("a")).innerHTML='<i class="icon icon-minus text-black"></i>',s=x(),c=w("a"),i=w("figure"),l=w("img"),u=x(),m=w("i"),h=x(),(p=w("a")).textContent="Compose",g=x(),(f=w("a")).textContent="Public",k=x(),($=w("a")).textContent="Mentions",N=x(),(T=w("a")).textContent="Channels",M=x(),(R=w("a")).textContent="Settings",S=x(),(O=w("a")).textContent="Help",I=x(),U=w("section"),(L=w("button")).innerHTML='<i class="icon icon-back"></i>',F=x(),A=w("a"),E=w("figure"),H=w("img"),j=x(),B=w("i"),D=x(),z=w("div"),(Y=w("a")).innerHTML='\n\t\t\t        Menu\n\t\t\t        <i class="icon icon-caret"></i>',V=x(),W=w("ul"),J=w("li"),(K=w("a")).textContent="New",G=x(),Q=w("li"),(X=w("a")).textContent="Public",Z=x(),ee=w("li"),(te=w("a")).textContent="Settings",ne=x(),(oe=w("li")).innerHTML='<a href="/docs/index.html" class="btn btn-link">Help</a>',re=x(),ae=w("li"),(se=w("a")).textContent="Open as a Tab",ce=x(),ie=w("div"),r.href="#/sidebar",r.className="btn btn-link",l.src=t.avatar,l.alt="L",m.className=d="avatar-presence "+(t.$connected?"online":"offline")+" svelte-1ucmw71",i.className="avatar avatar-lg",c.href="#",c.className="navbar-brand mr-2 p-1",p.href="#/compose",p.className="btn btn-link",f.href="#/public",f.className="btn btn-link",$.href="#/mentions",$.className="btn btn-link",T.href="#/channels",T.className="btn btn-link",R.href="#/settings",R.className="btn btn-link",O.href="/docs/index.html",O.className="btn btn-link",o.className="navbar-section hide-sm",L.className="btn btn-link",H.src=t.avatar,H.alt="L",B.className=q="avatar-presence "+(t.$connected?"online":"offline")+" svelte-1ucmw71",E.className="avatar",A.href="...",A.className="navbar-brand mr-2 p-1",Y.href="?",Y.className="btn btn-link dropdown-toggle",Y.tabIndex="0",K.href="#/compose",K.className="btn btn-link",J.className="menu-item",X.href="#/public",X.className="btn btn-link",Q.className="menu-item",te.href="#/settings",te.className="btn btn-link",ee.className="menu-item",oe.className="menu-item",se.href="#/sidebar",se.className="btn btn-link",ae.className="menu-item",W.className="menu",z.className="dropdown float-right",U.className="navbar-section show-sm bg-gray above svelte-1ucmw71",ie.className="blocker show-sm svelte-1ucmw71",n.className="navbar",le=[_(r,"click",t.openSidebar),_(c,"click",t.openMyProfile),_(p,"click",P(C(t.goCompose))),_(f,"click",P(C(t.goPublic))),_($,"click",P(C(t.goMentions))),_(T,"click",P(C(t.goChannels))),_(R,"click",t.goSettings),_(L,"click",t.click_handler),_(Y,"click",P(C(uo))),_(K,"click",P(C(t.goCompose))),_(X,"click",P(C(t.goPublic))),_(te,"click",t.goSettings),_(se,"click",t.closeSidebar)]},m(e,t){v(e,n,t),b(n,o),b(o,r),b(o,s),b(o,c),b(c,i),b(i,l),b(i,u),b(i,m),b(o,h),b(o,p),b(o,g),b(o,f),b(o,k),b(o,$),b(o,N),b(o,T),b(o,M),b(o,R),b(o,S),b(o,O),b(n,I),b(n,U),b(U,L),b(U,F),b(U,A),b(A,E),b(E,H),b(E,j),b(E,B),b(U,D),b(U,z),b(z,Y),b(z,V),b(z,W),b(W,J),b(J,K),b(W,G),b(W,Q),b(Q,X),b(W,Z),b(W,ee),b(ee,te),b(W,ne),b(W,oe),b(W,re),b(W,ae),b(ae,se),b(n,ce),b(n,ie)},p(e,t){e.avatar&&(l.src=t.avatar),e.$connected&&d!==(d="avatar-presence "+(t.$connected?"online":"offline")+" svelte-1ucmw71")&&(m.className=d),e.avatar&&(H.src=t.avatar),e.$connected&&q!==(q="avatar-presence "+(t.$connected?"online":"offline")+" svelte-1ucmw71")&&(B.className=q)},i:e,o:e,d(e){e&&y(n),a(le)}}}function uo(){return""}function mo(e,t,n){let o;i(e,Gn,e=>{n("$connected",o=e)});let r="/images/icon.png";return e.$$.update=((e={$connected:1})=>{e.$connected&&o&&ssb.avatar(ssb.feed).then(e=>{n("avatar",r=`http://localhost:8989/blobs/get/${e.image}`)})}),{avatar:r,goSettings:e=>eo("/settings"),goCompose:()=>eo("/compose"),goPublic:()=>eo("/public"),goChannels:()=>eo("/channels"),goMentions:()=>eo("/mentions"),openSidebar:async e=>{let t=window.location.href;browser.sidebarAction.setPanel({panel:t}),browser.sidebarAction.open();let n=await browser.tabs.getCurrent();await browser.tabs.remove(n.id)},closeSidebar:async e=>{let t=await browser.sidebarAction.getPanel({});await browser.tabs.create({url:t}),await browser.sidebarAction.close()},openMyProfile:e=>{e.stopPropagation(),e.preventDefault(),ssb.feed&&eo("/profile",{feed:ssb.feed})},$connected:o,click_handler:function(){return history.back()}}}class ho extends ie{constructor(e){super(),ce(this,e,mo,lo,c,[])}}function po(e){var t,n,o,r,s,c,i=new ho({}),l=e.$currentView;if(l)var u=new l({});return{c(){t=w("div"),n=w("div"),o=w("div"),i.$$.fragment.c(),r=x(),u&&u.$$.fragment.c(),o.className="column svelte-1ncoho9",R(o,"reduced-line-length",e.useShortColumn),n.className="columns",t.className="container bg-gray",c=[_(window,"popstate",e.popState),_(window,"error",e.handleUncaughtException),_(window,"hashchange",e.hashChange)]},m(e,a){v(e,t,a),b(t,n),b(n,o),ae(i,o,null),b(o,r),u&&ae(u,o,null),s=!0},p(e,t){if(l!==(l=t.$currentView)){if(u){Z();const e=u;te(()=>{e.$destroy()}),e.$$.fragment.o(1),ee()}l?((u=new l({})).$$.fragment.c(),u.$$.fragment.i(1),ae(u,o,null)):u=null}e.useShortColumn&&R(o,"reduced-line-length",t.useShortColumn)},i(e){s||(i.$$.fragment.i(e),u&&u.$$.fragment.i(e),s=!0)},o(e){i.$$.fragment.o(e),u&&u.$$.fragment.o(e),s=!1},d(e){e&&y(t),i.$destroy(),u&&u.$destroy(),a(c)}}}function go(e,t,n){let o,r;i(e,Zn,e=>{n("$routeLocation",o=e)}),i(e,no,e=>{n("$currentView",r=e)});let a="short"==so("columnSize","short");E(async()=>{try{await oo(),ao()}catch(e){switch(console.error("connect error",e),e){case"Can't connect to sbot":"/settings"!==o&&(window.location="/docs/index.html#/troubleshooting/no-connection");break;default:eo("/error",{error:e})}}});return{useShortColumn:a,popState:e=>{if(null!==e.state){console.dir("pop",e.state);let{location:t,data:n}=e.state;Qn.set({location:t,data:n})}},handleUncaughtException:e=>{console.error("Uncaught exception",e),eo("/error",{error:e.message})},hashChange:e=>{console.dir("hash change",e)},$currentView:r}}class fo extends ie{constructor(e){super(),ce(this,e,go,po,c,[])}}(async()=>{window.ssb=!1;try{await(async()=>{console.log("Loading configuration...");try{let e=await browser.storage.local.get();if(!e.hasOwnProperty("keys"))throw"Configuration is missing";Kn=e}catch(e){throw"Configuration is missing"}})()}catch(e){switch(console.error("initialization error",e),e){case"Configuration is missing":eo("/settings");break;default:eo("/error",{error:e})}}new fo({target:document.body})})()}();
//# sourceMappingURL=bundle.js.map
